var A=Object.defineProperty;var S=Object.getOwnPropertySymbols;var F=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var V=(i,o,t)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[o]=t,k=(i,o)=>{for(var t in o||(o={}))F.call(o,t)&&V(i,t,o[t]);if(S)for(var t of S(o))E.call(o,t)&&V(i,t,o[t]);return i};var f=(i,o,t)=>new Promise((r,u)=>{var p=l=>{try{d(t.next(l))}catch(a){u(a)}},m=l=>{try{d(t.throw(l))}catch(a){u(a)}},d=l=>l.done?r(l.value):Promise.resolve(l.value).then(p,m);d((t=t.apply(i,o)).next())});import{u as R,a as y,$ as e,T as L,_ as B,r as U,b as x,g as j,c as q,s as D,d as b,e as Z}from"./bootstrap-SKctUie3.js";import{a5 as N,Y as J,J as $,ag as I,am as M,n as g,ai as w,aj as T,ap as v,aq as _,ab as c,ar as O,b3 as Y,R as P,ah as z,b1 as G,bw as H,S as K}from"../jse/index-index-0SEuuMhD.js";const Q=N({name:"ForgetPassword",__name:"forget-password",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(i,{expose:o,emit:t}){const r=i,u=t,[p,m]=R(J({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:$(()=>r.formSchema),showDefaultActions:!1})),d=y();function l(){return f(this,null,function*(){const{valid:s}=yield m.validate(),n=yield m.getValues();s&&u("submit",n)})}function a(){d.push(r.loginPath)}return o({getFormApi:()=>m}),(s,n)=>(I(),M("div",null,[g(L,null,{desc:w(()=>[T(s.$slots,"subTitle",{},()=>[v(_(s.subTitle||c(e)("authentication.forgetPasswordSubtitle")),1)])]),default:w(()=>[T(s.$slots,"title",{},()=>[v(_(s.title||c(e)("authentication.forgetPassword"))+" ðŸ¤¦ðŸ»â€â™‚ï¸ ",1)])]),_:3}),g(c(p)),O("div",null,[g(c(B),{class:Y([{"cursor-wait":s.loading},"mt-2 w-full"]),"aria-label":"submit",onClick:l},{default:w(()=>[T(s.$slots,"submitButtonText",{},()=>[v(_(s.submitButtonText||c(e)("authentication.sendResetLink")),1)])]),_:3},8,["class"]),g(c(B),{class:"mt-4 w-full",variant:"outline",onClick:n[0]||(n[0]=h=>a())},{default:w(()=>[v(_(c(e)("common.back")),1)]),_:1})])]))}}),ae=N({name:"ForgetPassword",__name:"forget-password",setup(i){const o=y(),t=P(!1),r=P(""),u=P(""),p=P(!1),m=$(()=>[{component:K(q),componentProps:{placeholder:e("auth.console"),onChange:a=>{a&&D(a)}},fieldName:"selectZone",label:e("auth.console"),rules:b().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:b().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(a,s){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>f(this,null,function*(){const n=s.errors.value;if(!a.email||n!=null&&n.email)throw x.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield Z({email:a.email,action:"passwd_forget"})}),createText:n=>n>0?e("authentication.sendText",[n]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"Vcode",label:e("authentication.code"),rules:b().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.password")},fieldName:"Passwd",label:e("authentication.password"),rules:b().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputCaptcha",componentProps:{imageUrl:u.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:l},dependencies:{if:p.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")}]);function d(a){return f(this,null,function*(){var n;const s=G(k({captcha_id:r.value||"",captcha_value:a.captcha_value||""},a),["selectZone"]);t.value=!0;try{yield U(s),x.success(e("auth.resetPasswordSuccessTitle")),o.push("/login")}catch(h){console.error(h);const{code:C}=(n=h==null?void 0:h.data)!=null?n:{};(C===4005||C===4019)&&(yield l())}finally{t.value=!1}})}function l(){return f(this,null,function*(){const[,a]=yield H(j(r.value));r.value=a==null?void 0:a.captcha_id,u.value=a==null?void 0:a.captcha_url,p.value=!0})}return(a,s)=>(I(),z(c(Q),{"form-schema":m.value,loading:t.value,"submit-button-text":c(e)("common.reset"),description:" ",onSubmit:d},null,8,["form-schema","loading","submit-button-text"]))}});export{ae as default};
