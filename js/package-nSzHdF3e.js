var M=Object.defineProperty,V=Object.defineProperties;var I=Object.getOwnPropertyDescriptors;var F=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var z=(u,o,n)=>o in u?M(u,o,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[o]=n,U=(u,o)=>{for(var n in o||(o={}))q.call(o,n)&&z(u,n,o[n]);if(F)for(var n of F(o))J.call(o,n)&&z(u,n,o[n]);return u},Y=(u,o)=>V(u,I(o));var N=(u,o,n)=>new Promise((C,h)=>{var y=l=>{try{d(n.next(l))}catch(a){h(a)}},x=l=>{try{d(n.throw(l))}catch(a){h(a)}},d=l=>l.done?C(l.value):Promise.resolve(l.value).then(y,x);d((n=n.apply(u,o)).next())});import{c6 as L,$ as m,a as G,d4 as O,B as H,bi as S,M as K}from"./bootstrap-QC5HPXIW.js";import{e as Q}from"./order-4Jd3KM5_.js";import{c as W}from"./package-DGHEzpua.js";import{_ as X}from"./page.vue_vue_type_script_setup_true_lang-C2EvkboD.js";import"./index-B35-VdDB.js";import{a5 as Z,R as b,Y as ee,a6 as ae,bw as te,af as p,ak as w,ah as k,ab as i,al as c,ag as v,an as ce,au as f,av as r,F as A,aj as B,w as E}from"../jse/index-index-C5kN0FgG.js";import"./x-t2EEVmmI.js";const se={class:"package-wrapper relative pb-[160px] md:pb-[130px]"},oe={class:"flex flex-shrink-0 flex-col text-2xl md:flex-row md:items-center"},ne={key:0,class:"ml-1 rounded-sm border border-[#ff7200] px-1 py-[1px] text-xs text-[#ff7200]"},re={key:0},le={key:0,class:"text-foreground/60 text-xs"},ue={class:"align-top text-xs text-[#ff7200]"},de={class:"text-2xl text-[#ff7200]"},ie={key:0,class:"text-foreground/80 text-xs"},pe=["onClick"],fe=["onClick"],ge=["onClick"],ke=["onClick"],_e={class:"bg-background-deep border-border fixed bottom-0 h-[160px] w-full rounded-md border-t shadow-xl md:h-[130px]"},me={class:"bg-background absolute bottom-5 h-full w-full border-t p-3"},ve={class:"flex items-center"},he={class:"mr-5"},xe={class:"text-primary text-3xl"},be={class:"text-3xl text-[#ff7200]"},ye={class:"text-lg"},Ce={class:"mt-3 items-center md:flex"},Pe={class:"mt-2 flex flex-col gap-2 md:ml-2 md:mt-0 md:inline-flex"},ze=Z({__name:"package",setup(u){const o=G(),{locale:n}=L(),C=b(0),h=b(!1),y=b(!1),x=b(!1),d=b(0),l=b(0),a=ee({currency:"",balance:0,packages:[],selectPackage:{cn:[],en:[]}});ae(()=>N(this,null,function*(){const[s,t]=yield te(W());if(s){console.error(s);return}n.value==="zh-CN"?(a.currency="CNY",a.balance=t.balance_cny,a.packages=[...t.list_cn],a.packages.forEach(e=>{a.selectPackage.cn.push(Y(U({},e),{amount:0}))})):(a.currency="USD",a.balance=t.balance_usd,a.packages=[...t.list_en],a.packages.forEach(e=>{a.selectPackage.en.push(Y(U({},e),{amount:0}))}))}));function P(){let s=0,t=0;a.selectPackage.cn.length>0?a.selectPackage.cn.forEach(e=>{e.amount>0&&(s+=e.price*e.amount,t+=e.traffic*e.amount)}):a.selectPackage.en.forEach(e=>{e.amount>0&&(s+=e.price*e.amount,t+=e.traffic*e.amount)}),d.value=s,l.value=Number(s.toFixed(1)),C.value=t}function R(){h.value?l.value=a.balance>=d.value?0:Number((d.value-a.balance).toFixed(1)):l.value=d.value}function T(){K.confirm({title:m("page.package.confirmCreate"),onOk:()=>N(this,null,function*(){j()})})}function j(){return N(this,null,function*(){x.value=!0;const s={price:Number(d.value),currency:a.currency,goods:[],goods_type:a.currency==="CNY"?"flow_packet_cn":"flow_packet_en",customized:!1,balance_used:Number((d.value-l.value).toFixed(1)),auto_renew:y.value},t=a.currency==="CNY"?a.selectPackage.cn:a.selectPackage.en;s.goods=t.filter(e=>e.amount>0),s.customized=s.goods.every(e=>e.customized),Q(s).then(e=>{x.value=!1,e.finished?o.push({path:"/",query:{is_payed:"1"}}):o.push({name:"OrderDetail",query:{currency:a.currency,orderID:e.order_id,totalPrice:l.value,buyData:JSON.stringify(s.goods)}})}).catch(e=>{x.value=!1,console.error(e)})})}function $(s,t){a.selectPackage[s][t].amount>0&&(a.selectPackage[s][t].amount--,P())}function D(s,t){a.selectPackage[s][t].amount++,P()}return(s,t)=>(p(),w(i(X),{description:i(m)("page.package.packageSub"),"auto-content-height":""},{default:k(()=>[c("div",se,[(p(!0),v(A,null,ce(a.packages,(e,g)=>(p(),v("div",{key:e.subject,class:"border-border bg-background mb-5 flex items-center justify-between rounded-md border p-5"},[c("div",null,[c("div",oe,[f(r(e.traffic)+"TB ",1),e.original_price-e.price>0?(p(),v("span",ne,[a.currency==="CNY"?(p(),v("span",re," 立减￥"+r((e.original_price-e.price).toFixed(2)),1)):(p(),v(A,{key:1},[f(r(((e.original_price-e.price)/e.original_price*100).toFixed(1))+"% off ",1)],64))])):B("",!0)]),a.currency==="CNY"?(p(),v("span",le,r(e.customized?e.subject:"永久有效"),1)):B("",!0)]),c("div",null,[c("span",ue,r(a.currency==="CNY"?"￥":"$"),1),c("em",de,r(e.price),1),e.price!==e.original_price?(p(),v("s",ie," ￥"+r(e.original_price),1)):B("",!0)]),c("div",null,[a.currency==="CNY"?(p(),w(i(O),{key:0,value:a.selectPackage.cn[g].amount,"onUpdate:value":_=>a.selectPackage.cn[g].amount=_,min:0,class:"w-28",onChange:t[0]||(t[0]=()=>P())},{addonBefore:k(()=>[c("div",{class:"cursor-pointer",onClick:_=>$("cn",g)}," - ",8,pe)]),addonAfter:k(()=>[c("div",{class:"cursor-pointer",onClick:_=>D("cn",g)}," + ",8,fe)]),_:2},1032,["value","onUpdate:value"])):(p(),w(i(O),{key:1,value:a.selectPackage.en[g].amount,"onUpdate:value":_=>a.selectPackage.en[g].amount=_,min:0,class:"w-28",onChange:t[1]||(t[1]=()=>P())},{addonBefore:k(()=>[c("div",{class:"cursor-pointer",onClick:_=>$("en",g)}," - ",8,ge)]),addonAfter:k(()=>[c("div",{class:"cursor-pointer",onClick:_=>D("en",g)}," + ",8,ke)]),_:2},1032,["value","onUpdate:value"]))])]))),128)),c("div",_e,[c("div",me,[c("div",ve,[c("div",he,[f(r(i(m)("page.package.totalTraffic"))+" ",1),c("em",xe,[f(r(C.value)+" ",1),t[4]||(t[4]=c("span",{class:"text-lg"},"TB",-1))])]),c("div",null,[f(r(i(m)("page.package.totalPrice"))+" ",1),c("em",be,[f(r(l.value)+" ",1),c("span",ye,r(a.currency==="CNY"?"RMB":"USD"),1)])])]),c("div",Ce,[E(i(H),{disabled:d.value===0,loading:x.value,size:"large",type:"primary",onClick:T},{default:k(()=>[f(r(i(m)("page.package.createOrder")),1)]),_:1},8,["disabled","loading"]),c("div",Pe,[a.balance>0?(p(),w(i(S),{key:0,checked:h.value,"onUpdate:checked":t[2]||(t[2]=e=>h.value=e),disabled:d.value===0,class:"md:text-md text-xs",onChange:R},{default:k(()=>[f(r(i(m)("page.package.useBalance"))+" ("+r(a.balance)+") ",1)]),_:1},8,["checked","disabled"])):B("",!0),E(i(S),{checked:y.value,"onUpdate:checked":t[3]||(t[3]=e=>y.value=e),class:"md:text-md mt-1 text-xs md:mt-0"},{default:k(()=>[f(r(i(m)("page.package.autoRenew")),1)]),_:1},8,["checked"])])])])])])]),_:1},8,["description"]))}});export{ze as default};
