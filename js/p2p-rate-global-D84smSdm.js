var E=(F,l,r)=>new Promise((f,m)=>{var x=e=>{try{n(r.next(e))}catch(d){m(d)}},t=e=>{try{n(r.throw(e))}catch(d){m(d)}},n=e=>e.done?f(e.value):Promise.resolve(e.value).then(x,t);n((r=r.apply(F,l)).next())});import{s as V}from"./vue-json-excel.esm-n8EZxOyt.js";import{$ as G,x as L}from"./bootstrap-CkMOf_ks.js";import{a5 as O,R as P,aW as b,Y as H,J as S,af as U,ak as j,ah as k,ab as _,bw as I,w as D,au as J,al as W}from"../jse/index-index-Dsf0VSis.js";import{a as Y,b as q,D as z}from"./history-data-CASBhXm1.js";import{_ as K}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-ao-KFh8X.js";import{_ as Q}from"./line-chart.vue_vue_type_script_setup_true_lang-Bamb7SQL.js";import{_ as X}from"./page.vue_vue_type_script_setup_true_lang-CAFig3cp.js";import{f as Z,g as w}from"./format-D1LOjVPN.js";import"./app-CIi5bRyD.js";import"./domain-C1xncDfG.js";import"./use-modal-C5TBk-jK.js";import"./x-DG8pKHUf.js";import"./loading-qrt6bFpU.js";import"./use-echarts-CpkO3yHY.js";const aa={class:"md:pt-5"},ha=O({__name:"p2p-rate-global",setup(F){const l=P("week"),r=P([b().startOf("day").subtract(1,"week"),b().startOf("day")]),f=P(),m=P(),x=P(""),t=H({xData:[],unit:"%",yName:"Traffic"}),n=H({}),e=H({}),d=S(()=>l.value==="week"||l.value==="month");function A(){return E(this,arguments,function*(u=r.value[0],a=r.value[1]){t.xData=[],n.P2P=[],n.HTTP=[],e.ratio=[];let p=5;d.value&&(p=1440);const v=0,h={start_ts:R(u),end_ts:R(a),gran:p},[y,N]=yield I(Promise.all([Y(v,h),q(v,h)]));if(y)return;const[$,c]=N,s=$.list;f.value=s;const i=c.list;if(m.value=i,!s||!i)return;const g=[...s].sort((o,T)=>o.value-T.value);t.unit=Z(g[g.length-1].value).unit,i.forEach(o=>{n.P2P.push(w(o.value,t.unit))}),s.forEach(o=>{t.xData.push(b(o.ts*1e3).format("MM-DD")),n.HTTP.push(w(o.value,t.unit))}),i.forEach((o,T)=>{const M=o.value>0&&s[T]?o.value/(o.value+s[T].value):0;e.ratio.push(Number((M*100).toFixed(1)))})})}function R(u){return u.unix()}function B(u,a){A(u,a)}function C(){return E(this,null,function*(){const u=[];m.value.forEach((c,s)=>{u.push({ts:c.ts,p2p:c.value,http:f==null?void 0:f.value[s].value})});const a=[];let p=0,v=0;const h=`P2P(${t.unit})`,y=`HTTP(${t.unit})`;u.forEach(c=>{const s=b(c.ts*1e3).format("MM-DD"),i=w(c.p2p,t.unit),g=w(c.http,t.unit);p+=Number.parseFloat(`${i}`),v+=Number.parseFloat(`${g}`),a.push({Date:s,[h]:i,[y]:g})});const N=(p/a.length).toFixed(2),$=(v/a.length).toFixed(2);return a.push({Date:"Avg",[h]:N,[y]:$}),x.value="Global Traffic Statistics.csv",a})}return A(),(u,a)=>(U(),j(_(X),{description:_(G)("page.history.data.descGlobal")},{extra:k(()=>[D(_(L),{class:"mt-1",type:"primary"},{default:k(()=>[D(_(V),{fetch:C,name:x.value,type:"csv"},{default:k(()=>a[2]||(a[2]=[J(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:k(()=>[D(K),W("div",aa,[D(_(z),{date:l.value,"onUpdate:date":a[0]||(a[0]=p=>l.value=p),range:r.value,"onUpdate:range":a[1]||(a[1]=p=>r.value=p),day:!1,hour:!1,"show-time":!1,onChange:B},null,8,["date","range"])]),D(Q,{data:n,"option-data":t,"second-data":e,class:"mt-6","show-p2p":""},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ha as default};
