import{k as R,a as S,w as $,b_ as U,M as l,$ as s,be as B}from"./bootstrap-CgpL34Qf.js";import{b as G,e as q}from"./app-BFImYluB.js";import{a as C,b as F,c as O,d as P}from"./live-data-D3BjB5U1.js";import{c as v,u as L}from"./order-8Mb5iG_T.js";import{_ as M}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-CV7SZgK4.js";import{_ as K}from"./checkin-button.vue_vue_type_script_setup_true_lang-xwcmt7d6.js";import{_ as N}from"./distribution-global.vue_vue_type_script_setup_true_lang-DRSWyxLj.js";import{_ as j}from"./live-time.vue_vue_type_script_setup_true_lang-Cn3g8LaL.js";import"./index-CtT-iGra.js";import{f as k,a as p}from"./format-DM5sW9ek.js";import{_ as V}from"./page.vue_vue_type_script_setup_true_lang-BObZ_Ion.js";import{a5 as z,R as m,a6 as E,a7 as H,ah as J,ai as g,ab as _,ag as Q,n as u}from"../jse/index-index-CBSM48l5.js";import"./app-DvGgY6y1.js";import"./domain-CSTKk2DY.js";import"./use-modal-Dp_oiybZ.js";import"./x-Br57HnM1.js";import"./loading-Dx-bVRTa.js";import"./pie-card.vue_vue_type_script_setup_true_lang-Z-C3zaQo.js";import"./pie-chart.vue_vue_type_script_setup_true_lang-BuxFTg2S.js";import"./use-echarts-D6SgrU4-.js";import"./index-uJmAaJGb.js";import"./live-card.vue_vue_type_script_setup_true_lang-2CrKIp02.js";const ke=z({__name:"global",setup(W){const d=R(),y=S(),I=$(),{locale:T}=U(),i=m(!1),w=m(!0),n=m({whiteList:!1,type:{product_type:0,time:""},online:0,traffic_p2p:{num:0,unit:"KB"},traffic_http:{num:0,unit:"KB"},frequency_day:0,num_max:0,rebuffer_ratio:-1,flow:{remain:0,daily_remain:0,totalRemain:0,free:{num:0,unit:"KB"},utc:0},clock:null,traffic_p2p_day:0,traffic_http_day:0}),c=m({domainData:[],versionData:[],deviceData:[],liveData:[],netTypeData:[],ispData:[]});E(()=>{const{params:t}=d;t.domainInfo?(b(!0),x(!0)):(b(0),x())});let h;function b(t){D(t),clearInterval(h),h=setInterval(()=>{D(t)},2e4)}H(()=>{clearInterval(h)});function D(t){(t?()=>C(0):()=>F(0))().then(a=>{if(n.value.online=a.num_rt,n.value.traffic_p2p_day=a.traffic_p2p_day,n.value.traffic_http_day=a.traffic_http_day,n.value.traffic_p2p=k(a.traffic_p2p_day),n.value.traffic_http=k(a.traffic_http_day),n.value.frequency_day=a.api_frequency_day,n.value.num_max=a.num_max,n.value.flow.remain=a.flow.remain,n.value.flow.daily_remain=a.flow.daily_remain,n.value.flow.totalRemain=a.flow.daily_remain+a.flow.remain,n.value.flow.free=k(a.flow.free),n.value.flow.utc=a.flow.utc,n.value.whiteList=a.whitelist,n.value.type.product_type=a.flow.product_type,n.value.type.time=a.flow.duetime,n.value.clock=a.clock,a.flow.free===0&&a.flow.remain===0&&a.flow.daily_remain===0&&w.value&&d.query.payment===void 0&&!a.whitelist){const r=l.confirm({maskClosable:!1,closable:!0,title:s("page.dashboard.trafficUseOut"),okText:s("page.package.buyFlow"),cancelText:s("page.package.buyMonthly"),cancelButtonProps:{type:"primary"},onOk(){y.push("/shopping/package")},onCancel:o=>{r.destroy(),o!=null&&o.name&&y.push("/shopping/monthly-package")}});w.value=!1}}).catch(a=>{console.error(a)})}function x(t){const e=t?r=>O(0,{type:r}):(r,o)=>P(0,{type:r,lang:o});(t?()=>G():()=>q())().then(r=>{c.value.domainData=r?p(r):[]}),e("version").then(r=>{const o=r.data;c.value.versionData=o?p(o):[]}),e("device").then(r=>{const o=r.data;c.value.deviceData=o?p(o):[]}),e("live").then(r=>{const o=r.data;c.value.liveData=o?p(o):[]}),e("netType").then(r=>{const o=r.data;c.value.netTypeData=o?p(o):[]}),e("isp",T.value==="en-US"?"en":"").then(r=>{const o=r.data;c.value.ispData=o?p(o):[]})}function f(t){i.value=!1,t.is_payed?l.info({title:s("page.package.paySuccess"),okText:s("common.ok"),onOk(){y.push("/")}}):t.processing?l.success({title:s("page.package.payPending"),okText:s("common.ok")}):l.error({title:s("page.package.payFail"),okText:s("common.ok")})}function A(){const t=d.query;if(t.cancel){l.error({title:s("page.package.paySuspended"),okText:s("common.ok")});return}if(t.is_payed&&l.success({title:s("page.package.paySuccess"),okText:s("common.ok")}),t.payment)switch(i.value=!0,t.payment){case"alipay":{v("alipay",t.out_trade_no).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"coinbase":case"coinpayments":case"cryptomus":case"nowpayments":{if(!t.orderId){i.value=!1;return}L({uid:Number.parseInt(`${I.accessUserId}`),order_id:t.orderId.split("?")[0],processing:!0}).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"paypal":{v("paypal",t.orderId).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"stripe":{v("stripe",t.orderId).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}default:{i.value=!1;break}}}return A(),(t,e)=>(Q(),J(_(V),{description:_(s)("page.dashboard.descGlobal"),"auto-content-height":"","content-class":"overflow-y-auto"},{extra:g(()=>[u(K)]),default:g(()=>[u(M),u(_(B),{spinning:i.value,tip:_(s)("page.package.checkResultLoadingTip")},{default:g(()=>[u(j,{"is-super-peer":!1,statis:n.value,global:""},null,8,["statis"]),u(N,{data:c.value},null,8,["data"])]),_:1},8,["spinning","tip"])]),_:1},8,["description"]))}});export{ke as default};
