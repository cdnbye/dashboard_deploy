var A=Object.defineProperty;var _=Object.getOwnPropertySymbols;var v=Object.prototype.hasOwnProperty,y=Object.prototype.propertyIsEnumerable;var k=(n,a,t)=>a in n?A(n,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[a]=t,x=(n,a)=>{for(var t in a||(a={}))v.call(a,t)&&k(n,t,a[t]);if(_)for(var t of _(a))y.call(a,t)&&k(n,t,a[t]);return n};var f=(n,a,t)=>new Promise((u,c)=>{var d=e=>{try{i(t.next(e))}catch(o){c(o)}},s=e=>{try{i(t.throw(e))}catch(o){c(o)}},i=e=>e.done?u(e.value):Promise.resolve(e.value).then(d,s);i((t=t.apply(n,a)).next())});import{$ as p,I as C,x as S,d6 as w,z as b}from"./bootstrap-CiyWlmzu.js";import{u as L}from"./vxe-table-B3uN1EwY.js";import{f as $}from"./domain-DxFU4Atk.js";import{b as z}from"./p2p-BSmMGjdU.js";import{_ as T}from"./page.vue_vue_type_script_setup_true_lang-CQ_GieV6.js";import{a5 as U,Y as V,af as B,ak as D,ah as m,ab as l,w as g,au as M,av as P,bw as W}from"../jse/index-index-DX6TcLw_.js";import"./loading-C3dzF5Xb.js";import"./form-Cbk7_7El.js";import"./RightOutlined-oamSFcRw.js";import"./x-COcrQ3Ng.js";const j="*Apply To All*",K=U({__name:"stun-manage",setup(n){const a=V({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:p("page.p2p.name"),minWidth:250},{field:"stuns",title:p("page.p2p.stunManageAddr"),slots:{default:"stuns"},minWidth:250},{field:"operation",title:p("common.operation"),slots:{default:"operation"},width:150}],editConfig:{mode:"cell",trigger:"manual"},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:i=>f(this,[i],function*({page:s}){var h;let e=yield $({page:s.currentPage,page_size:s.pageSize,isvalid:1});e=e.filter(r=>!r.blocked),e.forEach(r=>{r.stuns&&r.stuns.length>=0&&(r.stuns=r.stuns.join(`
`))});const o={};for(const r of e)if((h=r.domain)!=null&&h.endsWith(".localhost")){o.stuns=r.stuns;break}return e.length>1&&e.unshift(x({domain:j,id:0,blocked:!1},o)),{items:e,total:1e3}})}}}),[t,u]=L({gridOptions:a});function c(s){let i=[];s.stuns&&(i=s.stuns.split(`
`).map(e=>e.trim()).filter(e=>e!=="")),d(`${s.id}`,{stuns:i})}function d(s,i){return f(this,null,function*(){u.setLoading(!0);const[e]=yield W(z(s,i));if(u.setLoading(!1),e){b.error({description:p("page.p2p.configFail"),message:p("common.error")});return}b.success({description:p("page.p2p.configSuccess"),message:p("common.success")}),u.reload()})}return(s,i)=>(B(),D(l(T),{description:l(p)("page.p2p.stunManageDesc"),"auto-content-height":""},{default:m(()=>[g(l(t),null,{stuns:m(({row:e})=>[g(l(C).TextArea,{value:e.stuns,"onUpdate:value":o=>e.stuns=o,"auto-size":{minRows:1,maxRows:10},"allow-clear":"",placeholder:"stun:"},null,8,["value","onUpdate:value"])]),operation:m(({row:e})=>[g(l(S),{type:"primary",onClick:w(o=>c(e),["prevent"])},{default:m(()=>[M(P(l(p)("common.ok")),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["description"]))}});export{K as default};
