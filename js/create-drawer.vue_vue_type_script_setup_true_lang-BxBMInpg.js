var u=(t,a,s)=>new Promise((m,r)=>{var p=e=>{try{i(s.next(e))}catch(n){r(n)}},o=e=>{try{i(s.throw(e))}catch(n){r(n)}},i=e=>e.done?m(e.value):Promise.resolve(e.value).then(p,o);i((s=s.apply(t,a)).next())});import{w as l,C as d,y as f,$ as _}from"./bootstrap-DrkGJIrR.js";import{u as I}from"./form-Bwtu3Hhw.js";import{a5 as g,bw as b,af as h,ak as N,ah as A,w as y,ab as v}from"../jse/index-index-C3bEZzmN.js";import{u as $}from"./use-drawer--e2VHNp1.js";function q(){const a=l().accessUserId;return d.get(`user/user_id/${a}/invoice_info`)}function D(t){const s=l().accessUserId;return d.get(`user/user_id/${s}/invoice_list`,{params:t})}function C(t){const s=l().accessUserId;return d.post(`user/user_id/${s}/invoice_create`,t)}function F(t){const s=l().accessUserId;return d.delete(`user/user_id/${s}/invoice/invoice_id/${t}`)}const B=g({__name:"create-drawer",emits:["success"],setup(t,{emit:a}){const s=a,[m,r]=I({layout:"vertical",handleSubmit:i,schema:[{component:"Input",fieldName:"header",label:"发票抬头",componentProps:{placeholder:"企业工商认证名称"},rules:"required"},{component:"Input",fieldName:"identification",label:"纳税人识别号",rules:"required"},{component:"Textarea",fieldName:"address",label:"收件信息",componentProps:{placeholder:"收件地址 联系人"},rules:"required"},{component:"Select",fieldName:"invoice_type",label:"发票类型",defaultValue:"0",componentProps:{class:"w-full",options:[{label:"普票",value:"0"},{label:"专票",value:"1"}]},rules:"required"},{component:"Input",fieldName:"invoice_issued",disabled:!0,label:"已开金额"},{component:"Input",fieldName:"available_amount",disabled:!0,defaultValue:0,label:"可开金额"},{component:"Input",fieldName:"awaitAmount",label:"开票金额",componentProps:{placeholder:"至少1000元"},rules:"required"}],showDefaultActions:!1}),[p,o]=$({onConfirm:()=>u(this,null,function*(){yield r.submitForm()}),onOpenChange:e=>u(this,null,function*(){if(e){o.setState({loading:!0});const[n,c]=yield b(q());if(o.setState({loading:!1}),n)return;r.setValues(c)}})});function i(e){return u(this,null,function*(){if(!(yield r.validate()).valid)return;const c=Number(e.awaitAmount),w=Number(e.available_amount);if(c>w||c<1e3){f.error({message:"输入金额有误"});return}o.setState({loading:!0});const[S]=yield b(C({header:e.header,identification:e.identification,address:e.address,amount:c,invoice_type:Number(e.invoice_type)}));o.setState({loading:!1}),!S&&(f.success({message:_("common.success"),description:_("page.app.createItemSuccess")}),o.close(),s("success"))})}return(e,n)=>(h(),N(v(p),{class:"w-1/2",title:"输入开票信息"},{default:A(()=>[y(v(m),{class:"mx-4"})]),_:1}))}});export{B as _,F as d,D as g};
