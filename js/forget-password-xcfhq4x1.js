var F=Object.defineProperty;var S=Object.getOwnPropertySymbols;var A=Object.prototype.hasOwnProperty,E=Object.prototype.propertyIsEnumerable;var V=(i,o,t)=>o in i?F(i,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[o]=t,k=(i,o)=>{for(var t in o||(o={}))A.call(o,t)&&V(i,t,o[t]);if(S)for(var t of S(o))E.call(o,t)&&V(i,t,o[t]);return i};var g=(i,o,t)=>new Promise((c,u)=>{var p=r=>{try{d(t.next(r))}catch(a){u(a)}},m=r=>{try{d(t.throw(r))}catch(a){u(a)}},d=r=>r.done?c(r.value):Promise.resolve(r.value).then(p,m);d((t=t.apply(i,o)).next())});import{u as R,T as L,_ as x,a as N,$ as e,s as U,b as f,c as B,d as D,r as Z,g as j,e as q}from"./bootstrap-DeA6qr60.js";import{a5 as $,Y as J,J as y,af as I,ag as M,w,ah as b,ab as l,al as O,b3 as Y,ai as _,au as v,av as P,R as T,ak as z,S as G,a$ as H,bw as K}from"../jse/index-index-CzcqLmIz.js";const Q=$({name:"ForgetPassword",__name:"forget-password",props:{formSchema:{},loading:{type:Boolean,default:!1},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(i,{expose:o,emit:t}){const c=i,u=t,[p,m]=R(J({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:y(()=>c.formSchema),showDefaultActions:!1})),d=N();function r(){return g(this,null,function*(){const{valid:n}=yield m.validate(),s=yield m.getValues();n&&u("submit",s)})}function a(){d.push(c.loginPath)}return o({getFormApi:()=>m}),(n,s)=>(I(),M("div",null,[w(L,null,{desc:b(()=>[_(n.$slots,"subTitle",{},()=>[v(P(n.subTitle||l(e)("authentication.forgetPasswordSubtitle")),1)])]),default:b(()=>[_(n.$slots,"title",{},()=>[v(P(n.title||l(e)("authentication.forgetPassword"))+" ðŸ¤¦ðŸ»â€â™‚ï¸ ",1)])]),_:3}),w(l(p)),O("div",null,[w(l(x),{class:Y([{"cursor-wait":n.loading},"mt-2 w-full"]),"aria-label":"submit",onClick:r},{default:b(()=>[_(n.$slots,"submitButtonText",{},()=>[v(P(n.submitButtonText||l(e)("authentication.sendResetLink")),1)])]),_:3},8,["class"]),w(l(x),{class:"mt-4 w-full",variant:"outline",onClick:s[0]||(s[0]=h=>a())},{default:b(()=>[v(P(l(e)("common.back")),1)]),_:1})])]))}}),ae=$({name:"ForgetPassword",__name:"forget-password",setup(i){const o=N(),t=T(!1),c=T(""),u=T(""),p=T(!1),m=y(()=>[{component:G(q),componentProps:{placeholder:e("auth.console"),onChange:a=>{a&&U(a)}},fieldName:"selectZone",label:e("auth.console"),rules:f().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:f().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(a,n){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>g(this,null,function*(){const s=n.errors.value;if(!a.email||s!=null&&s.email)throw B.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield D({email:a.email,action:"passwd_forget"})}),createText:s=>s>0?e("authentication.sendText",[s]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"Vcode",label:e("authentication.code"),rules:f().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:f().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(a){const{passwd:n}=a;return f().min(1,{message:e("authentication.passwordTip")}).refine(s=>s===n,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:f().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputCaptcha",componentProps:{imageUrl:u.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:r},dependencies:{if:p.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")}]);function d(a){return g(this,null,function*(){var s;const n=H(k({captcha_id:c.value||"",captcha_value:a.captcha_value||""},a),["selectZone"]);t.value=!0;try{yield Z(n),B.success(e("auth.resetPasswordSuccessTitle")),o.push("/login")}catch(h){console.error(h);const{code:C}=(s=h==null?void 0:h.data)!=null?s:{};(C===4005||C===4019)&&(yield r())}finally{t.value=!1}})}function r(){return g(this,null,function*(){const[,a]=yield K(j(c.value));c.value=a==null?void 0:a.captcha_id,u.value=a==null?void 0:a.captcha_url,p.value=!0})}return(a,n)=>(I(),z(l(Q),{"form-schema":m.value,loading:t.value,"submit-button-text":l(e)("common.reset"),description:" ",onSubmit:d},null,8,["form-schema","loading","submit-button-text"]))}});export{ae as default};
