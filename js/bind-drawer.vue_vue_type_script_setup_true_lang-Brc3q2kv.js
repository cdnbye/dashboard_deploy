var f=(w,m,t)=>new Promise((c,i)=>{var p=a=>{try{s(t.next(a))}catch(o){i(o)}},n=a=>{try{s(t.throw(a))}catch(o){i(o)}},s=a=>a.done?c(a.value):Promise.resolve(a.value).then(p,n);s((t=t.apply(w,m)).next())});import{$ as r}from"./bootstrap-CiyWlmzu.js";import{u as D}from"./form-Cbk7_7El.js";import{b as v}from"./domain-DxFU4Atk.js";import{a5 as S,bw as C,af as U,ak as A,ah as R,w as T,ab as l}from"../jse/index-index-DX6TcLw_.js";import{u as V}from"./use-drawer-BZgfIivn.js";const B=S({__name:"bind-drawer",emits:["success"],setup(w,{emit:m}){const t=m,[c,i]=D({layout:"vertical",handleSubmit:s,schema:[{component:"Textarea",fieldName:"domain",label:"domain",componentProps:{autoSize:{minRows:4,maxRows:10},placeholder:r("page.domain.bindDomainTip")},rules:"required"},{component:"Textarea",fieldName:"playUrl",label:"playUrl",componentProps:{autoSize:{minRows:4,maxRows:10},placeholder:r("page.domain.playUrlTip")},rules:"required"}],showDefaultActions:!1}),[p,n]=V({onConfirm:()=>f(this,null,function*(){yield i.submitForm()}),onOpenChange(a){if(a){const{values:o}=n.getData();o&&i.setValues(o)}}});function s(a){return f(this,null,function*(){var b,h;if(!(yield i.validate()).valid)return;n.setState({loading:!0});const g=(b=a.domain)==null?void 0:b.trim(),y=(h=a.playUrl)==null?void 0:h.trim(),u=g.split(`
`).map(e=>{var _;return e.endsWith(".localhost")||e.endsWith(".superpeer")?e==null?void 0:e.trim():(_=e==null?void 0:e.trim())==null?void 0:_.toLowerCase()}).filter(e=>e!==""),d={play_url:y};u.length===1?d.domain=u[0]:d.domains=u;const[x]=yield C(v(d));n.setState({loading:!1}),!x&&(n.close(),t("success"))})}return(a,o)=>(U(),A(l(p),{description:l(r)("page.domain.bindWarning"),title:l(r)("page.domain.bindDomain"),class:"w-1/2"},{default:R(()=>[T(l(c),{class:"mx-4"})]),_:1},8,["description","title"]))}});export{B as _};
