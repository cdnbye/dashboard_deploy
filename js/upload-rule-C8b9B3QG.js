var V=Object.defineProperty;var v=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var S=(c,a,i)=>a in c?V(c,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[a]=i,A=(c,a)=>{for(var i in a||(a={}))W.call(a,i)&&S(c,i,a[i]);if(v)for(var i of v(a))N.call(a,i)&&S(c,i,a[i]);return c};var _=(c,a,i)=>new Promise((l,g)=>{var k=d=>{try{f(i.next(d))}catch(t){g(t)}},m=d=>{try{f(i.throw(d))}catch(t){g(t)}},f=d=>d.done?l(d.value):Promise.resolve(d.value).then(k,m);f((i=i.apply(c,a)).next())});import{$ as o,bf as w,d4 as $,B as j,y as L}from"./bootstrap-QC5HPXIW.js";import{u as D}from"./vxe-table-BTsW-ApG.js";import{f as O}from"./domain-DYNLDaZf.js";import{c as z}from"./p2p-jdN8RxJ3.js";import{_ as F}from"./page.vue_vue_type_script_setup_true_lang-C2EvkboD.js";import{a5 as G,Y,af as u,ak as y,ah as h,ab as n,w as b,aj as P,ag as R,au as q,av as B,bw as T}from"../jse/index-index-C5kN0FgG.js";import"./loading-CjfJb0X9.js";import"./form-Bsu9NQNs.js";import"./RightOutlined-DGpcx4_N.js";import"./x-t2EEVmmI.js";const E={key:0,class:"flex justify-center"},I={key:1,class:"text-destructive"},H="*Apply To All*",ne=G({__name:"upload-rule",setup(c){const a=Y({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:o("page.p2p.name"),minWidth:250},{field:"status",title:o("page.p2p.uploadRuleStatus"),slots:{default:"status"},width:200},{field:"seeder",title:o("page.seeder.seedPreferred"),slots:{default:"seeder"},width:180,titleSuffix:{content:o("page.seeder.seedPreferredTip")}},{field:"operation",title:o("page.seeder.urgentRatio"),slots:{default:"operation"},minWidth:200,titleSuffix:{content:o("page.seeder.urgentRatioTip")}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:s=>_(this,[s],function*({page:t}){var C,x,U;let e=yield O({page:t.currentPage,page_size:t.pageSize,isvalid:1});const r={};for(const p of e)if(p.domain.endsWith(".localhost")){r.wifi_only=p.wifi_only,r.seed_preferred=p.seed_preferred,r.urgent_ratio=p.urgent_ratio;break}return e=e.filter(p=>!p.blocked),e.length>1&&e.unshift(A({uid:(C=e==null?void 0:e[0])==null?void 0:C.uid,domain:H,id:0,blocked:!1,wifi_only:(x=e==null?void 0:e[0])==null?void 0:x.wifi_only,seed_preferred:(U=e==null?void 0:e[0])==null?void 0:U.seed_preferred},r)),{items:e,total:1e3}})}}}),[i,l]=D({gridOptions:a});function g(t,s){m(t.id,{wifi_only:s,seed_preferred:!!t.seed_preferred})}function k(t,s){m(t.id,{seed_preferred:s,wifi_only:!!t.wifi_only})}function m(t,s){return _(this,null,function*(){l.setLoading(!0);const[e]=yield T(z(t,s));l.setLoading(!1),d(e)})}function f(t){return _(this,null,function*(){l.setLoading(!0);const[s]=yield T(p2pConfigUrgentRatioApi(t.id,{urgent_ratio:t.urgent_ratio}));l.setLoading(!1),d(s)})}function d(t){if(t){L.error({description:o("page.p2p.configFail"),message:o("common.error")});return}L.success({description:o("page.p2p.configSuccess"),message:o("common.success")}),l.reload()}return(t,s)=>(u(),y(n(F),{description:n(o)("page.p2p.uploadRuleDesc"),"auto-content-height":""},{default:h(()=>[b(n(i),null,{status:h(({row:e})=>[e.blocked?P("",!0):(u(),y(n(w),{key:0,checked:!!e.wifi_only,"checked-children":n(o)("common.on"),"un-checked-children":n(o)("common.off"),"onUpdate:checked":r=>g(e,r)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),seeder:h(({row:e})=>[e.blocked?P("",!0):(u(),y(n(w),{key:0,checked:!!e.seed_preferred,"checked-children":n(o)("common.on"),"un-checked-children":n(o)("common.off"),"onUpdate:checked":r=>k(e,r)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),operation:h(({row:e})=>[e.blocked?(u(),R("span",I,B(n(o)("common.illegal")),1)):(u(),R("div",E,[b(n($),{value:e.urgent_ratio,"onUpdate:value":r=>e.urgent_ratio=r,class:"mr-2"},null,8,["value","onUpdate:value"]),b(n(j),{type:"primary",onClick:r=>f(e)},{default:h(()=>[q(B(n(o)("common.ok")),1)]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["description"]))}});export{ne as default};
