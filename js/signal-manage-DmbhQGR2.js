var U=Object.defineProperty;var A=Object.getOwnPropertySymbols;var w=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var v=(o,n,e)=>n in o?U(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,x=(o,n)=>{for(var e in n||(n={}))w.call(n,e)&&v(o,e,n[e]);if(A)for(var e of A(n))N.call(n,e)&&v(o,e,n[e]);return o};var h=(o,n,e)=>new Promise((g,u)=>{var m=a=>{try{p(e.next(a))}catch(i){u(i)}},t=a=>{try{p(e.throw(a))}catch(i){u(i)}},p=a=>a.done?g(a.value):Promise.resolve(a.value).then(m,t);p((e=e.apply(o,n)).next())});import{$ as l,d6 as V,I as y,bf as B,B as I,d5 as T,y as C}from"./bootstrap-QC5HPXIW.js";import{u as j}from"./vxe-table-BTsW-ApG.js";import{f as z}from"./domain-DYNLDaZf.js";import{u as F}from"./p2p-jdN8RxJ3.js";import{_ as G}from"./page.vue_vue_type_script_setup_true_lang-C2EvkboD.js";import{a5 as M,Y as O,af as S,ak as L,ah as c,ab as r,al as _,av as b,w as f,aj as R,au as W,bw as $}from"../jse/index-index-C5kN0FgG.js";import"./loading-CjfJb0X9.js";import"./form-Bsu9NQNs.js";import"./RightOutlined-DGpcx4_N.js";import"./x-t2EEVmmI.js";const D={class:"text-foreground/60 mb-3"},P=["href"],E="*Apply To All*",sa=M({__name:"signal-manage",setup(o){const n=O({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:l("page.p2p.name"),minWidth:250},{field:"addr",title:l("page.p2p.signalAddr"),slots:{default:"addr"},minWidth:200},{field:"addr2",title:l("page.p2p.signalAddr2"),slots:{default:"addr2"},minWidth:200},{field:"switch",title:l("page.p2p.signalSwitch"),slots:{default:"switch"},width:100},{field:"operation",title:l("common.operation"),slots:{default:"operation"},width:100}],editConfig:{mode:"cell",trigger:"manual"},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:p=>h(this,[p],function*({page:t}){var d,k;let a=yield z({page:t.currentPage,page_size:t.pageSize,isvalid:1});a.forEach(s=>{s.signals&&s.signals.length>=0&&(s.signals=s.signals.join(`
`)),s.signals2&&s.signals2.length>=0&&(s.signals2=s.signals2.join(`
`))});const i={};for(const s of a)if(s.domain.endsWith(".localhost")){i.signals=s.signals,i.signals2=s.signals2,i.signal_enabled=s.signal_enabled;break}return a=a.filter(s=>!s.blocked),a.length>1&&a.unshift(x({uid:(d=a==null?void 0:a[0])==null?void 0:d.uid,domain:E,id:0,blocked:!1,signal_enabled:(k=a==null?void 0:a[0])==null?void 0:k.signal_enabled},i)),{items:a,total:1e3}})}}}),[e,g]=j({gridOptions:n});function u(t){let p=[],a=[];t.signals&&(p=t.signals.split(`
`).map(d=>d.trim()).filter(d=>d!=="")),t.signals2&&(a=t.signals2.split(`
`).map(d=>d.trim()).filter(d=>d!==""));const i={signals:p,signals2:a,enabled:t.signal_enabled};m(t.id,i)}function m(t,p){return h(this,null,function*(){g.setLoading(!0);const[a]=yield $(F(t,p));if(g.setLoading(!1),a){C.error({description:l("page.p2p.configFail"),message:l("common.error")});return}C.success({description:l("page.p2p.configSuccess"),message:l("common.success")}),g.reload()})}return(t,p)=>(S(),L(r(G),{"auto-content-height":""},{description:c(()=>[_("div",null,[_("p",D,b(r(l)("page.p2p.signalManageDesc")),1),_("a",{href:r(V),class:"text-primary hover:text-primary-hover",target:"_blank"},b(r(l)("page.p2p.signalManageOfficial"))+" -> ",9,P)])]),default:c(()=>[f(r(e),null,{addr:c(({row:a})=>[f(r(y).TextArea,{value:a.signals,"onUpdate:value":i=>a.signals=i,"auto-size":{minRows:1,maxRows:10},"allow-clear":"",placeholder:"wss://"},null,8,["value","onUpdate:value"])]),addr2:c(({row:a})=>[f(r(y).TextArea,{value:a.signals2,"onUpdate:value":i=>a.signals2=i,"auto-size":{minRows:1,maxRows:10},"allow-clear":"",placeholder:"wss://"},null,8,["value","onUpdate:value"])]),switch:c(({row:a})=>[a.blocked?R("",!0):(S(),L(r(B),{key:0,checked:a.signal_enabled,"onUpdate:checked":i=>a.signal_enabled=i},null,8,["checked","onUpdate:checked"]))]),operation:c(({row:a})=>[f(r(I),{type:"primary",onClick:T(i=>u(a),["prevent"])},{default:c(()=>[W(b(r(l)("common.ok")),1)]),_:2},1032,["onClick"])]),_:1})]),_:1}))}});export{sa as default};
