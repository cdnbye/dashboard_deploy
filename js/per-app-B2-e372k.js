import{bn as $,$ as p,o as q,a as C}from"./bootstrap-CL17rep8.js";import{g as I,h as R}from"./app-Cg8zyd4h.js";import{c as S,d as U,b as A}from"./live-data-B5O8XuUG.js";import{_ as F}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-DOsItLzs.js";import{u as K}from"./app-CMJ7M8kh.js";import{_ as P}from"./distribution-global.vue_vue_type_script_setup_true_lang-Dcja1D2j.js";import{_ as M}from"./live-time.vue_vue_type_script_setup_true_lang-DD5JwWT7.js";import"./index-UPlx172m.js";import{_ as G}from"./page.vue_vue_type_script_setup_true_lang-Bmglc92S.js";import{a5 as L,R as m,a6 as O,J as W,a7 as J,X as N,af as V,ak as X,ah as j,ab as B,w as d}from"../jse/index-index-BG6jV3fR.js";import{a as l,f as _}from"./format-lT1W09NM.js";import"./use-modal-7p7rnGpN.js";import"./x-BMVsyMFc.js";import"./loading-DyJFSIH5.js";import"./domain-DVItbrBE.js";import"./pie-card.vue_vue_type_script_setup_true_lang-7rdUkz4A.js";import"./pie-chart.vue_vue_type_script_setup_true_lang-CsxskKne.js";import"./use-echarts-CRrpZ6nM.js";import"./index-Cv3G5jqK.js";import"./live-card.vue_vue_type_script_setup_true_lang-CjW58W68.js";const va=L({__name:"per-app",setup(z){const h=q(),y=C(),f=K(),D=m(!1),w=m(!0),o=m({whiteList:!1,type:{product_type:0,time:""},online:0,traffic_p2p:{num:0,unit:"KB"},traffic_http:{num:0,unit:"KB"},traffic_share:{num:0,unit:"KB"},frequency_day:0,num_max:0,rebuffer_ratio:-1,flow:{remain:0,daily_remain:0,totalRemain:0,free:{num:0,unit:"KB"},utc:0},clock:null,traffic_p2p_day:0,traffic_http_day:0}),i=m({versionData:[],tagData:[],deviceData:[],liveData:[],netTypeData:[],domainData:[],natTypeData:[]});O(()=>{const{params:e}=h,r=e.domainInfo;r&&r.uid?(g(r.id,e.hostId),b(!0),f.setCurrentDomain(r)):T()});const v=W(()=>{var r;const e=f.currentDomain;return(r=e==null?void 0:e.domain)==null?void 0:r.endsWith(".superpeer")});let u;function g(e,r){k(e,r),clearInterval(u),u=setInterval(()=>{k(e,r)},2e4)}J(()=>{clearInterval(u)}),N(()=>f.currentDomain,()=>{h.params.hostId===void 0&&(clearInterval(u),T())});function b(e,r=-1,x=!1){const{id:a,native:c}=e,s=r>=0?n=>S(r,{type:n}):n=>U(a,{type:n});s("version").then(n=>{const t=n.data;i.value.versionData=t?l(t):[]}),s("tag").then(n=>{const t=n.data;i.value.tagData=t?l(t):[]}),!c&&!v.value?s("device").then(n=>{const t=n.data;i.value.deviceData=t?l(t):[]}):i.value.deviceData=[],s("live").then(n=>{const t=n.data;i.value.liveData=t?l(t):[]}),v.value?i.value.netTypeData=[]:s("netType").then(n=>{const t=n.data;i.value.netTypeData=t?l(t):[]}),c?s("nat").then(n=>{const t=n.data;i.value.natTypeData=t?l(t):[]}):i.value.natTypeData=[],e.domain.startsWith("shadow@")?(D.value=!0,(x?()=>I():()=>R())().then(t=>{i.value.domainData=t?l(t):[]})):(i.value.domainData=[],D.value=!1)}function k(e,r){(r>=0?()=>A(r):()=>A(e))().then(a=>{if(o.value.online=a.num_rt,o.value.traffic_p2p_day=a.traffic_p2p_day,o.value.traffic_http_day=a.traffic_http_day,o.value.traffic_p2p=_(a.traffic_p2p_day),o.value.traffic_http=_(a.traffic_http_day),o.value.traffic_share=_(a.traffic_share_day),o.value.frequency_day=a.api_frequency_day,o.value.rebuffer_ratio=a.total_rebuffers!==0&&a.total_media_requests!==0?a.total_rebuffers/a.total_media_requests:-1,o.value.num_max=a.num_max,o.value.flow.remain=a.flow.remain,o.value.flow.daily_remain=a.flow.daily_remain,o.value.flow.totalRemain=a.flow.daily_remain+a.flow.remain,o.value.flow.free=_(a.flow.free),o.value.flow.utc=a.flow.utc,o.value.whiteList=a.whitelist,o.value.type.product_type=a.flow.product_type,o.value.type.time=a.flow.duetime,o.value.clock=a.clock,a.flow.free===0&&a.flow.remain===0&&a.flow.daily_remain===0&&w.value&&!a.whitelist){const c=$.confirm({maskClosable:!1,closable:!0,cancelButtonProps:{type:"primary"},title:p("page.dashboard.trafficUseOut"),okText:p("page.package.buyFlow"),cancelText:p("page.package.buyMonthly"),onOk(){y.push("/shopping/package")},onCancel:s=>{c.destroy(),s!=null&&s.name&&y.push("/shopping/monthly-package")}});w.value=!1}}).catch(a=>{console.error(a)})}function T(){const e=f.currentDomain;e!=null&&e.id&&(g(e.uid,e.id),b(e))}return(e,r)=>(V(),X(B(G),{description:B(p)("page.dashboard.descPerApp"),"auto-content-height":"","content-class":"overflow-y-auto"},{default:j(()=>[d(F),d(M,{global:!1,"is-super-peer":v.value,statis:o.value},null,8,["is-super-peer","statis"]),d(P,{data:i.value},null,8,["data"])]),_:1},8,["description"]))}});export{va as default};
