var V=Object.defineProperty;var S=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,N=Object.prototype.propertyIsEnumerable;var v=(c,o,i)=>o in c?V(c,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):c[o]=i,A=(c,o)=>{for(var i in o||(o={}))W.call(o,i)&&v(c,i,o[i]);if(S)for(var i of S(o))N.call(o,i)&&v(c,i,o[i]);return c};var _=(c,o,i)=>new Promise((l,m)=>{var k=d=>{try{f(i.next(d))}catch(t){m(t)}},g=d=>{try{f(i.throw(d))}catch(t){m(t)}},f=d=>d.done?l(d.value):Promise.resolve(d.value).then(k,g);f((i=i.apply(c,o)).next())});import{$ as n,bf as w,d0 as $,B as D,y as L}from"./bootstrap-PGBUDbCq.js";import{u as O}from"./vxe-table-CriMOnOg.js";import{f as j}from"./domain-CJPK5SCV.js";import{c as q}from"./p2p-AcsYwDKG.js";import{_ as z}from"./page.vue_vue_type_script_setup_true_lang-CXbajufZ.js";import{a5 as F,Y as G,ah as y,ai as u,ab as a,ag as h,n as b,al as P,am as R,ap as Y,aq as B,bw as T}from"../jse/index-index-BXx06mpc.js";import"./loading-btu9_ztw.js";import"./form-n2PTTWpZ.js";import"./RightOutlined-Cb3bhFuj.js";import"./x-Ba7vdtkv.js";const E={key:0,class:"flex justify-center"},I={key:1,class:"text-destructive"},H="*Apply To All*",ae=F({__name:"upload-rule",setup(c){const o=G({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:n("page.p2p.name"),minWidth:250},{field:"status",title:n("page.p2p.uploadRuleStatus"),slots:{default:"status"},width:200},{field:"seeder",title:n("page.seeder.seedPreferred"),slots:{default:"seeder"},width:180,titleSuffix:{content:n("page.seeder.seedPreferredTip")}},{field:"operation",title:n("page.seeder.urgentRatio"),slots:{default:"operation"},minWidth:200,titleSuffix:{content:n("page.seeder.urgentRatioTip")}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:s=>_(this,[s],function*({page:t}){var C,x,U;let e=yield j({page:t.currentPage,page_size:t.pageSize,isvalid:1});const r={};for(const p of e)if(p.domain.endsWith(".localhost")){r.wifi_only=p.wifi_only,r.seed_preferred=p.seed_preferred,r.urgent_ratio=p.urgent_ratio;break}return e=e.filter(p=>!p.blocked),e.length>1&&e.unshift(A({uid:(C=e==null?void 0:e[0])==null?void 0:C.uid,domain:H,id:0,blocked:!1,wifi_only:(x=e==null?void 0:e[0])==null?void 0:x.wifi_only,seed_preferred:(U=e==null?void 0:e[0])==null?void 0:U.seed_preferred},r)),{items:e,total:1e3}})}}}),[i,l]=O({gridOptions:o});function m(t,s){g(t.id,{wifi_only:s,seed_preferred:!!t.seed_preferred})}function k(t,s){g(t.id,{seed_preferred:s,wifi_only:!!t.wifi_only})}function g(t,s){return _(this,null,function*(){l.setLoading(!0);const[e]=yield T(q(t,s));l.setLoading(!1),d(e)})}function f(t){return _(this,null,function*(){l.setLoading(!0);const[s]=yield T(p2pConfigUrgentRatioApi(t.id,{urgent_ratio:t.urgent_ratio}));l.setLoading(!1),d(s)})}function d(t){if(t){L.error({description:n("page.p2p.configFail"),message:n("common.error")});return}L.success({description:n("page.p2p.configSuccess"),message:n("common.success")}),l.reload()}return(t,s)=>(h(),y(a(z),{description:a(n)("page.p2p.uploadRuleDesc"),"auto-content-height":""},{default:u(()=>[b(a(i),null,{status:u(({row:e})=>[e.blocked?P("",!0):(h(),y(a(w),{key:0,checked:!!e.wifi_only,"checked-children":a(n)("common.on"),"un-checked-children":a(n)("common.off"),"onUpdate:checked":r=>m(e,r)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),seeder:u(({row:e})=>[e.blocked?P("",!0):(h(),y(a(w),{key:0,checked:!!e.seed_preferred,"checked-children":a(n)("common.on"),"un-checked-children":a(n)("common.off"),"onUpdate:checked":r=>k(e,r)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),operation:u(({row:e})=>[e.blocked?(h(),R("span",I,B(a(n)("common.illegal")),1)):(h(),R("div",E,[b(a($),{value:e.urgent_ratio,"onUpdate:value":r=>e.urgent_ratio=r,class:"mr-2"},null,8,["value","onUpdate:value"]),b(a(D),{type:"primary",onClick:r=>f(e)},{default:u(()=>[Y(B(a(n)("common.ok")),1)]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["description"]))}});export{ae as default};
