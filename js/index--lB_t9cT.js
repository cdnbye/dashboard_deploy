var v=(S,x,f)=>new Promise((p,h)=>{var y=e=>{try{t(f.next(e))}catch(s){h(s)}},_=e=>{try{t(f.throw(e))}catch(s){h(s)}},t=e=>e.done?p(e.value):Promise.resolve(e.value).then(y,_);t((f=f.apply(S,x)).next())});import{az as N,b8 as V,$ as o,aB as j,I as F,a as H,B as E,x as X,b6 as R,y as $}from"./bootstrap-Dm2SQx9s.js";import{u as W}from"./vxe-table-BADlCCGx.js";import{g as Y,d as Z,u as J,a as K}from"./seeder-DhE_Oztp.js";import{_ as Q}from"./create-seeder-modal.vue_vue_type_script_setup_true_lang-Doj5CvXm.js";import{_ as ee}from"./seed-modal.vue_vue_type_script_setup_true_lang-Bp3Bf2aq.js";import{_ as te}from"./page.vue_vue_type_script_setup_true_lang-BESDktLb.js";import{bh as ae,a5 as D,R as P,af as O,ak as B,ah as c,w as d,ab as a,al as G,av as L,Y as ne,au as C,bw as z}from"../jse/index-index-CnArI7MG.js";import{C as oe}from"./CopyOutlined-DiP7xPZJ.js";import{c as se}from"./copy-BiEntFID.js";import{u as I}from"./use-modal-B7SINb_e.js";import{P as ie}from"./index-DYQe0e2Y.js";import"./loading-BElQi3ZR.js";import"./form-Dg9CDSQt.js";import"./RightOutlined-DlqlRrgt.js";import"./x-DWIRDBn_.js";var A={exports:{}},q;function re(){return q||(q=1,function(S,x){(function(f){var p=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,h=/^(?=([^\/?#]*))\1([^]*)$/,y=/(?:\/|^)\.(?=\/)/g,_=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,t={buildAbsoluteURL:function(e,s,u){if(u=u||{},e=e.trim(),s=s.trim(),!s){if(!u.alwaysNormalize)return e;var k=t.parseURL(e);if(!k)throw new Error("Error trying to parse base URL.");return k.path=t.normalizePath(k.path),t.buildURLFromParts(k)}var n=t.parseURL(s);if(!n)throw new Error("Error trying to parse relative URL.");if(n.scheme)return u.alwaysNormalize?(n.path=t.normalizePath(n.path),t.buildURLFromParts(n)):s;var l=t.parseURL(e);if(!l)throw new Error("Error trying to parse base URL.");if(!l.netLoc&&l.path&&l.path[0]!=="/"){var w=h.exec(l.path);l.netLoc=w[1],l.path=w[2]}l.netLoc&&!l.path&&(l.path="/");var g={scheme:l.scheme,netLoc:n.netLoc,path:null,params:n.params,query:n.query,fragment:n.fragment};if(!n.netLoc&&(g.netLoc=l.netLoc,n.path[0]!=="/"))if(!n.path)g.path=l.path,n.params||(g.params=l.params,n.query||(g.query=l.query));else{var T=l.path,U=T.substring(0,T.lastIndexOf("/")+1)+n.path;g.path=t.normalizePath(U)}return g.path===null&&(g.path=u.alwaysNormalize?t.normalizePath(n.path):n.path),t.buildURLFromParts(g)},parseURL:function(e){var s=p.exec(e);return s?{scheme:s[1]||"",netLoc:s[2]||"",path:s[3]||"",params:s[4]||"",query:s[5]||"",fragment:s[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(y,"");e.length!==(e=e.replace(_,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};S.exports=t})()}(A)),A.exports}var le=re();const ce=ae(le),de=D({__name:"copy-channel-id",setup(S){const x=[{label:"HLS",value:"m3u8"},{label:"DASH",value:"mpd"},{label:"MEDIA",value:"media"}],f=P(""),p=P("m3u8"),h=N();function y(){const _=[];f.value.split(" ").filter(t=>!!t).forEach(t=>{var s,u,k;t=(u=(s=t.split("?"))==null?void 0:s[0])!=null?u:"";let e="";if(t.startsWith("http")){const n=ce.parseURL(t);n&&(p.value==="media"?(e=n.netLoc.slice(2)+n.path,e=`${e}|[8]m_524288`):(e=n.netLoc.slice(2)+n.path.slice(0,Math.max(0,n.path.lastIndexOf("."))),e=`${e}|[8]`,p.value==="mpd"&&(e=`${e}d`)))}else e=`${(k=h==null?void 0:h.userInfo)==null?void 0:k.token}-${t}|[8]`,p.value==="media"?e=`${e}m_524288`:p.value==="mpd"&&(e=`${e}d`);_.push(window.btoa(encodeURIComponent(e)))}),se(_.join(`
`))}return(_,t)=>(O(),B(a(F),{value:f.value,"onUpdate:value":t[1]||(t[1]=e=>f.value=e),placeholder:a(o)("page.seeder.inputChannelId"),size:"large"},{addonBefore:c(()=>[d(a(V),{value:p.value,"onUpdate:value":t[0]||(t[0]=e=>p.value=e),options:x,class:"w-[100px]",placeholder:"Select",size:"large"},null,8,["value"])]),addonAfter:c(()=>[d(a(j),{placement:"topLeft"},{title:c(()=>[G("span",null,L(a(o)("page.seeder.copy")),1)]),default:c(()=>[d(a(oe),{class:"hover:text-primary cursor-pointer",onClick:y})]),_:1})]),_:1},8,["value","placeholder"]))}}),ue={class:"flex w-full flex-col gap-2 md:flex-row"},Te=D({__name:"index",setup(S){const x=H(),[f,p]=I({connectedComponent:Q}),[h,y]=I({connectedComponent:ee}),_=ne({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"url",title:o("page.seeder.addr"),minWidth:250},{field:"status",title:o("page.p2p.status"),width:100,slots:{default:"status"}},{field:"enable",title:o("page.p2p.signalSwitch"),width:150,slots:{default:"enable"}},{field:"auto",title:o("page.seeder.auto"),width:150,slots:{default:"auto"}},{field:"bandwidth",title:o("page.seeder.bandwidth"),width:150},{field:"remarks",title:o("page.seeder.remarks"),minWidth:100},{field:"operation",title:o("common.operation"),slots:{default:"operation"},width:300}],height:"auto",keepSource:!0,pagerConfig:{enabled:!1},proxyConfig:{ajax:{query:()=>v(this,null,function*(){return{items:yield Y(),total:1e3}})}}}),[t,e]=W({gridOptions:_});function s(){p.open()}function u(){return v(this,null,function*(){yield e.reload()})}function k(i){return v(this,null,function*(){e.setLoading(!0);const[m]=yield z(Z(i.id));e.setLoading(!1),m||($.success({description:o("common.deleteSuccess"),message:o("common.success")}),yield u())})}function n(i,m){return v(this,null,function*(){i.disabled=!m,w(i)})}function l(i,m){return v(this,null,function*(){i.auto=!!m,w(i)})}function w(i){return v(this,null,function*(){e.setLoading(!0);const[m]=yield z(J(i.id,i));e.setLoading(!1),m||($.success({message:o("common.success")}),yield u())})}function g(i){return v(this,null,function*(){yield T(i.id,{action:"ping"})})}function T(i,m){return v(this,null,function*(){e.setLoading(!0);const[r]=yield z(K(i,m));e.setLoading(!1),r||($.success({message:o("common.success")}),yield u())})}function U(i){y.setData(i),y.open()}function M(i){x.push({name:"UserClientP2pSeederStats",query:{sid:i.id,remarks:i.remarks}})}return(i,m)=>(O(),B(a(te),{description:a(o)("page.seeder.desc"),"auto-content-height":""},{default:c(()=>[d(a(h)),d(a(f),{onSuccess:u}),d(a(t),null,{"toolbar-actions":c(()=>[G("div",ue,[d(a(E),{class:"mr-2",size:"large",type:"primary",onClick:s},{default:c(()=>[C(L(a(o)("page.seeder.create")),1)]),_:1}),d(a(de),{class:"w-full flex-1 md:w-1/2"})])]),status:c(({row:r})=>[d(a(X),{color:r.running?"success":"red"},{default:c(()=>[C(L(r.running?a(o)("page.seeder.running"):a(o)("page.seeder.stopped")),1)]),_:2},1032,["color"])]),enable:c(({row:r})=>[d(a(R),{checked:!r.disabled,"onUpdate:checked":b=>n(r,b)},null,8,["checked","onUpdate:checked"])]),auto:c(({row:r})=>[d(a(R),{checked:!!r.auto,"onUpdate:checked":b=>l(r,b)},null,8,["checked","onUpdate:checked"])]),operation:c(({row:r})=>[d(a(E),{disabled:r.disabled,size:"small",type:"link",onClick:b=>g(r)},{default:c(()=>m[0]||(m[0]=[C(" Ping ")])),_:2},1032,["disabled","onClick"]),d(a(E),{disabled:r.disabled||!r.running,size:"small",type:"link",onClick:b=>U(r)},{default:c(()=>[C(L(a(o)("page.seeder.seed")),1)]),_:2},1032,["disabled","onClick"]),d(a(E),{disabled:r.disabled||!r.running,size:"small",type:"link",onClick:b=>M(r)},{default:c(()=>[C(L(a(o)("page.app.watch")),1)]),_:2},1032,["disabled","onClick"]),d(a(ie),{"cancel-text":a(o)("common.cancel"),"ok-text":a(o)("common.ok"),title:a(o)("common.sureDelete"),onConfirm:b=>k(r)},{default:c(()=>[d(a(E),{danger:"",size:"small",type:"link"},{default:c(()=>[C(L(a(o)("common.delete")),1)]),_:1})]),_:2},1032,["cancel-text","ok-text","title","onConfirm"])]),_:1})]),_:1},8,["description"]))}});export{Te as default};
