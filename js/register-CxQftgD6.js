var D=Object.defineProperty;var q=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var B=(r,s,a)=>s in r?D(r,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[s]=a,U=(r,s)=>{for(var a in s||(s={}))H.call(s,a)&&B(r,a,s[a]);if(q)for(var a of q(s))J.call(s,a)&&B(r,a,s[a]);return r};var w=(r,s,a)=>new Promise((d,l)=>{var b=c=>{try{u(a.next(c))}catch(g){l(g)}},p=c=>{try{u(a.throw(c))}catch(g){l(g)}},u=c=>c.done?d(c.value):Promise.resolve(c.value).then(b,p);u((a=a.apply(r,s)).next())});import{u as O,a as W,$ as e,T as Y,_ as G,h as K,i as Q,j as X,k as ee,l as F,m as te,n as ae,o as ne,M as oe,p as se,q as ie,b as V,t as re,c as ce,s as le,d as T,e as ue,g as me}from"./bootstrap-CgpL34Qf.js";import"./index-CtT-iGra.js";import{a5 as Z,Y as de,J as E,ag as I,am as pe,n as N,ai as A,aj as P,ap as R,aq as y,ab as f,b3 as he,ah as M,al as fe,ar as L,R as h,a6 as ge,q as ve,b1 as we,S as be,e as S,bw as Ce}from"../jse/index-index-CBSM48l5.js";const Te={class:"mt-4 text-center text-sm"},ye=Z({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},showThirdPartyLogin:{type:Boolean,default:!0},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["authRequest","submit"],setup(r,{expose:s,emit:a}){const d=r,l=a,[b,p]=O(de({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:E(()=>d.formSchema),showDefaultActions:!1})),u=W();function c(){return w(this,null,function*(){const{valid:o}=yield p.validate(),C=yield p.getValues();o&&l("submit",C)})}function g(o){return w(this,null,function*(){l("authRequest",o)})}function m(){u.push(d.loginPath)}return s({getFormApi:()=>p}),(o,C)=>(I(),pe("div",null,[N(Y,null,{desc:A(()=>[P(o.$slots,"subTitle",{},()=>[R(y(o.subTitle||f(e)("authentication.signUpSubtitle")),1)])]),default:A(()=>[P(o.$slots,"title",{},()=>[R(y(o.title||f(e)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),N(f(b)),N(f(G),{class:he([{"cursor-wait":o.loading},"mt-2 w-full"]),loading:o.loading,"aria-label":"register",onClick:c},{default:A(()=>[P(o.$slots,"submitButtonText",{},()=>[R(y(o.submitButtonText||f(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),P(o.$slots,"third-party-login",{},()=>[o.showThirdPartyLogin?(I(),M(K,{key:0,onSubmit:g})):fe("",!0)]),L("div",Te,[R(y(f(e)("authentication.alreadyHaveAccount"))+" ",1),L("span",{class:"vben-link text-sm font-normal",onClick:C[0]||(C[0]=k=>m())},y(f(e)("authentication.goToLogin")),1)])]))}}),Ve=Z({name:"Register",__name:"register",setup(r){const{locale:s}=Q(),a=X(),d=h(!1),l=h(""),b=h(""),p=h(!1),u=h(!0),c=h(),g=ee(),m=h(""),o=h(""),C=E(()=>[{component:be(ce),componentProps:{placeholder:e("auth.console"),onChange:t=>{t&&le(t)}},fieldName:"selectZone",label:e("auth.console"),rules:T().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:T().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(t,i){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>w(this,null,function*(){const n=i.errors.value;if(!t.email||n!=null&&n.email)throw V.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield ue({email:t.email,action:"signup"})}),createText:n=>n>0?e("authentication.sendText",[n]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"vcode",label:e("authentication.code"),rules:T().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:T().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{passwd:i}=t;return T().min(1,{message:e("authentication.passwordTip")}).refine(n=>n===i,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:T().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInput",componentProps:{placeholder:e("auth.inviter")},dependencies:{if:u.value},fieldName:"inviter",label:e("auth.inviter")},{component:"VbenInputCaptcha",componentProps:{imageUrl:b.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:k},dependencies:{if:p.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")},{component:"VbenCheckbox",fieldName:"contractChecked",label:"",defaultValue:!0,renderComponentContent:()=>({default:()=>[S("div",[S("span",`${e("auth.contract")}ã€Š`),S("a",{target:"view_window",class:"text-primary hover:text-primary-hover",href:s.value==="zh-CN"?"https://www.cdnbye.com/cn/contract.html":"https://www.cdnbye.com/guides/contract.html"},e("auth.contractName")),S("span","ã€‹")])]})}]);function k(){return w(this,null,function*(){const[,t]=yield Ce(me(l.value));l.value=t==null?void 0:t.captcha_id,b.value=t==null?void 0:t.captcha_url,p.value=!0})}function j(t){return w(this,null,function*(){var i;d.value=!0;try{if(t.email===m.value){oe.confirm({title:"inviter email is invalid",content:"inviter email is invalid"});return}const n=we(U({utc:se(),inviter:m.value||"",referer:o.value||void 0,captcha_id:l.value||"",captcha_value:t.captcha_value||""},t),["contractChecked","selectZone"]),v=yield ie(n);yield a.register(v),V.success(e("auth.signUpSuccess"))}catch(n){const{code:v}=(i=n==null?void 0:n.data)!=null?i:{};(v===4005||v===4019)&&(yield k())}finally{d.value=!1}})}function z(t){return w(this,null,function*(){if(!F()){V.error(e("auth.selectZoneWarn"));return}const{provider:i}=t,{url:n}=yield re(i);location.href=n})}return ge(()=>{setTimeout(()=>{const{zone:t,inviter:i,source:n}=g.query,v=F();t&&v!==t&&(te(t),location.reload()),i?(ae(i),m.value=i,u.value=!1):(m.value=ne(),u.value=!!m.value);const x=n||document.referrer;x&&(o.value=x),ve(()=>{var _,$;m.value&&(($=(_=c.value)==null?void 0:_.getFormApi)==null?void 0:$.call(_)).setValues({inviter:m.value})})},50)}),(t,i)=>(I(),M(f(ye),{ref_key:"formRef",ref:c,"form-schema":C.value,loading:d.value,onAuthRequest:z,onSubmit:j},null,8,["form-schema","loading"]))}});export{Ve as default};
