var O=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var U=(f,c,r)=>c in f?O(f,c,{enumerable:!0,configurable:!0,writable:!0,value:r}):f[c]=r,w=(f,c)=>{for(var r in c||(c={}))z.call(c,r)&&U(f,r,c[r]);if(Y)for(var r of Y(c))A.call(c,r)&&U(f,r,c[r]);return f};var B=(f,c,r)=>new Promise((P,y)=>{var D=s=>{try{g(r.next(s))}catch(C){y(C)}},b=s=>{try{g(r.throw(s))}catch(C){y(C)}},g=s=>s.done?P(s.value):Promise.resolve(s.value).then(D,b);g((r=r.apply(f,c)).next())});import{bi as I,$ as h,a as L,ba as j,d5 as q,x as J}from"./bootstrap-Bp4MruiH.js";import{e as T}from"./order-CbQADIyu.js";import{b as W}from"./package-DAuphTwD.js";import{_ as G}from"./page.vue_vue_type_script_setup_true_lang-D2VWOXLO.js";import{a5 as H,R as x,Y as K,J as Q,a6 as X,bw as Z,af as u,ak as F,ah as N,ab as d,w as S,ag as i,al as p,au as _,av as o,F as v,aj as m,an as ee}from"../jse/index-index-BHe_lL3g.js";import{u as ae}from"./use-modal-B-Ao7gAz.js";import"./x-BohE-ELF.js";import"./loading-tj7ZoL7K.js";const te={class:"mb-2"},se={class:"text-foreground/80"},oe={class:"mb-2"},re={class:"text-foreground/80"},ne={class:"mb-2"},ce={class:"text-foreground/80"},le={class:"flex flex-shrink-0 flex-col text-lg md:flex-row md:items-center md:text-2xl"},ue={key:0,class:"ml-1 rounded-sm border border-[#ff7200] px-1 py-[1px] text-xs text-[#ff7200]"},de={key:0,class:"text-foreground/60 text-xs"},pe={key:1,class:"text-foreground/60 text-xs"},ie={key:0},fe={class:"align-top text-xs text-[#ff7200]"},ge={class:"text-lg text-[#ff7200] md:text-2xl"},_e={key:1,class:"text-foreground/80 text-xs"},ye={class:"flex flex-col items-center gap-2 md:flex-row"},De=H({__name:"monthly-package",setup(f){const c=L(),{locale:r}=I(),[P,y]=ae({onConfirm:()=>{$()}}),D=x(0),b=x(!1),g=x(!1),s=x(0),C=x(0),k=x({}),a=K({currency:"",balance:0,packages:[],selectPackage:{cn:[],en:[]}}),E=Q(()=>b.value?a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)):s.value);X(()=>B(this,null,function*(){const[n,t]=yield Z(W());if(n){console.error(n);return}const e=l=>{l.upgrade?(l.leftDays=t.left_days,l.amount=1):l.type.toLowerCase().startsWith("annual")?l.leftDays=365:l.leftDays=30};r.value==="zh-CN"?(a.currency="CNY",a.balance=t.balance_cny,a.packages=[...t.list_cn],a.packages.forEach(l=>{e(l),a.selectPackage.cn.push(w({},l))})):(a.currency="USD",a.balance=t.balance_usd,a.packages=[...t.list_en],a.packages.forEach(l=>{e(l),a.selectPackage.en.push(w({},l))}))}));function M(){let n=0,t=0;a.selectPackage.cn.length>0?a.selectPackage.cn.forEach(e=>{e.amount>0&&(n+=e.price*e.amount,t+=e.traffic*e.amount)}):a.selectPackage.en.forEach(e=>{e.amount>0&&(n+=e.price*e.amount,t+=e.traffic*e.amount)}),s.value=n,C.value=n,D.value=t}function R(){return B(this,null,function*(){y.setState({loading:!0});let n=s.value;b.value&&(n=a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)));const t={price:s.value,currency:a.currency,goods:[k.value],goods_type:a.currency==="CNY"?"monthly_packet_cn":"monthly_packet_en",customized:k.value.customized,upgrade:k.value.upgrade,balance_used:Number((s.value-n).toFixed(1)),auto_renew:g.value};g.value&&(t.goods[0].autorenew=!0),T(t).then(e=>{y.setState({loading:!1}),e.finished?c.push({path:"/",query:{is_payed:"1"}}):c.push({name:"OrderDetail",query:{currency:a.currency,orderID:e.order_id,totalPrice:n,buyData:JSON.stringify(t.goods)}})}).catch(e=>{y.setState({loading:!1}),console.error(e)})})}function V(n){y.open(),k.value=n,s.value=Number(n.price)*n.amount}function $(){R()}return(n,t)=>(u(),F(d(G),{description:d(h)("page.package.monthlyPackageSub"),"auto-content-height":""},{default:N(()=>[S(d(P),{title:d(h)("page.package.confirmCreate")},{default:N(()=>[k.value.upgrade?m("",!0):(u(),i(v,{key:0},[p("p",te,[_(o(d(h)("page.order.packageName"))+": ",1),p("span",se,o(k.value.subject),1)]),p("p",oe,[p("span",re,o(d(h)("page.package.totalMonths"))+": "+o(k.value.amount),1)]),p("p",ne,[p("span",ce,o(d(h)("page.package.totalPrice"))+": "+o(E.value),1)])],64)),a.balance>0?(u(),F(d(j),{key:1,checked:b.value,"onUpdate:checked":t[0]||(t[0]=e=>b.value=e),disabled:s.value===0},{default:N(()=>[_(o(d(h)("page.package.useBalance"))+" ("+o(a.balance)+") ",1)]),_:1},8,["checked","disabled"])):m("",!0),S(d(j),{checked:g.value,"onUpdate:checked":t[1]||(t[1]=e=>g.value=e)},{default:N(()=>[_(o(d(h)("page.package.autoRenew")),1)]),_:1},8,["checked"])]),_:1},8,["title"]),(u(!0),i(v,null,ee(a.packages,e=>(u(),i("div",{key:e.subject,class:"border-border bg-background mb-5 flex items-center justify-between rounded-md border p-5"},[p("div",null,[p("div",le,[_(o(e.subject)+" ",1),e.original_price-e.price>0?(u(),i("span",ue,[a.currency==="CNY"?(u(),i(v,{key:0},[_(" 立减￥"+o((e.original_price-e.price).toFixed(2)),1)],64)):(u(),i(v,{key:1},[_(o(((e.original_price-e.price)/e.original_price*100).toFixed(1))+"% off ",1)],64))])):m("",!0)]),a.currency==="CNY"?(u(),i("span",de,o(e.leftDays)+"天有效 ",1)):(u(),i("span",pe,o(e.leftDays)+" days period ",1))]),p("div",null,[e.upgrade?(u(),i("span",ie,t[3]||(t[3]=[p("strong",null,"+",-1)]))):m("",!0),p("span",fe,o(a.currency==="CNY"?"￥":"$"),1),p("em",ge,o(e.price),1),e.price!==e.original_price?(u(),i("s",_e," ￥"+o(e.original_price),1)):m("",!0)]),p("div",ye,[e.upgrade?m("",!0):(u(),F(d(q),{key:0,value:e.amount,"onUpdate:value":l=>e.amount=l,min:0,class:"w-16",onChange:t[2]||(t[2]=()=>M())},null,8,["value","onUpdate:value"])),S(d(J),{disabled:!e.amount||Number(e.amount)<=0,type:"primary",onClick:l=>V(e)},{default:N(()=>[a.currency==="CNY"?(u(),i(v,{key:0},[_(o(e.upgrade?"升級":"購買"),1)],64)):(u(),i(v,{key:1},[_(o(e.upgrade?"Upgrade":"Buy"),1)],64))]),_:2},1032,["disabled","onClick"])])]))),128))]),_:1},8,["description"]))}});export{De as default};
