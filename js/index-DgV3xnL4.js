var Y=Object.defineProperty,W=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var w=(c,i,s)=>i in c?Y(c,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):c[i]=s,B=(c,i)=>{for(var s in i||(i={}))L.call(i,s)&&w(c,s,i[s]);if(R)for(var s of R(i))V.call(i,s)&&w(c,s,i[s]);return c},I=(c,i)=>W(c,z(i));var E=(c,i,s)=>new Promise((S,_)=>{var P=d=>{try{h(s.next(d))}catch(b){_(b)}},A=d=>{try{h(s.throw(d))}catch(b){_(b)}},h=d=>d.done?S(d.value):Promise.resolve(d.value).then(P,A);h((s=s.apply(c,i)).next())});import{$ as e,a as $,t as G,B as T,v as x}from"./bootstrap-SKctUie3.js";import{u as M}from"./vxe-table-CfGRJCLB.js";import{a as j,b as q,d as F}from"./order-syVOYIXv.js";import{D as H,a as k}from"./index-CD2KMpiI.js";import{_ as J}from"./page.vue_vue_type_script_setup_true_lang-Dgq6zLp-.js";import{a5 as K,Y as Q,ah as u,ai as l,ab as t,ag as p,n as C,ar as X,am as Z,au as ee,ap as f,aq as y,al as g,F as te,bw as v}from"../jse/index-index-0SEuuMhD.js";import{P as ae}from"./index-2WM4XbSS.js";import{A as re}from"./arrow-down-oHqJ19lx.js";import"./loading-BVj1NiH4.js";import"./form-ufAcWega.js";import"./RightOutlined-BmsLIaO2.js";import"./responsiveObserve-wW0iKr2j.js";import"./x-Cpey3BCi.js";function oe(c){switch(c.payment){case"alipay":return e("page.order.alipay");case"balance":return e("page.order.balance");case"coinbase":return"Coinbase";case"coinpayments":return"Coinpayments";case"crypto":return"Cryptocurrency";case"paypal":return"Paypal";case"stripe":return"Stripe"}}const ne={class:"p-5"},ke=K({__name:"index",setup(c){const i=$(),s=Q({columns:[{type:"expand",width:80,slots:{content:"expand_content"}},{field:"created_at",title:e("page.order.createTime"),width:200,formatter:"formatDateTime"},{field:"type",title:e("page.order.type"),width:150},{field:"payMethod",title:e("page.order.payMethod"),width:200},{field:"price",title:e("page.order.price"),width:100},{field:"currency",title:e("page.order.currency"),width:100},{field:"status",title:e("page.order.status"),width:100,slots:{default:"status"}},{field:"operation",title:e("common.operation"),slots:{default:"operation"},width:200}],height:"auto",pagerConfig:{},proxyConfig:{ajax:{query:a=>E(this,[a],function*({page:r}){const o=yield j({page:r.currentPage,page_size:r.pageSize});return{items:o.orders.map(m=>I(B({},m),{status:A(m),_type:m.type,type:P(m),payMethod:oe(m)})),total:o.total}})}}}),[S,_]=M({gridOptions:s});function P(r){let a="";return r.type.startsWith("flow_packet")?a=e("page.order.flowPackage"):r.type.startsWith("monthly_packet")?a=e("page.order.monthlyPlan"):r.type.startsWith("recharge")&&(a=e("page.order.recharge")),a}function A(r){let a="";switch(r.trade_status){case"TRADE_CLOSED":{a=e("page.order.fail");break}case"TRADE_FINISHED":{a=e("page.invitation.done");break}case"TRADE_PROCESSING":{a=e("page.order.processing");break}case"TRADE_SUCCESS":{a=e("page.invitation.done");break}case"WAIT_BUYER_PAY":{a=e("page.order.waitPay");break}}return a}function h(r){const a=r.trade_status;return a==="WAIT_BUYER_PAY"||a==="TRADE_PROCESSING"?"":a==="TRADE_CLOSED"?"red":"green"}function d(r){i.push({name:"OrderDetail",query:{currency:r.currency,orderID:r.order_id,totalPrice:r.price,buyData:JSON.stringify(r.details)}})}function b(r){return E(this,null,function*(){_.setLoading(!0);const[a,o]=yield v(q(r.order_id));if(_.setLoading(!1),a){x.error({message:e("common.error")});return}if(o){const n=window.atob(o),m=new Uint8Array(n.length);for(let D=0;D<n.length;D++)m[D]=n.charCodeAt(D);const N=new Blob([m],{type:"application/pdf"}),U=window.URL.createObjectURL(N);window.open(U)}})}function O(r){return E(this,null,function*(){const[a]=yield v(F(r.order_id));if(a){x.error({message:e("common.error")});return}x.success({message:e("common.success")}),yield _.reload()})}return(r,a)=>(p(),u(t(J),{"auto-content-height":""},{default:l(()=>[C(t(S),null,{expand_content:l(({row:o})=>[X("div",ne,[(p(!0),Z(te,null,ee(o.details,n=>(p(),u(t(H),{key:n.id,size:"small"},{default:l(()=>[C(t(k),{label:t(e)("page.order.packageName")},{default:l(()=>[f(y(n.subject),1)]),_:2},1032,["label"]),n.amount?(p(),u(t(k),{key:0,label:t(e)("page.order.amount")},{default:l(()=>[f(y(n.amount),1)]),_:2},1032,["label"])):g("",!0),!n.type&&n.amount&&n.traffic?(p(),u(t(k),{key:1,label:t(e)("page.order.totalTraffic")},{default:l(()=>[f(y(n.traffic*n.amount)+" TB ",1)]),_:2},1032,["label"])):g("",!0),n.upgrade?(p(),u(t(k),{key:2,label:t(e)("page.order.upgraded")},{default:l(()=>a[0]||(a[0]=[f(" empty ")])),_:1},8,["label"])):g("",!0),o.balance_used?(p(),u(t(k),{key:3,label:t(e)("page.package.useBalance")},{default:l(()=>[f(y(o.balance_used),1)]),_:2},1032,["label"])):g("",!0)]),_:2},1024))),128))])]),status:l(({row:o})=>[C(t(G),{color:h(o)},{default:l(()=>[f(y(A(o)),1)]),_:2},1032,["color"])]),operation:l(({row:o})=>[o.trade_status==="WAIT_BUYER_PAY"?(p(),u(t(T),{key:0,size:"small",type:"link",onClick:n=>d(o)},{default:l(()=>[f(y(t(e)("page.order.pay")),1)]),_:2},1032,["onClick"])):g("",!0),o.trade_status==="WAIT_BUYER_PAY"?(p(),u(t(ae),{key:1,"cancel-text":t(e)("common.cancel"),"ok-text":t(e)("common.ok"),title:t(e)("common.sureClose"),onConfirm:n=>O(o)},{default:l(()=>[C(t(T),{danger:"",size:"small",type:"link"},{default:l(()=>[f(y(t(e)("page.order.close")),1)]),_:1})]),_:2},1032,["cancel-text","ok-text","title","onConfirm"])):g("",!0),o.trade_status==="TRADE_SUCCESS"&&!o._type.startsWith("recharge")?(p(),u(t(T),{key:2,class:"ml-1",size:"small",type:"link",onClick:n=>b(o)},{default:l(()=>[C(t(re),{class:"mb-1 mr-[2px] inline-flex size-3"}),f(" "+y(t(e)("page.order.invoice")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:1})]),_:1}))}});export{ke as default};
