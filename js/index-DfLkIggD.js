var Y=Object.defineProperty,W=Object.defineProperties;var z=Object.getOwnPropertyDescriptors;var R=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var w=(c,i,n)=>i in c?Y(c,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[i]=n,B=(c,i)=>{for(var n in i||(i={}))L.call(i,n)&&w(c,n,i[n]);if(R)for(var n of R(i))V.call(i,n)&&w(c,n,i[n]);return c},I=(c,i)=>W(c,z(i));var E=(c,i,n)=>new Promise((x,y)=>{var S=p=>{try{h(n.next(p))}catch(k){y(k)}},C=p=>{try{h(n.throw(p))}catch(k){y(k)}},h=p=>p.done?x(p.value):Promise.resolve(p.value).then(S,C);h((n=n.apply(c,i)).next())});import{$ as e,c_ as $,a as G,x as j,B as T,y as P}from"./bootstrap-CL17rep8.js";import{u as M}from"./vxe-table-7XJ7DyGq.js";import{a as F,b as q,d as H}from"./order-Bm-HE93R.js";import{_ as J}from"./page.vue_vue_type_script_setup_true_lang-Bmglc92S.js";import{D as K,a as b}from"./index-DhQ1y66a.js";import{a5 as Q,Y as X,af as d,ak as u,ah as l,ab as t,w as A,al as Z,ag as ee,an as te,au as f,av as _,aj as g,F as ae,bw as v}from"../jse/index-index-BG6jV3fR.js";import{P as re}from"./index-DgRpGtnM.js";import{A as oe}from"./arrow-down-GkojoH7e.js";import"./loading-DyJFSIH5.js";import"./form-DVKcOcK9.js";import"./RightOutlined-C1bagf8s.js";import"./x-BMVsyMFc.js";import"./responsiveObserve-DT29KicF.js";const se={class:"p-5"},be=Q({__name:"index",setup(c){const i=G(),n=X({columns:[{type:"expand",width:80,slots:{content:"expand_content"}},{field:"created_at",title:e("page.order.createTime"),width:200,formatter:"formatDateTime"},{field:"type",title:e("page.order.type"),width:150},{field:"payMethod",title:e("page.order.payMethod"),width:200},{field:"price",title:e("page.order.price"),width:100},{field:"currency",title:e("page.order.currency"),width:100},{field:"status",title:e("page.order.status"),width:100,slots:{default:"status"}},{field:"operation",title:e("common.operation"),slots:{default:"operation"},width:200}],height:"auto",pagerConfig:{},proxyConfig:{ajax:{query:a=>E(this,[a],function*({page:r}){const o=yield F({page:r.currentPage,page_size:r.pageSize});return{items:o.orders.map(m=>I(B({},m),{status:C(m),_type:m.type,type:S(m),payMethod:$(m)})),total:o.total}})}}}),[x,y]=M({gridOptions:n});function S(r){let a="";return r.type.startsWith("flow_packet")?a=e("page.order.flowPackage"):r.type.startsWith("monthly_packet")?a=e("page.order.monthlyPlan"):r.type.startsWith("recharge")&&(a=e("page.order.recharge")),a}function C(r){let a="";switch(r.trade_status){case"TRADE_CLOSED":{a=e("page.order.fail");break}case"TRADE_FINISHED":{a=e("page.invitation.done");break}case"TRADE_PROCESSING":{a=e("page.order.processing");break}case"TRADE_SUCCESS":{a=e("page.invitation.done");break}case"WAIT_BUYER_PAY":{a=e("page.order.waitPay");break}}return a}function h(r){const a=r.trade_status;return a==="WAIT_BUYER_PAY"||a==="TRADE_PROCESSING"?"":a==="TRADE_CLOSED"?"red":"green"}function p(r){i.push({name:"OrderDetail",query:{currency:r.currency,orderID:r.order_id,totalPrice:r.price,buyData:JSON.stringify(r.details)}})}function k(r){return E(this,null,function*(){y.setLoading(!0);const[a,o]=yield v(q(r.order_id));if(y.setLoading(!1),a){P.error({message:e("common.error")});return}if(o){const s=window.atob(o),m=new Uint8Array(s.length);for(let D=0;D<s.length;D++)m[D]=s.charCodeAt(D);const N=new Blob([m],{type:"application/pdf"}),U=window.URL.createObjectURL(N);window.open(U)}})}function O(r){return E(this,null,function*(){const[a]=yield v(H(r.order_id));if(a){P.error({message:e("common.error")});return}P.success({message:e("common.success")}),yield y.reload()})}return(r,a)=>(d(),u(t(J),{"auto-content-height":""},{default:l(()=>[A(t(x),null,{expand_content:l(({row:o})=>[Z("div",se,[(d(!0),ee(ae,null,te(o.details,s=>(d(),u(t(K),{key:s.id,size:"small"},{default:l(()=>[A(t(b),{label:t(e)("page.order.packageName")},{default:l(()=>[f(_(s.subject),1)]),_:2},1032,["label"]),s.amount?(d(),u(t(b),{key:0,label:t(e)("page.order.amount")},{default:l(()=>[f(_(s.amount),1)]),_:2},1032,["label"])):g("",!0),!s.type&&s.amount&&s.traffic?(d(),u(t(b),{key:1,label:t(e)("page.order.totalTraffic")},{default:l(()=>[f(_(s.traffic*s.amount)+" TB ",1)]),_:2},1032,["label"])):g("",!0),s.upgrade?(d(),u(t(b),{key:2,label:t(e)("page.order.upgraded")},{default:l(()=>a[0]||(a[0]=[f(" empty ")])),_:1},8,["label"])):g("",!0),o.balance_used?(d(),u(t(b),{key:3,label:t(e)("page.package.useBalance")},{default:l(()=>[f(_(o.balance_used),1)]),_:2},1032,["label"])):g("",!0)]),_:2},1024))),128))])]),status:l(({row:o})=>[A(t(j),{color:h(o)},{default:l(()=>[f(_(C(o)),1)]),_:2},1032,["color"])]),operation:l(({row:o})=>[o.trade_status==="WAIT_BUYER_PAY"?(d(),u(t(T),{key:0,size:"small",type:"link",onClick:s=>p(o)},{default:l(()=>[f(_(t(e)("page.order.pay")),1)]),_:2},1032,["onClick"])):g("",!0),o.trade_status==="WAIT_BUYER_PAY"?(d(),u(t(re),{key:1,"cancel-text":t(e)("common.cancel"),"ok-text":t(e)("common.ok"),title:t(e)("common.sureClose"),onConfirm:s=>O(o)},{default:l(()=>[A(t(T),{danger:"",size:"small",type:"link"},{default:l(()=>[f(_(t(e)("page.order.close")),1)]),_:1})]),_:2},1032,["cancel-text","ok-text","title","onConfirm"])):g("",!0),o.trade_status==="TRADE_SUCCESS"&&!o._type.startsWith("recharge")?(d(),u(t(T),{key:2,class:"ml-1",size:"small",type:"link",onClick:s=>k(o)},{default:l(()=>[A(t(oe),{class:"mb-1 mr-[2px] inline-flex size-3"}),f(" "+_(t(e)("page.order.invoice")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:1})]),_:1}))}});export{be as default};
