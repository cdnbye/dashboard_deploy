var O=Object.defineProperty;var Y=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var E=(f,c,o)=>c in f?O(f,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[c]=o,B=(f,c)=>{for(var o in c||(c={}))q.call(c,o)&&E(f,o,c[o]);if(Y)for(var o of Y(c))z.call(c,o)&&E(f,o,c[o]);return f};var w=(f,c,o)=>new Promise((P,_)=>{var D=s=>{try{y(o.next(s))}catch(C){_(C)}},b=s=>{try{y(o.throw(s))}catch(C){_(C)}},y=s=>s.done?P(s.value):Promise.resolve(s.value).then(D,b);y((o=o.apply(f,c)).next())});import{a as A,b_ as I,$ as h,cE as U,d0 as L,B as J}from"./bootstrap-PGBUDbCq.js";import{e as T}from"./order-qZc91e3i.js";import{b as W}from"./package-f8Ni6nj_.js";import{_ as G}from"./page.vue_vue_type_script_setup_true_lang-CXbajufZ.js";import{a5 as H,R as x,Y as K,J as Q,a6 as X,bw as Z,ah as F,ai as N,ab as d,ag as u,n as S,am as i,ar as p,ap as g,aq as r,F as v,al as m,au as ee}from"../jse/index-index-BXx06mpc.js";import{u as ae}from"./use-modal-CEA9RQg3.js";import"./x-Ba7vdtkv.js";import"./loading-btu9_ztw.js";const te={class:"mb-2"},se={class:"text-foreground/80"},re={class:"mb-2"},oe={class:"text-foreground/80"},ne={class:"mb-2"},ce={class:"text-foreground/80"},le={class:"flex flex-shrink-0 flex-col text-lg md:flex-row md:items-center md:text-2xl"},ue={key:0,class:"ml-1 rounded-sm border border-[#ff7200] px-1 py-[1px] text-xs text-[#ff7200]"},de={key:0,class:"text-foreground/60 text-xs"},pe={key:1,class:"text-foreground/60 text-xs"},ie={key:0},fe={class:"align-top text-xs text-[#ff7200]"},ge={class:"text-lg text-[#ff7200] md:text-2xl"},_e={key:1,class:"text-foreground/80 text-xs"},ye={class:"flex flex-col items-center gap-2 md:flex-row"},De=H({__name:"monthly-package",setup(f){const c=A(),{locale:o}=I(),[P,_]=ae({onConfirm:()=>{j()}}),D=x(0),b=x(!1),y=x(!1),s=x(0),C=x(0),k=x({}),a=K({currency:"",balance:0,packages:[],selectPackage:{cn:[],en:[]}}),M=Q(()=>b.value?a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)):s.value);X(()=>w(this,null,function*(){const[n,t]=yield Z(W());if(n){console.error(n);return}const e=l=>{l.upgrade?(l.leftDays=t.left_days,l.amount=1):l.type.toLowerCase().startsWith("annual")?l.leftDays=365:l.leftDays=30};o.value==="zh-CN"?(a.currency="CNY",a.balance=t.balance_cny,a.packages=[...t.list_cn],a.packages.forEach(l=>{e(l),a.selectPackage.cn.push(B({},l))})):(a.currency="USD",a.balance=t.balance_usd,a.packages=[...t.list_en],a.packages.forEach(l=>{e(l),a.selectPackage.en.push(B({},l))}))}));function R(){let n=0,t=0;a.selectPackage.cn.length>0?a.selectPackage.cn.forEach(e=>{e.amount>0&&(n+=e.price*e.amount,t+=e.traffic*e.amount)}):a.selectPackage.en.forEach(e=>{e.amount>0&&(n+=e.price*e.amount,t+=e.traffic*e.amount)}),s.value=n,C.value=n,D.value=t}function V(){return w(this,null,function*(){_.setState({loading:!0});let n=s.value;b.value&&(n=a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)));const t={price:s.value,currency:a.currency,goods:[k.value],goods_type:a.currency==="CNY"?"monthly_packet_cn":"monthly_packet_en",customized:k.value.customized,upgrade:k.value.upgrade,balance_used:Number((s.value-n).toFixed(1)),auto_renew:y.value};T(t).then(e=>{_.setState({loading:!1}),e.finished?c.push({path:"/",query:{is_payed:"1"}}):c.push({name:"OrderDetail",query:{currency:a.currency,orderID:e.order_id,totalPrice:n,buyData:JSON.stringify(t.goods)}})}).catch(e=>{_.setState({loading:!1}),console.error(e)})})}function $(n){_.open(),k.value=n,s.value=Number(n.price)*n.amount}function j(){V()}return(n,t)=>(u(),F(d(G),{description:d(h)("page.package.monthlyPackageSub"),"auto-content-height":""},{default:N(()=>[S(d(P),{title:d(h)("page.package.confirmCreate")},{default:N(()=>[k.value.upgrade?m("",!0):(u(),i(v,{key:0},[p("p",te,[g(r(d(h)("page.order.packageName"))+": ",1),p("span",se,r(k.value.subject),1)]),p("p",re,[p("span",oe,r(d(h)("page.package.totalMonths"))+": "+r(k.value.amount),1)]),p("p",ne,[p("span",ce,r(d(h)("page.package.totalPrice"))+": "+r(M.value),1)])],64)),a.balance>0?(u(),F(d(U),{key:1,checked:b.value,"onUpdate:checked":t[0]||(t[0]=e=>b.value=e),disabled:s.value===0},{default:N(()=>[g(r(d(h)("page.package.useBalance"))+" ("+r(a.balance)+") ",1)]),_:1},8,["checked","disabled"])):m("",!0),S(d(U),{checked:y.value,"onUpdate:checked":t[1]||(t[1]=e=>y.value=e)},{default:N(()=>[g(r(d(h)("page.package.autoRenew")),1)]),_:1},8,["checked"])]),_:1},8,["title"]),(u(!0),i(v,null,ee(a.packages,e=>(u(),i("div",{key:e.subject,class:"border-border bg-background mb-5 flex items-center justify-between rounded-md border p-5"},[p("div",null,[p("div",le,[g(r(e.subject)+" ",1),e.original_price-e.price>0?(u(),i("span",ue,[a.currency==="CNY"?(u(),i(v,{key:0},[g(" 立减￥"+r((e.original_price-e.price).toFixed(2)),1)],64)):(u(),i(v,{key:1},[g(r(((e.original_price-e.price)/e.original_price*100).toFixed(1))+"% off ",1)],64))])):m("",!0)]),a.currency==="CNY"?(u(),i("span",de,r(e.leftDays)+"天有效 ",1)):(u(),i("span",pe,r(e.leftDays)+" days period ",1))]),p("div",null,[e.upgrade?(u(),i("span",ie,t[3]||(t[3]=[p("strong",null,"+",-1)]))):m("",!0),p("span",fe,r(a.currency==="CNY"?"￥":"$"),1),p("em",ge,r(e.price),1),e.price!==e.original_price?(u(),i("s",_e," ￥"+r(e.original_price),1)):m("",!0)]),p("div",ye,[e.upgrade?m("",!0):(u(),F(d(L),{key:0,value:e.amount,"onUpdate:value":l=>e.amount=l,min:0,class:"w-16",onChange:t[2]||(t[2]=()=>R())},null,8,["value","onUpdate:value"])),S(d(J),{disabled:!e.amount||Number(e.amount)<=0,type:"primary",onClick:l=>$(e)},{default:N(()=>[a.currency==="CNY"?(u(),i(v,{key:0},[g(r(e.upgrade?"升級":"購買"),1)],64)):(u(),i(v,{key:1},[g(r(e.upgrade?"Upgrade":"Buy"),1)],64))]),_:2},1032,["disabled","onClick"])])]))),128))]),_:1},8,["description"]))}});export{De as default};
