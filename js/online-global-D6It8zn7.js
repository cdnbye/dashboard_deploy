var y=(M,v,s)=>new Promise((_,c)=>{var l=t=>{try{u(s.next(t))}catch(i){c(i)}},p=t=>{try{u(s.throw(t))}catch(i){c(i)}},u=t=>t.done?_(t.value):Promise.resolve(t.value).then(l,p);u((s=s.apply(M,v)).next())});import{s as b}from"./vue-json-excel.esm-COGjU9FM.js";import{$ as E,x as $}from"./bootstrap-Bp4MruiH.js";import{a5 as B,R as h,aW as x,Y as k,af as C,ak as R,ah as g,ab as d,bw as A,w as f,au as H,al as S}from"../jse/index-index-BHe_lL3g.js";import{f as U,D as j}from"./history-data-BGergHzI.js";import{_ as F}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-D6rIlu8G.js";import{_ as G}from"./line-chart.vue_vue_type_script_setup_true_lang-DH-k96YB.js";import{_ as O}from"./page.vue_vue_type_script_setup_true_lang-D2VWOXLO.js";import"./app-E0tO-0ov.js";import"./domain-Cw5DPjGA.js";import"./use-modal-B-Ao7gAz.js";import"./x-BohE-ELF.js";import"./loading-tj7ZoL7K.js";import"./use-echarts-C1IZQCRH.js";const P={class:"md:pt-5"},ea=B({__name:"online-global",setup(M){const v=h("hour"),s=h([x().subtract(1,"hour"),x()]),_=h(),c=h(""),l=k({xData:[],yName:"online"}),p=k({}),u=k({});function t(){return y(this,arguments,function*(e=s.value[0],a=s.value[1]){const n={start_ts:i(e),end_ts:i(a)},[m,D]=yield A(U(0,n));if(m)return;const r=D.list;_.value=r,l.xData=[],p.online=[],r.forEach(o=>{l.xData.push(x(o.ts*1e3).format("MM-DD HH:mm")),p.online.push(o.value)})})}function i(e){return e.unix()}function N(e,a){t(e,a)}function V(){return y(this,null,function*(){const e=new Map;_.value.forEach(r=>{const o=x(r.ts*1e3).format("MM-DD"),w=e.get(o);(!w||w<r.value)&&e.set(o,r.value)});const a=[];let n=0,m=0;for(const[r,o]of e.entries())a.push({Date:r,Value:o}),n+=o,o!==0&&m++;let D=0;return m>0&&(D=Math.round(n/m)),a.push({Date:"Avg",Value:D}),c.value="Online Viewers Statistics.csv",a})}return t(),(e,a)=>(C(),R(d(O),{description:d(E)("page.history.data.descGlobal")},{extra:g(()=>[f(d($),{class:"mt-1",type:"primary"},{default:g(()=>[f(d(b),{fetch:V,name:c.value,type:"csv"},{default:g(()=>a[2]||(a[2]=[H(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:g(()=>[f(F),S("div",P,[f(d(j),{date:v.value,"onUpdate:date":a[0]||(a[0]=n=>v.value=n),range:s.value,"onUpdate:range":a[1]||(a[1]=n=>s.value=n),month:!1,span:7,onChange:N},null,8,["date","range"])]),f(G,{data:p,"option-data":l,"second-data":u,class:"mt-6"},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ea as default};
