var O=Object.defineProperty;var S=Object.getOwnPropertySymbols;var q=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var U=(f,n,o)=>n in f?O(f,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):f[n]=o,B=(f,n)=>{for(var o in n||(n={}))q.call(n,o)&&U(f,o,n[o]);if(S)for(var o of S(n))z.call(n,o)&&U(f,o,n[o]);return f};var w=(f,n,o)=>new Promise((P,_)=>{var D=s=>{try{y(o.next(s))}catch(C){_(C)}},b=s=>{try{y(o.throw(s))}catch(C){_(C)}},y=s=>s.done?P(s.value):Promise.resolve(s.value).then(D,b);y((o=o.apply(f,n)).next())});import{a as A,bX as I,$ as h,cB as E,cY as L,B as J}from"./bootstrap-SKctUie3.js";import{e as T}from"./order-syVOYIXv.js";import{b as W}from"./package-B3EFO7ns.js";import{_ as X}from"./page.vue_vue_type_script_setup_true_lang-Dgq6zLp-.js";import{a5 as G,R as x,Y as H,J as K,a6 as Q,bw as Z,ah as Y,ai as N,ab as d,ag as u,n as F,am as i,ar as p,ap as g,aq as r,F as v,al as m,au as ee}from"../jse/index-index-0SEuuMhD.js";import{u as ae}from"./use-modal-CeNy_I9O.js";import"./x-Cpey3BCi.js";import"./loading-BVj1NiH4.js";const te={class:"mb-2"},se={class:"text-foreground/80"},re={class:"mb-2"},oe={class:"text-foreground/80"},ce={class:"mb-2"},ne={class:"text-foreground/80"},le={class:"flex flex-shrink-0 flex-col text-lg md:flex-row md:items-center md:text-2xl"},ue={key:0,class:"ml-1 rounded-sm border border-[#ff7200] px-1 py-[1px] text-xs text-[#ff7200]"},de={key:0,class:"text-foreground/60 text-xs"},pe={key:1,class:"text-foreground/60 text-xs"},ie={key:0},fe={class:"align-top text-xs text-[#ff7200]"},ge={class:"text-lg text-[#ff7200] md:text-2xl"},_e={key:1,class:"text-foreground/80 text-xs"},ye={class:"flex flex-col items-center gap-2 md:flex-row"},De=G({__name:"monthly-package",setup(f){const n=A(),{locale:o}=I(),[P,_]=ae({onConfirm:()=>{j()}}),D=x(0),b=x(!1),y=x(!1),s=x(0),C=x(0),k=x({}),a=H({currency:"",balance:0,packages:[],selectPackage:{cn:[],en:[]}}),M=K(()=>b.value?a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)):s.value);Q(()=>w(this,null,function*(){const[c,t]=yield Z(W());if(c){console.error(c);return}const e=l=>{l.upgrade?(l.leftDays=t.left_days,l.amount=1):l.type.toLowerCase().startsWith("annual")?l.leftDays=365:l.leftDays=30};o.value==="zh-CN"?(a.currency="CNY",a.balance=t.balance_cny,a.packages=[...t.list_cn],a.packages.forEach(l=>{e(l),a.selectPackage.cn.push(B({},l))})):(a.currency="USD",a.balance=t.balance_usd,a.packages=[...t.list_en],a.packages.forEach(l=>{e(l),a.selectPackage.en.push(B({},l))}))}));function R(){let c=0,t=0;a.selectPackage.cn.length>0?a.selectPackage.cn.forEach(e=>{e.amount>0&&(c+=e.price*e.amount,t+=e.traffic*e.amount)}):a.selectPackage.en.forEach(e=>{e.amount>0&&(c+=e.price*e.amount,t+=e.traffic*e.amount)}),s.value=c,C.value=c,D.value=t}function V(){return w(this,null,function*(){_.setState({loading:!0});let c=s.value;b.value&&(c=a.balance>=s.value?0:Number((s.value-a.balance).toFixed(1)));const t={price:s.value,currency:a.currency,goods:[k.value],goods_type:a.currency==="CNY"?"monthly_packet_cn":"monthly_packet_en",customized:k.value.customized,upgrade:k.value.upgrade,balance_used:Number((s.value-c).toFixed(1)),auto_renew:y.value};T(t).then(e=>{_.setState({loading:!1}),e.finished?n.push({path:"/",query:{is_payed:"1"}}):n.push({name:"OrderDetail",query:{currency:a.currency,orderID:e.order_id,totalPrice:c,buyData:JSON.stringify(t.goods)}})}).catch(e=>{_.setState({loading:!1}),console.error(e)})})}function $(c){_.open(),k.value=c,s.value=Number(c.price)*c.amount}function j(){V()}return(c,t)=>(u(),Y(d(X),{description:d(h)("page.package.monthlyPackageSub"),"auto-content-height":""},{default:N(()=>[F(d(P),{title:d(h)("page.package.confirmCreate")},{default:N(()=>[k.value.upgrade?m("",!0):(u(),i(v,{key:0},[p("p",te,[g(r(d(h)("page.order.packageName"))+": ",1),p("span",se,r(k.value.subject),1)]),p("p",re,[p("span",oe,r(d(h)("page.package.totalMonths"))+": "+r(k.value.amount),1)]),p("p",ce,[p("span",ne,r(d(h)("page.package.totalPrice"))+": "+r(M.value),1)])],64)),a.balance>0?(u(),Y(d(E),{key:1,checked:b.value,"onUpdate:checked":t[0]||(t[0]=e=>b.value=e),disabled:s.value===0},{default:N(()=>[g(r(d(h)("page.package.useBalance"))+" ("+r(a.balance)+") ",1)]),_:1},8,["checked","disabled"])):m("",!0),F(d(E),{checked:y.value,"onUpdate:checked":t[1]||(t[1]=e=>y.value=e)},{default:N(()=>[g(r(d(h)("page.package.autoRenew")),1)]),_:1},8,["checked"])]),_:1},8,["title"]),(u(!0),i(v,null,ee(a.packages,e=>(u(),i("div",{key:e.subject,class:"border-border bg-background mb-5 flex items-center justify-between rounded-md border p-5"},[p("div",null,[p("div",le,[g(r(e.subject)+" ",1),e.original_price-e.price>0?(u(),i("span",ue,[a.currency==="CNY"?(u(),i(v,{key:0},[g(" 立减￥"+r((e.original_price-e.price).toFixed(2)),1)],64)):(u(),i(v,{key:1},[g(r(((e.original_price-e.price)/e.original_price*100).toFixed(1))+"% off ",1)],64))])):m("",!0)]),a.currency==="CNY"?(u(),i("span",de,r(e.leftDays)+"天有效 ",1)):(u(),i("span",pe,r(e.leftDays)+" days period ",1))]),p("div",null,[e.upgrade?(u(),i("span",ie,t[3]||(t[3]=[p("strong",null,"+",-1)]))):m("",!0),p("span",fe,r(a.currency==="CNY"?"￥":"$"),1),p("em",ge,r(e.price),1),e.price!==e.original_price?(u(),i("s",_e," ￥"+r(e.original_price),1)):m("",!0)]),p("div",ye,[e.upgrade?m("",!0):(u(),Y(d(L),{key:0,value:e.amount,"onUpdate:value":l=>e.amount=l,min:0,class:"w-16",onChange:t[2]||(t[2]=()=>R())},null,8,["value","onUpdate:value"])),F(d(J),{disabled:!e.amount||Number(e.amount)<=0,type:"primary",onClick:l=>$(e)},{default:N(()=>[a.currency==="CNY"?(u(),i(v,{key:0},[g(r(e.upgrade?"升級":"購買"),1)],64)):(u(),i(v,{key:1},[g(r(e.upgrade?"Upgrade":"Buy"),1)],64))]),_:2},1032,["disabled","onClick"])])]))),128))]),_:1},8,["description"]))}});export{De as default};
