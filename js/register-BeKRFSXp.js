var Y=Object.defineProperty;var $=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var q=(c,s,a)=>s in c?Y(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a,U=(c,s)=>{for(var a in s||(s={}))z.call(s,a)&&q(c,a,s[a]);if($)for(var a of $(s))H.call(s,a)&&q(c,a,s[a]);return c};var w=(c,s,a)=>new Promise((l,u)=>{var b=i=>{try{p(a.next(i))}catch(f){u(f)}},h=i=>{try{p(a.throw(i))}catch(f){u(f)}},p=i=>i.done?l(i.value):Promise.resolve(i.value).then(b,h);p((a=a.apply(c,s)).next())});import{u as J,T as K,_ as O,h as G,$ as e,a as Q,i as X,j as ee,k as L,l as te,m as E,n as ae,o as ne,s as oe,B as se,b as _,c as y,d as ie,g as re,p as ce,q as le,t as ue,e as me}from"./bootstrap-DeA6qr60.js";import{a5 as Z,Y as de,J as W,af as M,ag as he,w as P,ah as x,ab as g,b3 as pe,ai as S,al as F,au as A,av as C,R as d,a6 as fe,n as ge,ak as ve,S as we,e as R,bw as be,a$ as _e}from"../jse/index-index-CzcqLmIz.js";const Ce={class:"mt-4 text-center text-sm"},Te=Z({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},showThirdPartyLogin:{type:Boolean,default:!0},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["authRequest","submit"],setup(c,{expose:s,emit:a}){const l=c,u=a,[b,h]=J(de({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:W(()=>l.formSchema),showDefaultActions:!1})),p=Q();function i(){return w(this,null,function*(){const{valid:n}=yield h.validate(),v=yield h.getValues();n&&u("submit",v)})}function f(n){return w(this,null,function*(){u("authRequest",n)})}function k(){p.push(l.loginPath)}return s({getFormApi:()=>h}),(n,v)=>(M(),he("div",null,[P(K,null,{desc:x(()=>[S(n.$slots,"subTitle",{},()=>[A(C(n.subTitle||g(e)("authentication.signUpSubtitle")),1)])]),default:x(()=>[S(n.$slots,"title",{},()=>[A(C(n.title||g(e)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),P(g(b)),P(g(O),{class:pe([{"cursor-wait":l.loading},"mt-2 w-full"]),loading:l.loading,"aria-label":"register",onClick:i},{default:x(()=>[S(n.$slots,"submitButtonText",{},()=>[A(C(l.submitButtonText||g(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),S(n.$slots,"third-party-login",{},()=>[P(G,{"show-all":l.showThirdPartyLogin,onSubmit:f},null,8,["show-all"])]),F("div",Ce,[A(C(g(e)("authentication.alreadyHaveAccount"))+" ",1),F("span",{class:"vben-link text-sm font-normal",onClick:v[0]||(v[0]=V=>k())},C(g(e)("authentication.goToLogin")),1)])]))}}),Re=Z({name:"Register",__name:"register",setup(c){const{locale:s}=X(),a=ee(),l=d(!1),u=d(""),b=d(""),h=d(!1),p=d(!0),i=d(!0),f=d(),k=ne(),n=d(""),v=d(""),V=W(()=>[{component:we(me),componentProps:{placeholder:e("auth.console"),onChange:t=>{t&&(oe(t),p.value=!se.p0.includes(t))}},fieldName:"selectZone",label:e("auth.console"),rules:_().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:_().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(t,r){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>w(this,null,function*(){const o=r.errors.value;if(!t.email||o!=null&&o.email)throw y.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield ie({email:t.email,action:"signup"})}),createText:o=>o>0?e("authentication.sendText",[o]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"vcode",label:e("authentication.code"),rules:_().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:_().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{passwd:r}=t;return _().min(1,{message:e("authentication.passwordTip")}).refine(o=>o===r,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:_().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInput",componentProps:{placeholder:e("auth.inviter")},dependencies:{if:i.value},fieldName:"inviter",label:e("auth.inviter")},{component:"VbenInputCaptcha",componentProps:{imageUrl:b.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:I},dependencies:{if:h.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")},{component:"VbenCheckbox",fieldName:"contractChecked",label:"",defaultValue:!0,renderComponentContent:()=>({default:()=>[R("div",[R("span",`${e("auth.contract")}ã€Š`),R("a",{target:"view_window",class:"text-primary hover:text-primary-hover",href:s.value==="zh-CN"?"https://www.cdnbye.com/cn/contract.html":"https://www.cdnbye.com/guides/contract.html"},e("auth.contractName")),R("span","ã€‹")])]})}]);function I(){return w(this,null,function*(){const[,t]=yield be(re(u.value));u.value=t==null?void 0:t.captcha_id,b.value=t==null?void 0:t.captcha_url,h.value=!0})}function j(t){return w(this,null,function*(){var r;l.value=!0,n.value=t.inviter;try{if(t.email===n.value){y.error("inviter email is invalid");return}window.gtag("set","user_data",{email:t.email}),window.gtag("event","conversion",{send_to:"AW-10834653519"});const o=_e(U({utc:ce(),inviter:n.value||"",referer:v.value||void 0,captcha_id:u.value||"",captcha_value:t.captcha_value||""},t),["contractChecked","selectZone"]),m=yield le(o);yield a.register(m),y.success(e("auth.signUpSuccess")),window.gtag("event","conversion",{send_to:"AW-10834653519/i6W3CKPa8f4YEM_irq4o"})}catch(o){const{code:m}=(r=o==null?void 0:o.data)!=null?r:{};(m===4005||m===4019)&&(yield I())}finally{l.value=!1}})}function D(t){return w(this,null,function*(){if(!L()){y.error(e("auth.selectZoneWarn"));return}const{provider:r,inviter:o}=t;o&&E(o);const{url:m}=yield ue(r);location.href=m})}return fe(()=>{setTimeout(()=>{const{zone:t,inviter:r,source:o}=k.query,m=L();t&&m!==t&&(te(t),location.reload()),r?(E(r),n.value=r,i.value=!1):(n.value=ae(),i.value=!!n.value);const N=o||document.referrer;N&&(v.value=N),ge(()=>{var T,B;n.value&&((B=(T=f.value)==null?void 0:T.getFormApi)==null?void 0:B.call(T)).setValues({inviter:n.value})})},50)}),(t,r)=>(M(),ve(g(Te),{ref_key:"formRef",ref:f,"form-schema":V.value,loading:l.value,"show-third-party-login":p.value,onAuthRequest:D,onSubmit:j},null,8,["form-schema","loading","show-third-party-login"]))}});export{Re as default};
