var y=(M,v,s)=>new Promise((_,c)=>{var p=t=>{try{u(s.next(t))}catch(i){c(i)}},l=t=>{try{u(s.throw(t))}catch(i){c(i)}},u=t=>t.done?_(t.value):Promise.resolve(t.value).then(p,l);u((s=s.apply(M,v)).next())});import{s as w}from"./vue-json-excel.esm-Cj2DiqS1.js";import{B,$ as E}from"./bootstrap-PGBUDbCq.js";import{a5 as $,R as h,aW as g,Y as k,ah as C,ai as x,ab as d,bw as R,ag as A,n as f,ap as H,ar as S}from"../jse/index-index-BXx06mpc.js";import{f as U,D as j}from"./history-data-DWSSh01O.js";import{_ as F}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-B46w7Z0a.js";import{_ as G}from"./line-chart.vue_vue_type_script_setup_true_lang-CF6XgMcM.js";import{_ as O}from"./page.vue_vue_type_script_setup_true_lang-CXbajufZ.js";import"./app-o1KoIQWh.js";import"./domain-CJPK5SCV.js";import"./use-modal-CEA9RQg3.js";import"./x-Ba7vdtkv.js";import"./loading-btu9_ztw.js";import"./use-echarts-CjCgNJfX.js";const P={class:"md:pt-5"},ea=$({__name:"online-global",setup(M){const v=h("hour"),s=h([g().subtract(1,"hour"),g()]),_=h(),c=h(""),p=k({xData:[],yName:"online"}),l=k({}),u=k({});function t(){return y(this,arguments,function*(e=s.value[0],a=s.value[1]){const n={start_ts:i(e),end_ts:i(a)},[m,D]=yield R(U(0,n));if(m)return;const r=D.list;_.value=r,p.xData=[],l.online=[],r.forEach(o=>{p.xData.push(g(o.ts*1e3).format("MM-DD HH:mm")),l.online.push(o.value)})})}function i(e){return e.unix()}function V(e,a){t(e,a)}function b(){return y(this,null,function*(){const e=new Map;_.value.forEach(r=>{const o=g(r.ts*1e3).format("MM-DD"),N=e.get(o);(!N||N<r.value)&&e.set(o,r.value)});const a=[];let n=0,m=0;for(const[r,o]of e.entries())a.push({Date:r,Value:o}),n+=o,o!==0&&m++;let D=0;return m>0&&(D=Math.round(n/m)),a.push({Date:"Avg",Value:D}),c.value="Online Viewers Statistics.csv",a})}return t(),(e,a)=>(A(),C(d(O),{description:d(E)("page.history.data.descGlobal")},{extra:x(()=>[f(d(B),{class:"mt-1",type:"primary"},{default:x(()=>[f(d(w),{fetch:b,name:c.value,type:"csv"},{default:x(()=>a[2]||(a[2]=[H(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:x(()=>[f(F),S("div",P,[f(d(j),{date:v.value,"onUpdate:date":a[0]||(a[0]=n=>v.value=n),range:s.value,"onUpdate:range":a[1]||(a[1]=n=>s.value=n),month:!1,span:7,onChange:V},null,8,["date","range"])]),f(G,{data:l,"option-data":p,"second-data":u,class:"mt-6"},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ea as default};
