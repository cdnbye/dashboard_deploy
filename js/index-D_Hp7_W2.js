var k=(M,m,b)=>new Promise((S,y)=>{var P=l=>{try{C(b.next(l))}catch(p){y(p)}},c=l=>{try{C(b.throw(l))}catch(p){y(p)}},C=l=>l.done?S(l.value):Promise.resolve(l.value).then(P,c);C((b=b.apply(M,m)).next())});import{a as q,db as K,c as d,$ as e,bi as ce,j as me,u as F,b as j,d as H,x as T,y as W,aY as U,bo as ue,k as de}from"./bootstrap-Bp4MruiH.js";import{a5 as z,J as G,e as Q,af as N,ak as x,ah as r,al as h,ab as o,w as s,R as E,Y as pe,aW as fe,au as g,av as u,ag as J,F as ge,aj as L,ar as O}from"../jse/index-index-BHe_lL3g.js";import{i as he,j as be,k as ye,l as ve,m as we,n as Ce,r as _e}from"./app-Cu9ZmHFG.js";import{u as X}from"./form-BeSx5b3E.js";import{e as ee}from"./order-CbQADIyu.js";import{u as R}from"./use-modal-B-Ao7gAz.js";import{s as Ie}from"./format-C4DwKxE7.js";import{_ as Ne}from"./page.vue_vue_type_script_setup_true_lang-D2VWOXLO.js";import{D as Se,a as w}from"./index-BXP29FFL.js";import{C as Z}from"./index-CeLy5FJ9.js";import"./index-DBulDwZ_.js";import{R as Pe}from"./rotate-cw-TF79SxBM.js";import{C as ke}from"./copy-CrM-u4r3.js";import{P as xe}from"./index-C8B_6MgV.js";import{A as Te}from"./index-lOeUAjuF.js";import{c as Me}from"./copy-nKGD_wrT.js";import"./x-BohE-ELF.js";import"./loading-tj7ZoL7K.js";import"./responsiveObserve-BC50t68b.js";const Ae=["innerHTML"],De=z({__name:"recharge-modal-cn",setup(M){const m=G(()=>"CNY"),b=q(),[S,y]=X({layout:"vertical",handleSubmit:C,commonConfig:{componentProps:{class:"w-full"}},schema:[{component:"InputNumber",fieldName:"price",label:"Price",rules:K().min(100,{message:"最低充值金额为100"}).refine(l=>{const t=(m.value==="CNY"?/^(10\d|[1-9]\d\d|[1-9]\d\d\d|[1-9]\d\d\d\d)$/:/^[1-9]\d*0$/).test(`${l}`);return!t&&Number(l)>(m.value==="CNY"?100:10)&&(d.destroy("recharge"),d.warning({key:"recharge",content:Q("div",{innerHTML:`<div>${e("page.myInfo.rechargeTip")}</div>`})})),t})}],showDefaultActions:!1}),[P,c]=R({onConfirm:()=>k(this,null,function*(){yield y.submitForm()})});function C(l){return k(this,null,function*(){if(!(yield y.validate()).valid)return;c.setState({loading:!0});const f=m.value==="CNY",t=f?"充值人民幣":"Recharge USD",_=Number(l.price),v={price:_,currency:m.value,goods:[{subject:t,amount:1,price:_}],goods_type:f?"recharge_cny":"recharge_usd"};ee(v).then(I=>{b.push({name:"OrderDetail",query:{currency:m.value,orderID:I.order_id,totalPrice:_,buyData:JSON.stringify(v.goods)}}).then(()=>{c.close()})}).catch(I=>{console.error(I)}).finally(()=>{c.setState({loading:!1})})})}return(l,p)=>(N(),x(o(P),{title:o(e)("page.myInfo.recharge")},{description:r(()=>[h("div",{innerHTML:o(e)("page.myInfo.rechargeTip")},null,8,Ae)]),default:r(()=>[s(o(S),{class:"mx-4"})]),_:1},8,["title"]))}}),$e=["innerHTML"],Ye=z({__name:"recharge-modal-en",setup(M){const m=G(()=>"USD"),b=q(),[S,y]=X({layout:"vertical",handleSubmit:C,commonConfig:{componentProps:{class:"w-full"}},schema:[{component:"InputNumber",fieldName:"price",label:"Price",rules:K().min(10,{message:"The minimum recharge amount is 10"}).refine(l=>{const t=(m.value==="CNY"?/^(10\d|[1-9]\d\d|[1-9]\d\d\d|[1-9]\d\d\d\d)$/:/^[1-9]\d*0$/).test(`${l}`);return!t&&Number(l)>(m.value==="CNY"?100:10)&&(d.destroy("recharge"),d.warning({key:"recharge",content:Q("div",{innerHTML:`<div>${e("page.myInfo.rechargeTip")}</div>`})})),t})}],showDefaultActions:!1}),[P,c]=R({onConfirm:()=>k(this,null,function*(){yield y.submitForm()})});function C(l){return k(this,null,function*(){if(!(yield y.validate()).valid)return;c.setState({loading:!0});const f=m.value==="CNY",t=f?"充值人民幣":"Recharge USD",_=Number(l.price),v={price:_,currency:m.value,goods:[{subject:t,amount:1,price:_}],goods_type:f?"recharge_cny":"recharge_usd"};ee(v).then(I=>{b.push({name:"OrderDetail",query:{currency:m.value,orderID:I.order_id,totalPrice:_,buyData:JSON.stringify(v.goods)}}).then(()=>{c.close()})}).catch(I=>{console.error(I)}).finally(()=>{c.setState({loading:!1})})})}return(l,p)=>(N(),x(o(P),{title:o(e)("page.myInfo.recharge")},{description:r(()=>[h("div",{innerHTML:o(e)("page.myInfo.rechargeTip")},null,8,$e)]),default:r(()=>[s(o(S),{class:"mx-4"})]),_:1},8,["title"]))}}),Be={class:"flex flex-col gap-4 md:flex-row"},Fe={class:"flex items-center"},Ue={class:"flex items-center"},Oe={key:0},so=z({__name:"index",setup(M){const{locale:m}=ce(),[b,S]=R({connectedComponent:De}),[y,P]=R({connectedComponent:Ye}),c=E("changeUerName"),C=E([{key:"changeUerName",tab:e("page.myInfo.changeUerName")},{key:"changeEmail",tab:e("page.myInfo.changeEmail")},{key:"changePhone",tab:e("page.myInfo.changePhone")},{key:"changePwd",tab:e("page.myInfo.changePwd")}]),l=q(),p=me(),f=E(!1),t=pe({time:"",email:"",mobile:"",ncode:"",token:"",utc:"",name:"",balanceCNY:"",balanceUSD:"",visitorCode:"",autoRenew:""}),[_,v]=F({actionWrapperClass:"text-left",commonConfig:{componentProps:{class:"w-full"}},handleSubmit:a=>{const n={passwd:Ie(a.passwd),newpasswd:a.newpasswd};v.setState({submitButtonOptions:{loading:!0}}),he(n).then(()=>{v.setState({submitButtonOptions:{loading:!1}}),d.success(e("common.success")),v.resetForm()}).catch(i=>{v.setState({submitButtonOptions:{loading:!1}}),console.error(i)})},layout:"vertical",schema:[{component:"Input",fieldName:"passwd",label:e("page.myInfo.changePasswd.old"),rules:"required"},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"newpasswd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:j().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(a){const{newpasswd:n}=a;return j({required_error:e("authentication.passwordTip")}).min(1,{message:e("authentication.passwordTip")}).refine(i=>i===n,{message:e("authentication.confirmPasswordTip")})},triggerFields:["newpasswd"]},fieldName:"confirmPassword",label:e("authentication.confirmPassword")}],wrapperClass:"grid-cols-1"}),[I,A]=F({actionWrapperClass:"text-left",commonConfig:{componentProps:{class:"w-full"}},handleSubmit:a=>{A.setState({submitButtonOptions:{loading:!0}}),be(a).then(()=>{d.success(e("common.success")),A.setState({submitButtonOptions:{loading:!1}}),t.name=a.name,A.resetForm(),p.fetchUserInfo(),Y()}).catch(n=>{A.setState({submitButtonOptions:{loading:!1}}),console.error(n)})},layout:"vertical",schema:[{component:"Input",fieldName:"name",label:e("page.myInfo.changeName.newName"),rules:"required"}],wrapperClass:"grid-cols-1"}),[oe,D]=F({commonConfig:{componentProps:{class:"w-full"}},handleSubmit:a=>{D.setState({submitButtonOptions:{loading:!0}});const{email:n,vcode:i}=a,B={email:n,vcode:i.toString()};ye(B).then(()=>{d.success(e("common.success")),D.setState({submitButtonOptions:{loading:!1}}),t.email=n,D.resetForm(),p.fetchUserInfo(),Y()}).catch(V=>{D.setState({submitButtonOptions:{loading:!1}}),console.error(V)})},actionWrapperClass:"text-left",layout:"vertical",schema:[{component:"Input",fieldName:"email",label:e("page.myInfo.changeMail.newMail"),rules:"required"},{component:"VbenPinInput",componentProps(a,n){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>k(this,null,function*(){const i=n.errors.value;if(!a.email||i!=null&&i.email)throw d.error(e("auth.usernameError")),new Error(e("auth.usernameError"));if(a.email===t.email){d.error(e("page.myInfo.changeMail.sameError"));return}yield H({email:a.email,action:"email_update"})}),createText:i=>i>0?e("authentication.sendText",[i]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn"},{component:"Input",fieldName:"vcode",label:e("page.myInfo.changeMail.code"),rules:"required"}],wrapperClass:"grid-cols-1"}),[te,$]=F({actionWrapperClass:"text-left",commonConfig:{labelWidth:120,componentProps:{class:"w-full"}},handleSubmit:a=>{$.setState({submitButtonOptions:{loading:!0}});const{mobile:n,ncode:i,vcode:B}=a,V={mobile:n,ncode:Number(i),vcode:B.toString()};ve(V).then(()=>{d.success(e("common.success")),$.setState({submitButtonOptions:{loading:!1}}),t.mobile=n,$.resetForm(),p.fetchUserInfo(),Y()}).catch(le=>{$.setState({submitButtonOptions:{loading:!1}}),console.error(le)})},layout:"vertical",schema:[{component:"Input",fieldName:"ncode",label:e("page.myInfo.changeMobile.cc"),rules:"required"},{component:"Input",fieldName:"mobile",label:e("page.myInfo.changeMobile.number"),rules:"required"},{component:"VbenPinInput",componentProps(a){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>k(this,null,function*(){if(!a.mobile||a.ncode===0)throw d.error(e("page.myInfo.changeMobile.someError")),e("page.myInfo.changeMobile.someError");yield H({email:t.email,action:"mobile_update",mobile:a.mobile,ncode:Number(a.ncode)})}),createText:n=>n>0?e("authentication.sendText",[n]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn"},{component:"Input",fieldName:"vcode",label:e("page.myInfo.changeMail.code"),rules:"required"}],wrapperClass:"grid-cols-1"});function Y(){f.value=!0,we().then(a=>{t.time=fe(a.reg_date*1e3).format("YYYY-MM-DD hh:mm:ss"),t.email=a.email,t.mobile=a.mobile,t.ncode=a.ncode,t.token=a.token,t.utc=a.utc,t.name=a.name,t.balanceCNY=a.balance_cny,t.balanceUSD=a.balance_usd,t.visitorCode=a.visitor_code,t.autoRenew=a.auto_renew}).catch(a=>{console.error(a)}).finally(()=>{f.value=!1})}function ae(){l.push("/user/invoice")}function ne(a){c.value=a}function se(){const a=()=>{_e().then(n=>{t.visitorCode=n.visitor_code,d.success(e("common.success"))})};t.visitorCode?ue.confirm({title:e("page.myInfo.resetVisitorCodeTip"),onOk:()=>{a()}}):a()}function re(){if(!t.visitorCode){d.error(e("page.myInfo.visitorCodeError"));return}const i=`${location.hostname.includes("localhost")?`${location.origin}/login`:`${location.origin+location.pathname}#/login`}?zone=${de()}&email=${encodeURIComponent(t.email)}&visitor_code=${t.visitorCode}`;Me(i)}function ie(){Ce().then(()=>{d.success(e("common.success"))}),t.autoRenew=""}return Y(),(a,n)=>(N(),x(o(Ne),{"auto-content-height":"","content-class":"overflow-y-auto"},{default:r(()=>[s(o(b)),s(o(y)),h("div",Be,[s(o(Z),{loading:f.value,class:"w-full md:w-2/5"},{default:r(()=>[s(o(Se),{column:1},{default:r(()=>[s(o(w),{label:o(e)("page.myInfo.name")},{default:r(()=>[g(u(t.name),1)]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.mail")},{default:r(()=>[g(u(t.email),1)]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.mobile")},{default:r(()=>[h("div",Fe,[t.mobile?(N(),J(ge,{key:0},[g(" +"+u(t.ncode)+u(t.mobile),1)],64)):(N(),x(o(T),{key:1,size:"small",type:"link",onClick:n[0]||(n[0]=i=>c.value="changePhone")},{default:r(()=>[g(u(o(e)("page.myInfo.mobileBonus")),1)]),_:1}))])]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.time")},{default:r(()=>[g(u(t.time),1)]),_:1},8,["label"]),s(o(w),{label:"Token"},{default:r(()=>[s(o(W),null,{default:r(()=>[g(u(t.token),1)]),_:1})]),_:1}),s(o(w),{label:o(e)("page.myInfo.timeZone")},{default:r(()=>[g(" UTC"+u(t.utc>=0?"+":"")+u(t.utc),1)]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.balanceUSD")},{default:r(()=>[h("span",null,u(t.balanceUSD),1),s(o(T),{class:"ml-2",size:"small",type:"primary",onClick:n[1]||(n[1]=()=>o(P).open())},{default:r(()=>[g(u(o(e)("page.myInfo.recharge")),1)]),_:1})]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.balanceCNY")},{default:r(()=>[h("span",null,u(t.balanceCNY),1),s(o(T),{class:"ml-2",size:"small",type:"primary",onClick:n[2]||(n[2]=()=>o(S).open())},{default:r(()=>[g(u(o(e)("page.myInfo.recharge")),1)]),_:1})]),_:1},8,["label"]),s(o(w),{label:o(e)("page.myInfo.visitorCode")},{default:r(()=>[h("div",Ue,[s(o(W),null,{default:r(()=>[g(u(t.visitorCode),1)]),_:1}),s(o(Pe),{class:"hover:text-primary ml-1.5 size-4 cursor-pointer md:ml-3",onClick:se}),s(o(ke),{class:"hover:text-primary ml-1.5 size-4 cursor-pointer md:ml-3",onClick:re})])]),_:1},8,["label"]),t.autoRenew?(N(),x(o(w),{key:0,label:o(e)("page.myInfo.autoRenew")},{default:r(()=>[s(o(xe),{"cancel-text":o(e)("common.cancel"),"ok-text":o(e)("common.ok"),title:o(e)("common.sureCancel"),onConfirm:n[3]||(n[3]=i=>ie())},{default:r(()=>[s(o(T),{class:"ml-2",size:"small",type:"primary"},{default:r(()=>[g(u(o(e)("common.cancel")),1)]),_:1})]),_:1},8,["cancel-text","ok-text","title"])]),_:1},8,["label"])):L("",!0)]),_:1}),o(m)!=="en-US"?(N(),J("p",Oe,[s(o(T),{type:"primary",onClick:n[4]||(n[4]=i=>ae())},{default:r(()=>n[6]||(n[6]=[g("发票管理")])),_:1})])):L("",!0)]),_:1},8,["loading"]),s(o(Z),{"active-tab-key":c.value,loading:f.value,"tab-list":C.value,class:"w-full md:w-3/5",size:"small",onTabChange:n[5]||(n[5]=i=>ne(i))},{default:r(()=>[O(h("div",null,[s(o(I))],512),[[U,c.value==="changeUerName"]]),O(h("div",null,[s(o(oe))],512),[[U,c.value==="changeEmail"]]),O(h("div",null,[t.mobile?L("",!0):(N(),x(o(Te),{key:0,message:o(e)("page.myInfo.mobileBonus"),class:"mb-4",type:"info"},null,8,["message"])),s(o(te))],512),[[U,c.value==="changePhone"]]),O(h("div",null,[s(o(_))],512),[[U,c.value==="changePwd"]])]),_:1},8,["active-tab-key","loading","tab-list"])])]),_:1}))}});export{so as default};
