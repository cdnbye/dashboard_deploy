import{bi as S,bo as U,$ as p,o as $,a as q}from"./bootstrap-DeA6qr60.js";import{g as C,h as R}from"./app-Cb8ElKsu.js";import{c as F,d as K,b as A}from"./live-data-Bh39d9WF.js";import{_ as P}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-BofGraDz.js";import{u as M}from"./app-VxdAdBdL.js";import{_ as G}from"./distribution-global.vue_vue_type_script_setup_true_lang-DJ8JKZWr.js";import{_ as L}from"./live-time.vue_vue_type_script_setup_true_lang-CoeozBTG.js";import"./index-Bc2jJlDb.js";import{_ as O}from"./page.vue_vue_type_script_setup_true_lang-BWmwqVvU.js";import{a5 as W,R as m,a6 as J,J as N,a7 as V,X,af as j,ak as z,ah as E,ab as B,w as d}from"../jse/index-index-CzcqLmIz.js";import{a as l,f as _}from"./format-DJrBM6zj.js";import"./use-modal-BsOGb2Oz.js";import"./x-2ADArCZp.js";import"./loading-DGZVBrfc.js";import"./domain-B7_Ux_YD.js";import"./pie-card.vue_vue_type_script_setup_true_lang-Bd9XSQF-.js";import"./pie-chart.vue_vue_type_script_setup_true_lang-C-ZMl939.js";import"./use-echarts-BOIKCwlj.js";import"./index-BvfL_Cr9.js";import"./live-card.vue_vue_type_script_setup_true_lang-C-9ifQA9.js";const ha=W({__name:"per-app",setup(H){const h=$(),y=q(),f=M(),{locale:I}=S(),D=m(!1),w=m(!0),n=m({whiteList:!1,type:{product_type:0,time:""},online:0,traffic_p2p:{num:0,unit:"KB"},traffic_http:{num:0,unit:"KB"},traffic_share:{num:0,unit:"KB"},frequency_day:0,num_max:0,rebuffer_ratio:-1,flow:{remain:0,daily_remain:0,totalRemain:0,free:{num:0,unit:"KB"},utc:0},clock:null,traffic_p2p_day:0,traffic_http_day:0}),i=m({versionData:[],tagData:[],deviceData:[],liveData:[],netTypeData:[],domainData:[],natTypeData:[],continentData:[]});J(()=>{const{params:t}=h,r=t.domainInfo;r&&r.uid?(g(r.id,t.hostId),b(!0),f.setCurrentDomain(r)):T()});const v=N(()=>{var r;const t=f.currentDomain;return(r=t==null?void 0:t.domain)==null?void 0:r.endsWith(".superpeer")});let u;function g(t,r){k(t,r),clearInterval(u),u=setInterval(()=>{k(t,r)},2e4)}V(()=>{clearInterval(u)}),X(()=>f.currentDomain,()=>{h.params.hostId===void 0&&(clearInterval(u),T())});function b(t,r=-1,x=!1){const{id:a,native:c}=t,s=r>=0?(o,e)=>F(r,{type:o,lang:e}):(o,e)=>K(a,{type:o,lang:e});s("version").then(o=>{const e=o.data;i.value.versionData=e?l(e):[]}),s("tag").then(o=>{const e=o.data;i.value.tagData=e?l(e):[]}),!c&&!v.value?s("device").then(o=>{const e=o.data;i.value.deviceData=e?l(e):[]}):i.value.deviceData=[],s("live").then(o=>{const e=o.data;i.value.liveData=e?l(e):[]}),s("continent",I.value!=="en-US"?"cn":"en").then(o=>{const e=o.data;i.value.continentData=e?l(e):[]}),v.value?i.value.netTypeData=[]:s("netType").then(o=>{const e=o.data;i.value.netTypeData=e?l(e):[]}),c?s("nat").then(o=>{const e=o.data;i.value.natTypeData=e?l(e):[]}):i.value.natTypeData=[],t.domain.startsWith("shadow@")?(D.value=!0,(x?()=>C():()=>R())().then(e=>{i.value.domainData=e?l(e):[]})):(i.value.domainData=[],D.value=!1)}function k(t,r){(r>=0?()=>A(r):()=>A(t))().then(a=>{if(n.value.online=a.num_rt,n.value.traffic_p2p_day=a.traffic_p2p_day,n.value.traffic_http_day=a.traffic_http_day,n.value.traffic_p2p=_(a.traffic_p2p_day),n.value.traffic_http=_(a.traffic_http_day),n.value.traffic_share=_(a.traffic_share_day),n.value.frequency_day=a.api_frequency_day,n.value.rebuffer_ratio=a.total_rebuffers!==0&&a.total_media_requests!==0?a.total_rebuffers/a.total_media_requests:-1,n.value.num_max=a.num_max,n.value.flow.remain=a.flow.remain,n.value.flow.daily_remain=a.flow.daily_remain,n.value.flow.totalRemain=a.flow.daily_remain+a.flow.remain,n.value.flow.free=_(a.flow.free),n.value.flow.utc=a.flow.utc,n.value.whiteList=a.whitelist,n.value.type.product_type=a.flow.product_type,n.value.type.time=a.flow.duetime,n.value.clock=a.clock,a.flow.free===0&&a.flow.remain===0&&a.flow.daily_remain===0&&w.value&&!a.whitelist){const c=U.confirm({maskClosable:!1,closable:!0,cancelButtonProps:{type:"primary"},title:p("page.dashboard.trafficUseOut"),okText:p("page.package.buyFlow"),cancelText:p("page.package.buyMonthly"),onOk(){y.push("/shopping/package")},onCancel:s=>{c.destroy(),s!=null&&s.name&&y.push("/shopping/monthly-package")}});w.value=!1}}).catch(a=>{console.error(a)})}function T(){const t=f.currentDomain;t!=null&&t.id&&(g(t.uid,t.id),b(t))}return(t,r)=>(j(),z(B(O),{description:B(p)("page.dashboard.descPerApp"),"auto-content-height":"","content-class":"overflow-y-auto"},{default:E(()=>[d(P),d(L,{global:!1,"is-super-peer":v.value,statis:n.value},null,8,["is-super-peer","statis"]),d(G,{data:i.value},null,8,["data"])]),_:1},8,["description"]))}});export{ha as default};
