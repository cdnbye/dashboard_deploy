var L=Object.defineProperty;var R=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var B=(i,s,a)=>s in i?L(i,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[s]=a,$=(i,s)=>{for(var a in s||(s={}))j.call(s,a)&&B(i,a,s[a]);if(R)for(var a of R(s))z.call(s,a)&&B(i,a,s[a]);return i};var C=(i,s,a)=>new Promise((u,m)=>{var b=r=>{try{l(a.next(r))}catch(f){m(f)}},d=r=>{try{l(a.throw(r))}catch(f){m(f)}},l=r=>r.done?u(r.value):Promise.resolve(r.value).then(b,d);l((a=a.apply(i,s)).next())});import{u as D,a as O,$ as e,T as H,_ as J,h as Y,i as G,j as K,k as Q,l as W,m as X,n as ee,M as te,o as ae,b as F,c as ne,s as oe,d as w,e as se,g as ie}from"./bootstrap-SKctUie3.js";import"./index-D1GUi0xR.js";import{a5 as E,Y as re,J as M,ag as Z,am as ce,n as k,ai as V,aj as x,ap as y,aq as T,ab as h,b3 as le,ar as U,R as p,a6 as ue,q as me,ah as de,b1 as pe,S as he,e as S,bw as fe}from"../jse/index-index-0SEuuMhD.js";const ge={class:"mt-4 text-center text-sm"},ve=E({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["submit"],setup(i,{expose:s,emit:a}){const u=i,m=a,[b,d]=D(re({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:M(()=>u.formSchema),showDefaultActions:!1})),l=O();function r(){return C(this,null,function*(){const{valid:n}=yield d.validate(),g=yield d.getValues();n&&m("submit",g)})}function f(){l.push(u.loginPath)}return s({getFormApi:()=>d}),(n,g)=>(Z(),ce("div",null,[k(H,null,{desc:V(()=>[x(n.$slots,"subTitle",{},()=>[y(T(n.subTitle||h(e)("authentication.signUpSubtitle")),1)])]),default:V(()=>[x(n.$slots,"title",{},()=>[y(T(n.title||h(e)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),k(h(b)),k(h(J),{class:le([{"cursor-wait":n.loading},"mt-2 w-full"]),loading:n.loading,"aria-label":"register",onClick:r},{default:V(()=>[x(n.$slots,"submitButtonText",{},()=>[y(T(n.submitButtonText||h(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),U("div",ge,[y(T(h(e)("authentication.alreadyHaveAccount"))+" ",1),U("span",{class:"vben-link text-sm font-normal",onClick:g[0]||(g[0]=N=>f())},T(h(e)("authentication.goToLogin")),1)])]))}}),Pe=E({name:"Register",__name:"register",setup(i){const{locale:s}=Y(),a=G(),u=p(!1),m=p(""),b=p(""),d=p(!1),l=p(!0),r=p(),f=K(),n=p(""),g=p(""),N=M(()=>[{component:he(ne),componentProps:{placeholder:e("auth.console"),onChange:t=>{t&&oe(t)}},fieldName:"selectZone",label:e("auth.console"),rules:w().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:w().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(t,c){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>C(this,null,function*(){const o=c.errors.value;if(!t.email||o!=null&&o.email)throw F.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield se({email:t.email,action:"signup"})}),createText:o=>o>0?e("authentication.sendText",[o]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"vcode",label:e("authentication.code"),rules:w().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:w().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{passwd:c}=t;return w().min(1,{message:e("authentication.passwordTip")}).refine(o=>o===c,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:w().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInput",componentProps:{placeholder:e("auth.inviter")},dependencies:{if:l.value},fieldName:"inviter",label:e("auth.inviter")},{component:"VbenInputCaptcha",componentProps:{imageUrl:b.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:I},dependencies:{if:d.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")},{component:"VbenCheckbox",fieldName:"contractChecked",label:"",defaultValue:!0,renderComponentContent:()=>({default:()=>[S("div",[S("span",`${e("auth.contract")}ã€Š`),S("a",{target:"view_window",class:"text-primary hover:text-primary-hover",href:s.value==="zh-CN"?"https://www.cdnbye.com/cn/contract.html":"https://www.cdnbye.com/guides/contract.html"},e("auth.contractName")),S("span","ã€‹")])]})}]);function I(){return C(this,null,function*(){const[,t]=yield fe(ie(m.value));m.value=t==null?void 0:t.captcha_id,b.value=t==null?void 0:t.captcha_url,d.value=!0})}function q(t){return C(this,null,function*(){var c;u.value=!0;try{if(t.email===n.value){te.confirm({title:"inviter email is invalid",content:"inviter email is invalid"});return}let o=new Date().getTimezoneOffset()/60*-1;o===-12&&(o=12);const v=pe($({utc:Math.round(o),inviter:n.value||"",referer:g.value||void 0,captcha_id:m.value||"",captcha_value:t.captcha_value||""},t),["contractChecked","selectZone"]),_=yield ae(v);yield a.register(_),F.success(e("auth.signUpSuccess"))}catch(o){const{code:v}=(c=o==null?void 0:o.data)!=null?c:{};(v===4005||v===4019)&&(yield I())}finally{u.value=!1}})}return ue(()=>{setTimeout(()=>{const{zone:t,inviter:c,source:o}=f.query,v=Q();t&&v!==t&&(W(t),location.reload()),c?(X(c),n.value=c,l.value=!1):(n.value=ee(),l.value=!!n.value);const _=o||document.referrer;_&&(g.value=_),me(()=>{var P,A;n.value&&((A=(P=r.value)==null?void 0:P.getFormApi)==null?void 0:A.call(P)).setValues({inviter:n.value})})},50)}),(t,c)=>(Z(),de(h(ve),{ref_key:"formRef",ref:r,"form-schema":N.value,loading:u.value,onSubmit:q},null,8,["form-schema","loading"]))}});export{Pe as default};
