var M=(N,v,o)=>new Promise((_,u)=>{var p=t=>{try{l(o.next(t))}catch(i){u(i)}},m=t=>{try{l(o.throw(t))}catch(i){u(i)}},l=t=>t.done?_(t.value):Promise.resolve(t.value).then(p,m);l((o=o.apply(N,v)).next())});import{s as b}from"./vue-json-excel.esm-CcnyQd11.js";import{$ as A,x as B}from"./bootstrap-CiyWlmzu.js";import{a5 as C,R as g,aW as y,Y as w,X as R,af as S,ak as H,ah as k,ab as f,bw as U,w as D,au as j,al as F}from"../jse/index-index-DX6TcLw_.js";import{f as G,D as I}from"./history-data-VO5vgTyI.js";import{_ as O}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-Rh6TKeIQ.js";import{u as P}from"./app-CWvsWFBj.js";import{_ as T}from"./line-chart.vue_vue_type_script_setup_true_lang-BXyxGZ8S.js";import{_ as W}from"./page.vue_vue_type_script_setup_true_lang-CQ_GieV6.js";import"./use-modal-DGRkTv3G.js";import"./x-COcrQ3Ng.js";import"./loading-C3dzF5Xb.js";import"./domain-DxFU4Atk.js";import"./use-echarts-BugotcPs.js";const X={class:"md:pt-5"},ra=C({__name:"online",setup(N){const v=g("hour"),o=g([y().subtract(1,"hour"),y()]),_=g(),u=g(""),p=w({xData:[],yName:"online"}),m=w({}),l=w({}),t=P();R(()=>t.currentDomain,()=>{i()},{deep:!0});function i(){return M(this,arguments,function*(e=o.value[0],a=o.value[1]){var n;const s={start_ts:$(e),end_ts:$(a)},c=(n=t.currentDomain)==null?void 0:n.id;if(!c)return;const[h,x]=yield U(G(c,s));if(h)return;const r=x.list;_.value=r,p.xData=[],m.online=[],r.forEach(d=>{p.xData.push(y(d.ts*1e3).format("MM-DD HH:mm")),m.online.push(d.value)})})}function $(e){return e.unix()}function E(e,a){i(e,a)}function V(){return M(this,null,function*(){var x;const e=new Map;_.value.forEach(r=>{const n=y(r.ts*1e3).format("MM-DD"),d=e.get(n);(!d||d<r.value)&&e.set(n,r.value)});const a=[];let s=0,c=0;for(const[r,n]of e.entries())a.push({Date:r,Value:n}),s+=n,n!==0&&c++;let h=0;return c>0&&(h=Math.round(s/c)),a.push({Date:"Avg",Value:h}),u.value=`Online Statistics(${(x=t.currentDomain)==null?void 0:x.domain}).csv`,a})}return i(),(e,a)=>(S(),H(f(W),{description:f(A)("page.history.data.descGlobal")},{extra:k(()=>[D(f(B),{class:"mt-1",type:"primary"},{default:k(()=>[D(f(b),{fetch:V,name:u.value,type:"csv"},{default:k(()=>a[2]||(a[2]=[j(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:k(()=>[D(O),F("div",X,[D(f(I),{date:v.value,"onUpdate:date":a[0]||(a[0]=s=>v.value=s),range:o.value,"onUpdate:range":a[1]||(a[1]=s=>o.value=s),month:!1,span:7,onChange:E},null,8,["date","range"])]),D(T,{data:m,"option-data":p,"second-data":l,class:"mt-6"},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ra as default};
