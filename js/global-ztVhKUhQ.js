import{j as R,a as S,q as $,bX as U,M as l,$ as s,bb as q}from"./bootstrap-SKctUie3.js";import{b as B,e as G}from"./app-CCjOiP5P.js";import{a as C,b as F,c as O,d as P}from"./live-data-C00SR-vA.js";import{c as v,u as L}from"./order-syVOYIXv.js";import{_ as M}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-1kM5Hddw.js";import{_ as K}from"./checkin-button.vue_vue_type_script_setup_true_lang-BZ08RVgK.js";import{_ as j}from"./distribution-global.vue_vue_type_script_setup_true_lang-f9-C1ylQ.js";import{_ as N}from"./live-time.vue_vue_type_script_setup_true_lang-zawvCrB9.js";import"./index-D1GUi0xR.js";import{f as k,a as p}from"./format-BqMbAHXG.js";import{_ as V}from"./page.vue_vue_type_script_setup_true_lang-Dgq6zLp-.js";import{a5 as X,R as m,a6 as z,a7 as E,ah as H,ai as g,ab as _,ag as J,n as u}from"../jse/index-index-0SEuuMhD.js";import"./app-Bz8GH1Kr.js";import"./domain-Cy3FhfO2.js";import"./use-modal-CeNy_I9O.js";import"./x-Cpey3BCi.js";import"./loading-BVj1NiH4.js";import"./pie-card.vue_vue_type_script_setup_true_lang-o-41GKuw.js";import"./pie-chart.vue_vue_type_script_setup_true_lang-DVkj6Fhf.js";import"./use-echarts-ZPUl1qtN.js";import"./index-D9JCg-gS.js";import"./live-card.vue_vue_type_script_setup_true_lang-m19gqgGR.js";const ke=X({__name:"global",setup(Q){const d=R(),y=S(),I=$(),{locale:T}=U(),i=m(!1),b=m(!0),r=m({whiteList:!1,type:{product_type:0,time:""},online:0,traffic_p2p:{num:0,unit:"KB"},traffic_http:{num:0,unit:"KB"},frequency_day:0,num_max:0,rebuffer_ratio:-1,flow:{remain:0,daily_remain:0,totalRemain:0,free:{num:0,unit:"KB"},utc:0},clock:null,traffic_p2p_day:0,traffic_http_day:0}),c=m({domainData:[],versionData:[],deviceData:[],liveData:[],netTypeData:[],ispData:[]});z(()=>{const{params:t}=d;t.domainInfo?(w(!0),x(!0)):(w(0),x())});let h;function w(t){D(t),clearInterval(h),h=setInterval(()=>{D(t)},2e4)}E(()=>{clearInterval(h)});function D(t){(t?()=>C(0):()=>F(0))().then(a=>{if(r.value.online=a.num_rt,r.value.traffic_p2p_day=a.traffic_p2p_day,r.value.traffic_http_day=a.traffic_http_day,r.value.traffic_p2p=k(a.traffic_p2p_day),r.value.traffic_http=k(a.traffic_http_day),r.value.frequency_day=a.api_frequency_day,r.value.num_max=a.num_max,r.value.flow.remain=a.flow.remain,r.value.flow.daily_remain=a.flow.daily_remain,r.value.flow.totalRemain=a.flow.daily_remain+a.flow.remain,r.value.flow.free=k(a.flow.free),r.value.flow.utc=a.flow.utc,r.value.whiteList=a.whitelist,r.value.type.product_type=a.flow.product_type,r.value.type.time=a.flow.duetime,r.value.clock=a.clock,a.flow.free===0&&a.flow.remain===0&&a.flow.daily_remain===0&&b.value&&d.query.payment===void 0&&!a.whitelist){const n=l.confirm({maskClosable:!1,closable:!0,title:s("page.dashboard.trafficUseOut"),okText:s("page.package.buyFlow"),cancelText:s("page.package.buyMonthly"),cancelButtonProps:{type:"primary"},onOk(){y.push("/shopping/package")},onCancel:o=>{n.destroy(),o!=null&&o.name&&y.push("/shopping/monthly-package")}});b.value=!1}}).catch(a=>{console.error(a)})}function x(t){const e=t?n=>O(0,{type:n}):(n,o)=>P(0,{type:n,lang:o});(t?()=>B():()=>G())().then(n=>{c.value.domainData=n?p(n):[]}),e("version").then(n=>{const o=n.data;c.value.versionData=o?p(o):[]}),e("device").then(n=>{const o=n.data;c.value.deviceData=o?p(o):[]}),e("live").then(n=>{const o=n.data;c.value.liveData=o?p(o):[]}),e("netType").then(n=>{const o=n.data;c.value.netTypeData=o?p(o):[]}),e("isp",T.value==="en-US"?"en":"").then(n=>{const o=n.data;c.value.ispData=o?p(o):[]})}function f(t){i.value=!1,t.is_payed?l.info({title:s("page.package.paySuccess"),okText:s("common.ok"),onOk(){y.push("/")}}):t.processing?l.success({title:s("page.package.payPending"),okText:s("common.ok")}):l.error({title:s("page.package.payFail"),okText:s("common.ok")})}function A(){const t=d.query;if(t.cancel){l.error({title:s("page.package.paySuspended"),okText:s("common.ok")});return}if(t.is_payed&&l.success({title:s("page.package.paySuccess"),okText:s("common.ok")}),t.payment)switch(i.value=!0,t.payment){case"alipay":{v("alipay",t.out_trade_no).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"coinbase":case"coinpayments":case"cryptomus":case"nowpayments":{if(!t.orderId){i.value=!1;return}L({uid:Number.parseInt(`${I.accessUserId}`),order_id:t.orderId.split("?")[0],processing:!0}).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"paypal":{v("paypal",t.orderId).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}case"stripe":{v("stripe",t.orderId).then(e=>{f(e)}).catch(e=>{i.value=!1,console.error(e)});break}default:{i.value=!1;break}}}return A(),(t,e)=>(J(),H(_(V),{description:_(s)("page.dashboard.descGlobal"),"auto-content-height":"","content-class":"overflow-y-auto"},{extra:g(()=>[u(K)]),default:g(()=>[u(M),u(_(q),{spinning:i.value,tip:_(s)("page.package.checkResultLoadingTip")},{default:g(()=>[u(N,{statis:r.value,global:""},null,8,["statis"]),u(j,{data:c.value},null,8,["data"])]),_:1},8,["spinning","tip"])]),_:1},8,["description"]))}});export{ke as default};
