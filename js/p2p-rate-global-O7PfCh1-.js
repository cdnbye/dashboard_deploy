var E=(F,l,r)=>new Promise((f,m)=>{var x=e=>{try{n(r.next(e))}catch(d){m(d)}},t=e=>{try{n(r.throw(e))}catch(d){m(d)}},n=e=>e.done?f(e.value):Promise.resolve(e.value).then(x,t);n((r=r.apply(F,l)).next())});import{s as V}from"./vue-json-excel.esm-Cj2DiqS1.js";import{B as G,$ as L}from"./bootstrap-PGBUDbCq.js";import{a5 as O,R as P,aW as b,Y as H,J as S,ah as U,ai as k,ab as _,bw as j,ag as I,n as D,ap as J,ar as W}from"../jse/index-index-BXx06mpc.js";import{a as Y,b as q,D as z}from"./history-data-DWSSh01O.js";import{_ as K}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-B46w7Z0a.js";import{_ as Q}from"./line-chart.vue_vue_type_script_setup_true_lang-CF6XgMcM.js";import{f as X,g as N}from"./format-B0PhllUt.js";import{_ as Z}from"./page.vue_vue_type_script_setup_true_lang-CXbajufZ.js";import"./app-o1KoIQWh.js";import"./domain-CJPK5SCV.js";import"./use-modal-CEA9RQg3.js";import"./x-Ba7vdtkv.js";import"./loading-btu9_ztw.js";import"./use-echarts-CjCgNJfX.js";const aa={class:"md:pt-5"},ha=O({__name:"p2p-rate-global",setup(F){const l=P("week"),r=P([b().startOf("day").subtract(1,"week"),b().startOf("day")]),f=P(),m=P(),x=P(""),t=H({xData:[],unit:"%",yName:"Traffic"}),n=H({}),e=H({}),d=S(()=>l.value==="week"||l.value==="month");function A(){return E(this,arguments,function*(p=r.value[0],a=r.value[1]){t.xData=[],n.P2P=[],n.HTTP=[],e.ratio=[];let u=5;d.value&&(u=1440);const v=0,h={start_ts:B(p),end_ts:B(a),gran:u},[y,$]=yield j(Promise.all([Y(v,h),q(v,h)]));if(y)return;const[w,c]=$,s=w.list;f.value=s;const i=c.list;if(m.value=i,!s||!i)return;const g=[...s].sort((o,T)=>o.value-T.value);t.unit=X(g[g.length-1].value).unit,i.forEach(o=>{n.P2P.push(N(o.value,t.unit))}),s.forEach(o=>{t.xData.push(b(o.ts*1e3).format("MM-DD")),n.HTTP.push(N(o.value,t.unit))}),i.forEach((o,T)=>{const M=o.value>0&&s[T]?o.value/(o.value+s[T].value):0;e.ratio.push(Number((M*100).toFixed(1)))})})}function B(p){return p.unix()}function R(p,a){A(p,a)}function C(){return E(this,null,function*(){const p=[];m.value.forEach((c,s)=>{p.push({ts:c.ts,p2p:c.value,http:f==null?void 0:f.value[s].value})});const a=[];let u=0,v=0;const h=`P2P(${t.unit})`,y=`HTTP(${t.unit})`;p.forEach(c=>{const s=b(c.ts*1e3).format("MM-DD"),i=N(c.p2p,t.unit),g=N(c.http,t.unit);u+=Number.parseFloat(`${i}`),v+=Number.parseFloat(`${g}`),a.push({Date:s,[h]:i,[y]:g})});const $=(u/a.length).toFixed(2),w=(v/a.length).toFixed(2);return a.push({Date:"Avg",[h]:$,[y]:w}),x.value="Global Traffic Statistics.csv",a})}return A(),(p,a)=>(I(),U(_(Z),{description:_(L)("page.history.data.descGlobal")},{extra:k(()=>[D(_(G),{class:"mt-1",type:"primary"},{default:k(()=>[D(_(V),{fetch:C,name:x.value,type:"csv"},{default:k(()=>a[2]||(a[2]=[J(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:k(()=>[D(K),W("div",aa,[D(_(z),{date:l.value,"onUpdate:date":a[0]||(a[0]=u=>l.value=u),range:r.value,"onUpdate:range":a[1]||(a[1]=u=>r.value=u),day:!1,hour:!1,"show-time":!1,onChange:R},null,8,["date","range"])]),D(Q,{data:n,"option-data":t,"second-data":e,class:"mt-6","show-p2p":""},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ha as default};
