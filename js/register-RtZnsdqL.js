var Y=Object.defineProperty;var B=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,H=Object.prototype.propertyIsEnumerable;var q=(c,s,a)=>s in c?Y(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a,U=(c,s)=>{for(var a in s||(s={}))z.call(s,a)&&q(c,a,s[a]);if(B)for(var a of B(s))H.call(s,a)&&q(c,a,s[a]);return c};var w=(c,s,a)=>new Promise((l,u)=>{var b=i=>{try{p(a.next(i))}catch(f){u(f)}},h=i=>{try{p(a.throw(i))}catch(f){u(f)}},p=i=>i.done?l(i.value):Promise.resolve(i.value).then(b,h);p((a=a.apply(c,s)).next())});import{u as J,T as K,_ as O,h as G,$ as e,a as Q,i as X,j as ee,k as F,l as te,m as L,n as ae,o as ne,s as oe,b as _,c as y,d as se,g as ie,p as re,q as ce,t as le,e as ue}from"./bootstrap-DrkGJIrR.js";import{a5 as Z,Y as me,J as W,af as M,ag as de,w as P,ah as A,ab as g,b3 as he,ai as R,al as E,au as S,av as C,R as d,a6 as pe,n as fe,ak as ge,S as ve,e as k,bw as we,a$ as be}from"../jse/index-index-C3bEZzmN.js";const _e={class:"mt-4 text-center text-sm"},Ce=Z({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},showThirdPartyLogin:{type:Boolean,default:!0},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["authRequest","submit"],setup(c,{expose:s,emit:a}){const l=c,u=a,[b,h]=J(me({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:W(()=>l.formSchema),showDefaultActions:!1})),p=Q();function i(){return w(this,null,function*(){const{valid:n}=yield h.validate(),v=yield h.getValues();n&&u("submit",v)})}function f(n){return w(this,null,function*(){u("authRequest",n)})}function x(){p.push(l.loginPath)}return s({getFormApi:()=>h}),(n,v)=>(M(),de("div",null,[P(K,null,{desc:A(()=>[R(n.$slots,"subTitle",{},()=>[S(C(n.subTitle||g(e)("authentication.signUpSubtitle")),1)])]),default:A(()=>[R(n.$slots,"title",{},()=>[S(C(n.title||g(e)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),P(g(b)),P(g(O),{class:he([{"cursor-wait":l.loading},"mt-2 w-full"]),loading:l.loading,"aria-label":"register",onClick:i},{default:A(()=>[R(n.$slots,"submitButtonText",{},()=>[S(C(l.submitButtonText||g(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),R(n.$slots,"third-party-login",{},()=>[P(G,{"show-all":l.showThirdPartyLogin,onSubmit:f},null,8,["show-all"])]),E("div",_e,[S(C(g(e)("authentication.alreadyHaveAccount"))+" ",1),E("span",{class:"vben-link text-sm font-normal",onClick:v[0]||(v[0]=V=>x())},C(g(e)("authentication.goToLogin")),1)])]))}}),Se=Z({name:"Register",__name:"register",setup(c){const{locale:s}=X(),a=ee(),l=d(!1),u=d(""),b=d(""),h=d(!1),p=d(!0),i=d(!0),f=d(),x=ne(),n=d(""),v=d(""),V=W(()=>[{component:ve(ue),componentProps:{placeholder:e("auth.console"),onChange:t=>{t&&(oe(t),p.value=t!=="https://cgi-cn.cdnbye.com/v1/")}},fieldName:"selectZone",label:e("auth.console"),rules:_().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:_().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(t,r){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>w(this,null,function*(){const o=r.errors.value;if(!t.email||o!=null&&o.email)throw y.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield se({email:t.email,action:"signup"})}),createText:o=>o>0?e("authentication.sendText",[o]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"vcode",label:e("authentication.code"),rules:_().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:_().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{passwd:r}=t;return _().min(1,{message:e("authentication.passwordTip")}).refine(o=>o===r,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:_().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInput",componentProps:{placeholder:e("auth.inviter")},dependencies:{if:i.value},fieldName:"inviter",label:e("auth.inviter")},{component:"VbenInputCaptcha",componentProps:{imageUrl:b.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:N},dependencies:{if:h.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")},{component:"VbenCheckbox",fieldName:"contractChecked",label:"",defaultValue:!0,renderComponentContent:()=>({default:()=>[k("div",[k("span",`${e("auth.contract")}ã€Š`),k("a",{target:"view_window",class:"text-primary hover:text-primary-hover",href:s.value==="zh-CN"?"https://www.cdnbye.com/cn/contract.html":"https://www.cdnbye.com/guides/contract.html"},e("auth.contractName")),k("span","ã€‹")])]})}]);function N(){return w(this,null,function*(){const[,t]=yield we(ie(u.value));u.value=t==null?void 0:t.captcha_id,b.value=t==null?void 0:t.captcha_url,h.value=!0})}function j(t){return w(this,null,function*(){var r;l.value=!0,n.value=t.inviter;try{if(t.email===n.value){y.error("inviter email is invalid");return}window.gtag("set","user_data",{email:t.email}),window.gtag("event","conversion",{send_to:"AW-10834653519"});const o=be(U({utc:re(),inviter:n.value||"",referer:v.value||void 0,captcha_id:u.value||"",captcha_value:t.captcha_value||""},t),["contractChecked","selectZone"]),m=yield ce(o);yield a.register(m),y.success(e("auth.signUpSuccess")),window.gtag("event","conversion",{send_to:"AW-10834653519/i6W3CKPa8f4YEM_irq4o"})}catch(o){const{code:m}=(r=o==null?void 0:o.data)!=null?r:{};(m===4005||m===4019)&&(yield N())}finally{l.value=!1}})}function D(t){return w(this,null,function*(){if(!F()){y.error(e("auth.selectZoneWarn"));return}const{provider:r,inviter:o}=t;o&&L(o);const{url:m}=yield le(r);location.href=m})}return pe(()=>{setTimeout(()=>{const{zone:t,inviter:r,source:o}=x.query,m=F();t&&m!==t&&(te(t),location.reload()),r?(L(r),n.value=r,i.value=!1):(n.value=ae(),i.value=!!n.value);const I=o||document.referrer;I&&(v.value=I),fe(()=>{var T,$;n.value&&(($=(T=f.value)==null?void 0:T.getFormApi)==null?void 0:$.call(T)).setValues({inviter:n.value})})},50)}),(t,r)=>(M(),ge(g(Ce),{ref_key:"formRef",ref:f,"form-schema":V.value,loading:l.value,"show-third-party-login":p.value,onAuthRequest:D,onSubmit:j},null,8,["form-schema","loading","show-third-party-login"]))}});export{Se as default};
