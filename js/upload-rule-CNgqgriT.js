var j=Object.defineProperty,D=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var w=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var B=(d,o,a)=>o in d?j(d,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):d[o]=a,g=(d,o)=>{for(var a in o||(o={}))z.call(o,a)&&B(d,a,o[a]);if(w)for(var a of w(o))F.call(o,a)&&B(d,a,o[a]);return d},_=(d,o)=>D(d,W(o));var y=(d,o,a)=>new Promise((l,k)=>{var b=s=>{try{u(a.next(s))}catch(f){k(f)}},U=s=>{try{u(a.throw(s))}catch(f){k(f)}},u=s=>s.done?l(s.value):Promise.resolve(s.value).then(b,U);u((a=a.apply(d,o)).next())});import{$ as t,b6 as S,d4 as G,B as O,y as T}from"./bootstrap-DrkGJIrR.js";import{u as Y}from"./vxe-table-CtBEIJv9.js";import{f as q}from"./domain-rgJ2Vf-M.js";import{c as E,d as I}from"./p2p-CFQWiCsY.js";import{_ as H}from"./page.vue_vue_type_script_setup_true_lang-DsfYRoTI.js";import{a5 as J,Y as K,af as h,ak as C,ah as m,ab as c,w as x,aj as v,ag as V,au as M,av as N,bw as $}from"../jse/index-index-C3bEZzmN.js";import"./loading-B4I_UEwy.js";import"./form-Bwtu3Hhw.js";import"./RightOutlined-Bhb1z1mK.js";import"./x-BMfoBjs2.js";const Q={key:0,class:"flex justify-center"},X={key:1,class:"text-destructive"},Z="*Apply To All*",ue=J({__name:"upload-rule",setup(d){const o=K({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:t("page.p2p.name"),minWidth:250},{field:"status",title:t("page.p2p.uploadRuleStatus"),slots:{default:"status"},width:200},{field:"same_country",title:t("page.p2p.policySameCountry"),slots:{default:"same_country"},width:200},{field:"seeder",title:t("page.seeder.seedPreferred"),slots:{default:"seeder"},width:200,titleSuffix:{content:t("page.seeder.seedPreferredTip")}},{field:"operation",title:t("page.seeder.urgentRatio"),slots:{default:"operation"},width:200,titleSuffix:{content:t("page.seeder.urgentRatioTip")}}],height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:r=>y(this,[r],function*({page:n}){var A,L,R,P;let e=yield q({page:n.currentPage,page_size:n.pageSize,isvalid:1});const i={};for(const p of e)if(p.domain.endsWith(".localhost")){i.wifi_only=p.wifi_only,i.seed_preferred=p.seed_preferred,i.same_country=p.same_country,i.urgent_ratio=p.urgent_ratio;break}return e=e.filter(p=>!p.blocked),e.length>1&&e.unshift(g({uid:(A=e==null?void 0:e[0])==null?void 0:A.uid,domain:Z,id:0,blocked:!1,wifi_only:(L=e==null?void 0:e[0])==null?void 0:L.wifi_only,seed_preferred:(R=e==null?void 0:e[0])==null?void 0:R.seed_preferred,same_country:(P=e==null?void 0:e[0])==null?void 0:P.same_country},i)),{items:e,total:1e3}})}}}),[a,l]=Y({gridOptions:o});function k(n,r){u(n.id,_(g({},n),{wifi_only:r}))}function b(n,r){u(n.id,_(g({},n),{same_country:r}))}function U(n,r){u(n.id,_(g({},n),{seed_preferred:r}))}function u(n,r){return y(this,null,function*(){l.setLoading(!0);const[e]=yield $(E(n,r));l.setLoading(!1),f(e)})}function s(n){return y(this,null,function*(){l.setLoading(!0);const[r]=yield $(I(n.id,{urgent_ratio:n.urgent_ratio}));l.setLoading(!1),f(r)})}function f(n){if(n){T.error({description:t("page.p2p.configFail"),message:t("common.error")});return}T.success({description:t("page.p2p.configSuccess"),message:t("common.success")}),l.reload()}return(n,r)=>(h(),C(c(H),{description:c(t)("page.p2p.uploadRuleDesc"),"auto-content-height":""},{default:m(()=>[x(c(a),null,{status:m(({row:e})=>[e.blocked?v("",!0):(h(),C(c(S),{key:0,checked:!!e.wifi_only,"checked-children":c(t)("common.on"),"un-checked-children":c(t)("common.off"),"onUpdate:checked":i=>k(e,i)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),same_country:m(({row:e})=>[e.blocked?v("",!0):(h(),C(c(S),{key:0,checked:!!e.same_country,"checked-children":c(t)("common.on"),"un-checked-children":c(t)("common.off"),"onUpdate:checked":i=>b(e,i)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),seeder:m(({row:e})=>[e.blocked?v("",!0):(h(),C(c(S),{key:0,checked:!!e.seed_preferred,"checked-children":c(t)("common.on"),"un-checked-children":c(t)("common.off"),"onUpdate:checked":i=>U(e,i)},null,8,["checked","checked-children","un-checked-children","onUpdate:checked"]))]),operation:m(({row:e})=>[e.blocked?(h(),V("span",X,N(c(t)("common.illegal")),1)):(h(),V("div",Q,[x(c(G),{value:e.urgent_ratio,"onUpdate:value":i=>e.urgent_ratio=i,class:"mr-2"},null,8,["value","onUpdate:value"]),x(c(O),{type:"primary",onClick:i=>s(e)},{default:m(()=>[M(N(c(t)("common.ok")),1)]),_:2},1032,["onClick"])]))]),_:1})]),_:1},8,["description"]))}});export{ue as default};
