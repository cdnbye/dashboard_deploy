var z=Object.defineProperty;var q=Object.getOwnPropertySymbols;var H=Object.prototype.hasOwnProperty,J=Object.prototype.propertyIsEnumerable;var B=(c,s,a)=>s in c?z(c,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):c[s]=a,U=(c,s)=>{for(var a in s||(s={}))H.call(s,a)&&B(c,a,s[a]);if(q)for(var a of q(s))J.call(s,a)&&B(c,a,s[a]);return c};var w=(c,s,a)=>new Promise((l,u)=>{var b=i=>{try{h(a.next(i))}catch(p){u(p)}},d=i=>{try{h(a.throw(i))}catch(p){u(p)}},h=i=>i.done?l(i.value):Promise.resolve(i.value).then(b,d);h((a=a.apply(c,s)).next())});import{u as O,a as W,$ as e,T as Y,_ as G,h as K,i as Q,j as X,k as ee,l as F,m as te,n as ae,o as ne,M as oe,p as se,q as ie,b as k,t as re,c as ce,s as le,d as C,e as ue,g as me}from"./bootstrap-PGBUDbCq.js";import"./index-Dk_hv1id.js";import{a5 as Z,Y as de,J as E,ag as M,am as he,n as _,ai as V,aj as P,ap as R,aq as T,ab as f,b3 as pe,ar as L,R as m,a6 as fe,q as ge,ah as ve,b1 as we,S as be,e as S,bw as Ce}from"../jse/index-index-BXx06mpc.js";const Te={class:"mt-4 text-center text-sm"},ye=Z({name:"RegisterForm",__name:"register",props:{formSchema:{default:()=>[]},loading:{type:Boolean,default:!1},showThirdPartyLogin:{type:Boolean,default:!0},loginPath:{default:"/login"},title:{default:""},subTitle:{default:""},submitButtonText:{default:""}},emits:["authRequest","submit"],setup(c,{expose:s,emit:a}){const l=c,u=a,[b,d]=O(de({commonConfig:{hideLabel:!0,hideRequiredMark:!0},schema:E(()=>l.formSchema),showDefaultActions:!1})),h=W();function i(){return w(this,null,function*(){const{valid:n}=yield d.validate(),g=yield d.getValues();n&&u("submit",g)})}function p(n){return w(this,null,function*(){u("authRequest",n)})}function x(){h.push(l.loginPath)}return s({getFormApi:()=>d}),(n,g)=>(M(),he("div",null,[_(Y,null,{desc:V(()=>[P(n.$slots,"subTitle",{},()=>[R(T(n.subTitle||f(e)("authentication.signUpSubtitle")),1)])]),default:V(()=>[P(n.$slots,"title",{},()=>[R(T(n.title||f(e)("authentication.createAnAccount"))+" ðŸš€ ",1)])]),_:3}),_(f(b)),_(f(G),{class:pe([{"cursor-wait":l.loading},"mt-2 w-full"]),loading:l.loading,"aria-label":"register",onClick:i},{default:V(()=>[P(n.$slots,"submitButtonText",{},()=>[R(T(l.submitButtonText||f(e)("authentication.signUp")),1)])]),_:3},8,["class","loading"]),P(n.$slots,"third-party-login",{},()=>[_(K,{"show-all":l.showThirdPartyLogin,onSubmit:p},null,8,["show-all"])]),L("div",Te,[R(T(f(e)("authentication.alreadyHaveAccount"))+" ",1),L("span",{class:"vben-link text-sm font-normal",onClick:g[0]||(g[0]=A=>x())},T(f(e)("authentication.goToLogin")),1)])]))}}),ke=Z({name:"Register",__name:"register",setup(c){const{locale:s}=Q(),a=X(),l=m(!1),u=m(""),b=m(""),d=m(!1),h=m(!0),i=m(!0),p=m(),x=ee(),n=m(""),g=m(""),A=E(()=>[{component:be(ce),componentProps:{placeholder:e("auth.console"),onChange:t=>{t&&(le(t),h.value=t!=="https://cgi-cn.cdnbye.com/v1/")}},fieldName:"selectZone",label:e("auth.console"),rules:C().min(1,{message:e("auth.console")})},{component:"VbenInput",componentProps:{placeholder:e("auth.username")},fieldName:"email",label:e("auth.username"),rules:C().email({message:e("auth.usernameError")})},{component:"VbenPinInput",componentProps(t,r){return{showInput:!1,maxTime:300,codeLength:4,handleSendCode:()=>w(this,null,function*(){const o=r.errors.value;if(!t.email||o!=null&&o.email)throw k.error(e("auth.usernameError")),new Error(e("auth.usernameError"));yield ue({email:t.email,action:"signup"})}),createText:o=>o>0?e("authentication.sendText",[o]):e("authentication.sendCode"),placeholder:e("authentication.code")}},fieldName:"vcodeBtn",label:e("authentication.code")},{component:"VbenInput",componentProps:{placeholder:e("authentication.code")},fieldName:"vcode",label:e("authentication.code"),rules:C().min(1,{message:e("authentication.codeTip")})},{component:"VbenInputPassword",componentProps:{passwordStrength:!0,placeholder:e("authentication.password")},fieldName:"passwd",label:e("authentication.password"),renderComponentContent(){return{strengthText:()=>e("authentication.passwordStrength")}},rules:C().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInputPassword",componentProps:{placeholder:e("authentication.confirmPassword")},dependencies:{rules(t){const{passwd:r}=t;return C().min(1,{message:e("authentication.passwordTip")}).refine(o=>o===r,{message:e("authentication.confirmPasswordTip")})},triggerFields:["passwd"]},fieldName:"confirm_password",label:e("authentication.confirmPassword"),rules:C().min(1,{message:e("authentication.passwordTip")})},{component:"VbenInput",componentProps:{placeholder:e("auth.inviter")},dependencies:{if:i.value},fieldName:"inviter",label:e("auth.inviter")},{component:"VbenInputCaptcha",componentProps:{imageUrl:b.value,label:e("authentication.code"),placeholder:e("authentication.code"),onClick:N},dependencies:{if:d.value,triggerFields:[""]},fieldName:"captcha_value",label:e("authentication.code")},{component:"VbenCheckbox",fieldName:"contractChecked",label:"",defaultValue:!0,renderComponentContent:()=>({default:()=>[S("div",[S("span",`${e("auth.contract")}ã€Š`),S("a",{target:"view_window",class:"text-primary hover:text-primary-hover",href:s.value==="zh-CN"?"https://www.cdnbye.com/cn/contract.html":"https://www.cdnbye.com/guides/contract.html"},e("auth.contractName")),S("span","ã€‹")])]})}]);function N(){return w(this,null,function*(){const[,t]=yield Ce(me(u.value));u.value=t==null?void 0:t.captcha_id,b.value=t==null?void 0:t.captcha_url,d.value=!0})}function j(t){return w(this,null,function*(){var r;l.value=!0;try{if(t.email===n.value){oe.confirm({title:"inviter email is invalid",content:"inviter email is invalid"});return}const o=we(U({utc:se(),inviter:n.value||"",referer:g.value||void 0,captcha_id:u.value||"",captcha_value:t.captcha_value||""},t),["contractChecked","selectZone"]),v=yield ie(o);yield a.register(v),k.success(e("auth.signUpSuccess"))}catch(o){const{code:v}=(r=o==null?void 0:o.data)!=null?r:{};(v===4005||v===4019)&&(yield N())}finally{l.value=!1}})}function D(t){return w(this,null,function*(){if(!F()){k.error(e("auth.selectZoneWarn"));return}const{provider:r}=t,{url:o}=yield re(r);location.href=o})}return fe(()=>{setTimeout(()=>{const{zone:t,inviter:r,source:o}=x.query,v=F();t&&v!==t&&(te(t),location.reload()),r?(ae(r),n.value=r,i.value=!1):(n.value=ne(),i.value=!!n.value);const I=o||document.referrer;I&&(g.value=I),ge(()=>{var y,$;n.value&&(($=(y=p.value)==null?void 0:y.getFormApi)==null?void 0:$.call(y)).setValues({inviter:n.value})})},50)}),(t,r)=>(M(),ve(f(ye),{ref_key:"formRef",ref:p,"form-schema":A.value,loading:l.value,"show-third-party-login":h.value,onAuthRequest:D,onSubmit:j},null,8,["form-schema","loading","show-third-party-login"]))}});export{ke as default};
