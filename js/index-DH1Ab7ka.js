var Y=Object.defineProperty,z=Object.defineProperties;var W=Object.getOwnPropertyDescriptors;var P=Object.getOwnPropertySymbols;var L=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var R=(c,i,n)=>i in c?Y(c,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):c[i]=n,B=(c,i)=>{for(var n in i||(i={}))L.call(i,n)&&R(c,n,i[n]);if(P)for(var n of P(i))$.call(i,n)&&R(c,n,i[n]);return c},I=(c,i)=>z(c,W(i));var E=(c,i,n)=>new Promise((x,y)=>{var S=m=>{try{k(n.next(m))}catch(b){y(b)}},C=m=>{try{k(n.throw(m))}catch(b){y(b)}},k=m=>m.done?x(m.value):Promise.resolve(m.value).then(S,C);k((n=n.apply(c,i)).next())});import{$ as e,c$ as V,a as G,y as j,x as T,z as w}from"./bootstrap-CkMOf_ks.js";import{u as M}from"./vxe-table-CJuSgLt1.js";import{a as F,b as q,d as H}from"./order-KG8VS8O-.js";import{_ as J}from"./page.vue_vue_type_script_setup_true_lang-CAFig3cp.js";import{D as K,a as h}from"./index-Be7NL6rj.js";import{a5 as Q,Y as X,af as d,ak as p,ah as l,ab as t,w as A,al as Z,ag as ee,an as te,au as u,av as f,aj as g,F as ae,bw as v}from"../jse/index-index-Dsf0VSis.js";import{P as re}from"./index-D9iiVDcs.js";import{A as oe}from"./arrow-down-plalnEV_.js";import"./loading-qrt6bFpU.js";import"./form-2M7Ngajq.js";import"./RightOutlined-CvZk-aGs.js";import"./x-DG8pKHUf.js";import"./responsiveObserve-Cl5dIqyT.js";const se={class:"p-5"},be=Q({__name:"index",setup(c){const i=G(),n=X({columns:[{type:"expand",width:80,slots:{content:"expand_content"}},{field:"created_at",title:e("page.order.createTime"),width:200,formatter:"formatDateTime"},{field:"type",title:e("page.order.type"),width:150},{field:"payMethod",title:e("page.order.payMethod"),width:200},{field:"price",title:e("page.order.price"),width:100},{field:"currency",title:e("page.order.currency"),width:100},{field:"status",title:e("page.order.status"),width:100,slots:{default:"status"}},{field:"operation",title:e("common.operation"),slots:{default:"operation"},width:200}],height:"auto",pagerConfig:{},proxyConfig:{ajax:{query:r=>E(this,[r],function*({page:a}){const o=yield F({page:a.currentPage,page_size:a.pageSize});return{items:o.orders.map(_=>I(B({},_),{status:C(_),_type:_.type,type:S(_),payMethod:V(_)})),total:o.total}})}}}),[x,y]=M({gridOptions:n});function S(a){let r="";return a.type.startsWith("flow_packet")?r=e("page.order.flowPackage"):a.type.startsWith("monthly_packet")?r=e("page.order.monthlyPlan"):a.type.startsWith("recharge")&&(r=e("page.order.recharge")),r}function C(a){let r="";switch(a.trade_status){case"TRADE_CLOSED":{r=e("page.order.fail");break}case"TRADE_FINISHED":{r=e("page.invitation.done");break}case"TRADE_PROCESSING":{r=e("page.order.processing");break}case"TRADE_SUCCESS":{r=e("page.invitation.done");break}case"WAIT_BUYER_PAY":{r=e("page.order.waitPay");break}}return r}function k(a){const r=a.trade_status;return r==="WAIT_BUYER_PAY"||r==="TRADE_PROCESSING"?"":r==="TRADE_CLOSED"?"red":"green"}function m(a){i.push({name:"OrderDetail",query:{currency:a.currency,orderID:a.order_id,totalPrice:a.price,buyData:JSON.stringify(a.details)}})}function b(a){return E(this,null,function*(){y.setLoading(!0);const[r,o]=yield v(q(a.order_id));if(y.setLoading(!1),r){w.error({message:e("common.error")});return}if(o){const s=window.atob(o),_=new Uint8Array(s.length);for(let D=0;D<s.length;D++)_[D]=s.charCodeAt(D);const N=new Blob([_],{type:"application/pdf"}),U=window.URL.createObjectURL(N);window.open(U)}})}function O(a){return E(this,null,function*(){const[r]=yield v(H(a.order_id));if(r){w.error({message:e("common.error")});return}w.success({message:e("common.success")}),yield y.reload()})}return(a,r)=>(d(),p(t(J),{"auto-content-height":""},{default:l(()=>[A(t(x),null,{expand_content:l(({row:o})=>[Z("div",se,[(d(!0),ee(ae,null,te(o.details,s=>(d(),p(t(K),{key:s.id,size:"small"},{default:l(()=>[A(t(h),{label:t(e)("page.order.packageName")},{default:l(()=>[u(f(s.subject),1)]),_:2},1032,["label"]),s.amount?(d(),p(t(h),{key:0,label:t(e)("page.order.amount")},{default:l(()=>[u(f(s.amount),1)]),_:2},1032,["label"])):g("",!0),!s.type&&s.amount&&s.traffic?(d(),p(t(h),{key:1,label:t(e)("page.order.totalTraffic")},{default:l(()=>[u(f(s.traffic*s.amount)+" TB ",1)]),_:2},1032,["label"])):g("",!0),o.balance_used?(d(),p(t(h),{key:2,label:t(e)("page.package.useBalance")},{default:l(()=>[u(f(o.balance_used),1)]),_:2},1032,["label"])):g("",!0),s.autorenew?(d(),p(t(h),{key:3},{default:l(()=>[u(f(t(e)("page.order.autorenew")),1)]),_:1})):g("",!0),s.upgrade?(d(),p(t(h),{key:4},{default:l(()=>[u(f(t(e)("page.order.upgraded")),1)]),_:1})):g("",!0)]),_:2},1024))),128))])]),status:l(({row:o})=>[A(t(j),{color:k(o)},{default:l(()=>[u(f(C(o)),1)]),_:2},1032,["color"])]),operation:l(({row:o})=>[o.trade_status==="WAIT_BUYER_PAY"?(d(),p(t(T),{key:0,size:"small",type:"link",onClick:s=>m(o)},{default:l(()=>[u(f(t(e)("page.order.pay")),1)]),_:2},1032,["onClick"])):g("",!0),o.trade_status==="WAIT_BUYER_PAY"?(d(),p(t(re),{key:1,"cancel-text":t(e)("common.cancel"),"ok-text":t(e)("common.ok"),title:t(e)("common.sureClose"),onConfirm:s=>O(o)},{default:l(()=>[A(t(T),{danger:"",size:"small",type:"link"},{default:l(()=>[u(f(t(e)("page.order.close")),1)]),_:1})]),_:2},1032,["cancel-text","ok-text","title","onConfirm"])):g("",!0),o.trade_status==="TRADE_SUCCESS"&&!o._type.startsWith("recharge")?(d(),p(t(T),{key:2,class:"ml-1",size:"small",type:"link",onClick:s=>b(o)},{default:l(()=>[A(t(oe),{class:"mb-1 mr-[2px] inline-flex size-3"}),u(" "+f(t(e)("page.order.invoice")),1)]),_:2},1032,["onClick"])):g("",!0)]),_:1})]),_:1}))}});export{be as default};
