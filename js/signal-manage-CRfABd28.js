var U=Object.defineProperty;var k=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,V=Object.prototype.propertyIsEnumerable;var v=(o,n,e)=>n in o?U(o,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[n]=e,x=(o,n)=>{for(var e in n||(n={}))N.call(n,e)&&v(o,e,n[e]);if(k)for(var e of k(n))V.call(n,e)&&v(o,e,n[e]);return o};var h=(o,n,e)=>new Promise((g,u)=>{var f=a=>{try{p(e.next(a))}catch(i){u(i)}},t=a=>{try{p(e.throw(a))}catch(i){u(i)}},p=a=>a.done?g(a.value):Promise.resolve(a.value).then(f,t);p((e=e.apply(o,n)).next())});import{$ as l,c_ as w,I as y,bc as B,B as I,cZ as T,v as C}from"./bootstrap-SKctUie3.js";import{u as z}from"./vxe-table-CfGRJCLB.js";import{f as F}from"./domain-Cy3FhfO2.js";import{u as G}from"./p2p-DsAJDZBq.js";import{_ as M}from"./page.vue_vue_type_script_setup_true_lang-Dgq6zLp-.js";import{a5 as O,Y as R,ah as S,ai as c,ab as r,ag as L,ar as _,aq as b,n as m,al as W,ap as $,bw as j}from"../jse/index-index-0SEuuMhD.js";import"./loading-BVj1NiH4.js";import"./form-ufAcWega.js";import"./RightOutlined-BmsLIaO2.js";import"./x-Cpey3BCi.js";const D={class:"text-foreground/60 mb-3"},P=["href"],q="*Apply To All*",sa=O({__name:"signal-manage",setup(o){const n=R({checkboxConfig:{highlight:!0,labelField:"name"},columns:[{field:"domain",title:l("page.p2p.name"),minWidth:250},{field:"addr",title:l("page.p2p.signalAddr"),slots:{default:"addr"},minWidth:200},{field:"addr2",title:l("page.p2p.signalAddr2"),slots:{default:"addr2"},minWidth:200},{field:"switch",title:l("page.p2p.signalSwitch"),slots:{default:"switch"},width:100},{field:"operation",title:l("common.operation"),slots:{default:"operation"},width:100}],editConfig:{mode:"cell",trigger:"manual"},height:"auto",keepSource:!0,pagerConfig:{},proxyConfig:{ajax:{query:p=>h(this,[p],function*({page:t}){var d,A;let a=yield F({page:t.currentPage,page_size:t.pageSize,isvalid:1});a.forEach(s=>{s.signals&&s.signals.length>=0&&(s.signals=s.signals.join(`
`)),s.signals2&&s.signals2.length>=0&&(s.signals2=s.signals2.join(`
`))});const i={};for(const s of a)if(s.domain.endsWith(".localhost")){i.signals=s.signals,i.signals2=s.signals2,i.signal_enabled=s.signal_enabled;break}return a=a.filter(s=>!s.blocked),a.length>1&&a.unshift(x({uid:(d=a==null?void 0:a[0])==null?void 0:d.uid,domain:q,id:0,blocked:!1,signal_enabled:(A=a==null?void 0:a[0])==null?void 0:A.signal_enabled},i)),{items:a,total:1e3}})}}}),[e,g]=z({gridOptions:n});function u(t){let p=[],a=[];t.signals&&(p=t.signals.split(`
`).map(d=>d.trim()).filter(d=>d!=="")),t.signals2&&(a=t.signals2.split(`
`).map(d=>d.trim()).filter(d=>d!==""));const i={signals:p,signals2:a,enabled:t.signal_enabled};f(t.id,i)}function f(t,p){return h(this,null,function*(){g.setLoading(!0);const[a]=yield j(G(t,p));if(g.setLoading(!1),a){C.error({description:l("page.p2p.configFail"),message:l("common.error")});return}C.success({description:l("page.p2p.configSuccess"),message:l("common.success")}),g.reload()})}return(t,p)=>(L(),S(r(M),{"auto-content-height":""},{description:c(()=>[_("div",null,[_("p",D,b(r(l)("page.p2p.signalManageDesc")),1),_("a",{href:r(w),class:"text-primary hover:text-primary-hover",target:"_blank"},b(r(l)("page.p2p.signalManageOfficial"))+" -> ",9,P)])]),default:c(()=>[m(r(e),null,{addr:c(({row:a})=>[m(r(y).TextArea,{value:a.signals,"onUpdate:value":i=>a.signals=i,"auto-size":{minRows:1,maxRows:10},"allow-clear":"",placeholder:"wss://"},null,8,["value","onUpdate:value"])]),addr2:c(({row:a})=>[m(r(y).TextArea,{value:a.signals2,"onUpdate:value":i=>a.signals2=i,"auto-size":{minRows:1,maxRows:10},"allow-clear":"",placeholder:"wss://"},null,8,["value","onUpdate:value"])]),switch:c(({row:a})=>[a.blocked?W("",!0):(L(),S(r(B),{key:0,checked:a.signal_enabled,"onUpdate:checked":i=>a.signal_enabled=i},null,8,["checked","onUpdate:checked"]))]),operation:c(({row:a})=>[m(r(I),{type:"primary",onClick:T(i=>u(a),["prevent"])},{default:c(()=>[$(b(r(l)("common.ok")),1)]),_:2},1032,["onClick"])]),_:1})]),_:1}))}});export{sa as default};
