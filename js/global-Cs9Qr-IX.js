import{w as A,bo as l,$ as s,o as R,a as $,b6 as S}from"./bootstrap-CiyWlmzu.js";import{b as B,e as G}from"./app-Phc8078E.js";import{a as U,b as q,c as C,d as F}from"./live-data-BMRQfNmt.js";import{c as v,u as O}from"./order-_YWwujoO.js";import{_ as P}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-Rh6TKeIQ.js";import{_ as L}from"./checkin-button.vue_vue_type_script_setup_true_lang-Cex0WD88.js";import{_ as K}from"./distribution-global.vue_vue_type_script_setup_true_lang-BR-yDVR9.js";import{_ as M}from"./live-time.vue_vue_type_script_setup_true_lang-B1py05Zh.js";import"./index-B2PRAHmg.js";import{f as k,a as p}from"./format-xMJ9Tt3p.js";import{_ as N}from"./page.vue_vue_type_script_setup_true_lang-CQ_GieV6.js";import{a5 as j,R as m,a6 as V,a7 as z,af as E,ak as H,ah as g,ab as _,w as f}from"../jse/index-index-DX6TcLw_.js";import"./app-CWvsWFBj.js";import"./domain-DxFU4Atk.js";import"./use-modal-DGRkTv3G.js";import"./x-COcrQ3Ng.js";import"./loading-C3dzF5Xb.js";import"./pie-card.vue_vue_type_script_setup_true_lang-wZ1piHvc.js";import"./pie-chart.vue_vue_type_script_setup_true_lang-DjQ3cXxu.js";import"./use-echarts-BugotcPs.js";import"./index-D3WFkaVF.js";import"./live-card.vue_vue_type_script_setup_true_lang-KHlHh15D.js";const he=j({__name:"global",setup(J){const d=R(),y=$(),T=A(),i=m(!1),w=m(!0),o=m({whiteList:!1,type:{product_type:0,time:""},online:0,traffic_p2p:{num:0,unit:"KB"},traffic_http:{num:0,unit:"KB"},frequency_day:0,num_max:0,rebuffer_ratio:-1,flow:{remain:0,daily_remain:0,totalRemain:0,free:{num:0,unit:"KB"},utc:0},clock:null,traffic_p2p_day:0,traffic_http_day:0}),c=m({domainData:[],versionData:[],deviceData:[],liveData:[],netTypeData:[]});V(()=>{const{params:a}=d;a.domainInfo?(b(!0),x(!0)):(b(0),x())});let h;function b(a){D(a),clearInterval(h),h=setInterval(()=>{D(a)},2e4)}z(()=>{clearInterval(h)});function D(a){(a?()=>U(0):()=>q(0))().then(e=>{if(o.value.online=e.num_rt,o.value.traffic_p2p_day=e.traffic_p2p_day,o.value.traffic_http_day=e.traffic_http_day,o.value.traffic_p2p=k(e.traffic_p2p_day),o.value.traffic_http=k(e.traffic_http_day),o.value.frequency_day=e.api_frequency_day,o.value.num_max=e.num_max,o.value.flow.remain=e.flow.remain,o.value.flow.daily_remain=e.flow.daily_remain,o.value.flow.totalRemain=e.flow.daily_remain+e.flow.remain,o.value.flow.free=k(e.flow.free),o.value.flow.utc=e.flow.utc,o.value.whiteList=e.whitelist,o.value.type.product_type=e.flow.product_type,o.value.type.time=e.flow.duetime,o.value.clock=e.clock,e.flow.free===0&&e.flow.remain===0&&e.flow.daily_remain===0&&w.value&&d.query.payment===void 0&&!e.whitelist){const n=l.confirm({maskClosable:!1,closable:!0,title:s("page.dashboard.trafficUseOut"),okText:s("page.package.buyFlow"),cancelText:s("page.package.buyMonthly"),cancelButtonProps:{type:"primary"},onOk(){y.push("/shopping/package")},onCancel:r=>{n.destroy(),r!=null&&r.name&&y.push("/shopping/monthly-package")}});w.value=!1}}).catch(e=>{console.error(e)})}function x(a){const t=a?n=>C(0,{type:n}):(n,r)=>F(0,{type:n,lang:r});(a?()=>B():()=>G())().then(n=>{c.value.domainData=n?p(n):[]}),t("version").then(n=>{const r=n.data;c.value.versionData=r?p(r):[]}),t("device").then(n=>{const r=n.data;c.value.deviceData=r?p(r):[]}),t("live").then(n=>{const r=n.data;c.value.liveData=r?p(r):[]}),t("netType").then(n=>{const r=n.data;c.value.netTypeData=r?p(r):[]})}function u(a){i.value=!1,a.is_payed?l.success({title:s("page.package.paySuccess"),okText:s("common.ok"),onOk(){y.push("/")}}):a.processing?l.info({title:s("page.package.payPending"),okText:s("common.ok")}):l.error({title:s("page.package.payFail"),okText:s("common.ok")})}function I(){const a=d.query;if(a.cancel){l.warning({title:s("page.package.paySuspended"),okText:s("common.ok")});return}if(a.is_payed&&l.success({title:s("page.package.paySuccess"),okText:s("common.ok")}),a.payment)switch(i.value=!0,a.payment){case"alipay":{v("alipay",a.out_trade_no).then(t=>{u(t)}).catch(t=>{i.value=!1,console.error(t)});break}case"coinbase":case"coinpayments":case"cryptomus":case"nowpayments":{if(!a.orderId){i.value=!1;return}O({uid:Number.parseInt(`${T.accessUserId}`),order_id:a.orderId.split("?")[0],processing:!0}).then(t=>{u(t)}).catch(t=>{i.value=!1,console.error(t)});break}case"paypal":{v("paypal",a.orderId).then(t=>{u(t)}).catch(t=>{i.value=!1,console.error(t)});break}case"stripe":{v("stripe",a.orderId).then(t=>{u(t)}).catch(t=>{i.value=!1,console.error(t)});break}default:{i.value=!1;break}}}return I(),(a,t)=>(E(),H(_(N),{description:_(s)("page.dashboard.descGlobal"),"auto-content-height":"","content-class":"overflow-y-auto"},{extra:g(()=>[f(L)]),default:g(()=>[f(P),f(_(S),{spinning:i.value,tip:_(s)("page.package.checkResultLoadingTip")},{default:g(()=>[f(M,{"is-super-peer":!1,statis:o.value,global:""},null,8,["statis"]),f(K,{data:c.value},null,8,["data"])]),_:1},8,["spinning","tip"])]),_:1},8,["description"]))}});export{he as default};
