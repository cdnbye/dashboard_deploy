var M=($,v,n)=>new Promise((_,p)=>{var u=t=>{try{l(n.next(t))}catch(i){p(i)}},m=t=>{try{l(n.throw(t))}catch(i){p(i)}},l=t=>t.done?_(t.value):Promise.resolve(t.value).then(u,m);l((n=n.apply($,v)).next())});import{s as V}from"./vue-json-excel.esm-BWgZh1hi.js";import{B as b,$ as A}from"./bootstrap-CgpL34Qf.js";import{a5 as C,R as x,aW as y,Y as N,X as R,ah as S,ai as k,ab as f,bw as H,ag as U,n as D,ap as j,ar as F}from"../jse/index-index-CBSM48l5.js";import{f as G,D as I}from"./history-data-d-aHEnBj.js";import{_ as O}from"./not-bind-tip.vue_vue_type_script_setup_true_lang-CV7SZgK4.js";import{u as P}from"./app-DvGgY6y1.js";import{_ as T}from"./line-chart.vue_vue_type_script_setup_true_lang-D0ZUqW7J.js";import{_ as W}from"./page.vue_vue_type_script_setup_true_lang-BObZ_Ion.js";import"./use-modal-Dp_oiybZ.js";import"./x-Br57HnM1.js";import"./loading-Dx-bVRTa.js";import"./domain-CSTKk2DY.js";import"./use-echarts-D6SgrU4-.js";const X={class:"md:pt-5"},ra=C({__name:"online",setup($){const v=x("hour"),n=x([y().subtract(1,"hour"),y()]),_=x(),p=x(""),u=N({xData:[],yName:"online"}),m=N({}),l=N({}),t=P();R(()=>t.currentDomain,()=>{i()},{deep:!0});function i(){return M(this,arguments,function*(e=n.value[0],a=n.value[1]){var o;const s={start_ts:w(e),end_ts:w(a)},c=(o=t.currentDomain)==null?void 0:o.id;if(!c)return;const[h,g]=yield H(G(c,s));if(h)return;const r=g.list;_.value=r,u.xData=[],m.online=[],r.forEach(d=>{u.xData.push(y(d.ts*1e3).format("MM-DD HH:mm")),m.online.push(d.value)})})}function w(e){return e.unix()}function B(e,a){i(e,a)}function E(){return M(this,null,function*(){var g;const e=new Map;_.value.forEach(r=>{const o=y(r.ts*1e3).format("MM-DD"),d=e.get(o);(!d||d<r.value)&&e.set(o,r.value)});const a=[];let s=0,c=0;for(const[r,o]of e.entries())a.push({Date:r,Value:o}),s+=o,o!==0&&c++;let h=0;return c>0&&(h=Math.round(s/c)),a.push({Date:"Avg",Value:h}),p.value=`Online Statistics(${(g=t.currentDomain)==null?void 0:g.domain}).csv`,a})}return i(),(e,a)=>(U(),S(f(W),{description:f(A)("page.history.data.descGlobal")},{extra:k(()=>[D(f(b),{class:"mt-1",type:"primary"},{default:k(()=>[D(f(V),{fetch:E,name:p.value,type:"csv"},{default:k(()=>a[2]||(a[2]=[j(" Export Excel ")])),_:1},8,["name"])]),_:1})]),default:k(()=>[D(O),F("div",X,[D(f(I),{date:v.value,"onUpdate:date":a[0]||(a[0]=s=>v.value=s),range:n.value,"onUpdate:range":a[1]||(a[1]=s=>n.value=s),month:!1,span:7,onChange:B},null,8,["date","range"])]),D(T,{data:m,"option-data":u,"second-data":l,class:"mt-6"},null,8,["data","option-data","second-data"])]),_:1},8,["description"]))}});export{ra as default};
